<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Express" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Express" name="description"/>
            <meta content="en" name="language"/>
            <title>Express</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h6.8">6.8    Creating and Editing Data Records: Body Parser<a class="indexanchor" id="i06_72"/></h2>
        <p class="standard">You can only transmit a few data records via variables in the URL, and especially for forms this isn’t a practicable solution. As a rule, data is also sent using HTTP <samp class="listingcharacter listingcharacter">POST</samp>. You can benefit from this fact when extending your application. In the next step, you’ll implement a way to create new records and edit existing ones. You start this customization again in the frontend of your application by adding a link to the list display, which allows your users to create new records. Furthermore, you should add a link in the table for each entry to edit the records. <span class="crossreference "><a href="06_008.html#l6.24">Listing 6.24</a></span> contains the source code of the view.</p>
        <div class="listing " id="l6.24"><pre><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">render(</span><span class="schwarz">movies</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">return</span><span class="schwarz"> </span><span class="violett">`</span><br/>&lt;!DOCTYPE html&gt;<br/>&lt;html lang=<span class="hellblau">"en"</span><span class="violett">&gt;</span><br/>&lt;head&gt;<br/>  &lt;meta charset=<span class="hellblau">"UTF-8"</span><span class="violett">&gt;</span><br/><a id="p202"/>  &lt;title&gt;Movie list&lt;/title&gt;<br/>  &lt;link rel=<span class="hellblau">"stylesheet"</span><span class="violett"> href=</span><span class="hellblau">"style.css"</span><span class="violett"> /&gt;</span><br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>  &lt;table&gt;<br/>    &lt;thead&gt;&lt;tr&gt;&lt;th&gt;Id&lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;&lt;/th&gt;<span class="bold">&lt;th&gt;&lt;/th&gt;</span>&lt;/tr&gt;&lt;/thead&gt;<br/>    &lt;tbody&gt;<br/>      ${movies<br/>        .map(<br/>          (movie) =&gt; `<span class="schwarz"><br/></span>        <span class="dunkelblau">&lt;</span><span class="schwarz">tr</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span>          <span class="dunkelblau">&lt;</span><span class="schwarz">td</span><span class="dunkelblau">&gt;</span><span class="schwarz">${movie.id}</span><span class="dunkelblau">&lt;/</span><span class="schwarz">td</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span>          <span class="dunkelblau">&lt;</span><span class="schwarz">td</span><span class="dunkelblau">&gt;</span><span class="schwarz">${movie.title}</span><span class="dunkelblau">&lt;/</span><span class="schwarz">td</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span>          <span class="dunkelblau">&lt;</span><span class="schwarz">td</span><span class="dunkelblau">&gt;&lt;</span><span class="schwarz">a href</span><span class="dunkelblau">=</span><span class="hellblau">"/movie/delete/${movie.id}"</span><span class="dunkelblau">&gt;</span><span class="rot">delete</span><span class="dunkelblau">&lt;/</span><span class="schwarz">a</span><span class="dunkelblau">&gt;&lt;/</span><span class="schwarz">td</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span>          <span class="bold"><span class="dunkelblau">&lt;</span><span class="schwarz">td</span><span class="dunkelblau">&gt;&lt;</span><span class="schwarz">a href</span><span class="dunkelblau">=</span><span class="hellblau">"/movie/form/${movie.id}"</span><span class="dunkelblau">&gt;</span><span class="schwarz">edit</span><span class="dunkelblau">&lt;/</span><span class="schwarz">a</span><span class="dunkelblau">&gt;&lt;/</span><span class="schwarz">td</span><span class="dunkelblau">&gt;</span><span class="schwarz"> </span></span><br/>        <span class="dunkelblau">&lt;/</span><span class="schwarz">tr</span><span class="dunkelblau">&gt;</span><span class="violett">`,</span><br/>        )<br/>        .join(<span class="hellblau">''</span><span class="violett">)}</span><br/>    &lt;/tbody&gt;<br/>  &lt;/table&gt;<br/>  <span class="bold">&lt;a href=<span class="hellblau">"/movie/form"</span><span class="violett">&gt;new&lt;/a&gt;</span></span><br/>&lt;/body&gt;<br/>&lt;/html&gt;<br/>  `<span class="schwarz">;</span><br/>} <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 6.24</b>    
            Customizing the View (movie/view.js)</p>
        <p class="standard">Both links of the view point to the same route, once to <samp class="listingcharacter listingcharacter">/movie/form</samp> and once to <samp class="listingcharacter listingcharacter">/movie/form/:id</samp>. In Express, you can define optional parameters. If you attach a question mark to the parameter, it will be marked as optional, and you won’t have to define two separate routes. You can see the updated router configuration<a class="indexanchor" id="i06_73"/> in <span class="crossreference "><a href="06_008.html#l6.25">Listing 6.25</a></span>.</p>
        <div class="listing " id="l6.25"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> Router </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> listAction</span><span class="schwarz">,</span><span class="schwarz"> removeAction</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">formAction</samp></span> } <span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./controller.js'</span><span class="schwarz">;</span><br/> <br/><span class="rot">const</span><span class="schwarz"> router </span><span class="dunkelblau">=</span><span class="schwarz"> Router();</span><br/> <br/>router.get(<span class="hellblau">'/'</span><span class="schwarz">, listAction);</span><br/>router.get(<span class="hellblau">'/delete/:id'</span><span class="schwarz">, removeAction);</span><br/><span class="bold"><samp class="listingcharacter listingcharacter">router.get(<span class="hellblau">'/form/:id?'</span><span class="schwarz">, formAction);</span><br/> </samp></span><br/><span class="rot">export</span><span class="schwarz"> { router }; </span><span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 6.25</b>    
            Customizing the Router Configuration (movie/index.js)</p>
        <p class="standard"><a id="p203"/>The controller is responsible for reading information from the model based on the information from the request, if necessary, and for rendering the view. The crucial point here is to distinguish whether the user passed an ID to edit a data record or to create a new one. As you can see in <span class="crossreference "><a href="06_008.html#l6.26">Listing 6.26</a></span>, a data record is passed to the view in each case.</p>
        <div class="listing " id="l6.26"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> getAll</span><span class="schwarz">,</span><span class="schwarz"> remove</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">get</span><span class="schwarz"> </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./model.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> render </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./view.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> { render </span><span class="rot">as</span><span class="schwarz"> form } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./form.js'</span><span class="schwarz">;</span><br/> </samp></span><br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> listAction(request, response) {...}</span><br/> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> removeAction(request, response) {...}</span><br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter"><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> formAction(request, response) {</span><br/>  <span class="rot">let</span><span class="schwarz"> movie </span><span class="dunkelblau">=</span><span class="schwarz"> { id: </span><span class="hellblau">''</span><span class="schwarz">, title: </span><span class="hellblau">''</span><span class="schwarz">, year: </span><span class="hellblau">''</span><span class="schwarz"> };</span><br/> <br/>  <span class="rot">if</span><span class="schwarz"> (request.params.id) {</span><br/>    movie <span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> get(parseInt(request.params.id, 10));</span><br/>  }<br/> <br/>  <span class="rot">const</span><span class="schwarz"> body </span><span class="dunkelblau">=</span><span class="schwarz"> form(movie);</span><br/>  response.send(body);<br/>}</samp></span> <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 6.26</b>    
            “formAction” in the Controller (movie/controller.js)</p>
        <p class="standard">The implementation of this view is based on the implementation of the list. <span class="crossreference "><a href="06_008.html#l6.27">Listing 6.27</a></span> contains the source code.</p>
        <div class="listing " id="l6.27"><pre><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">render(</span><span class="schwarz">movie</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">return</span><span class="schwarz"> </span><span class="violett">`</span><br/>  &lt;!DOCTYPE html&gt;<br/>  &lt;html lang=<span class="hellblau">"en"</span><span class="violett">&gt;</span><br/>  &lt;head&gt;<br/>    &lt;meta charset=<span class="hellblau">"UTF-8"</span><span class="violett">&gt;</span><br/>    &lt;title&gt;Movie list&lt;/title&gt;<br/>    &lt;link rel=<span class="hellblau">"stylesheet"</span><span class="violett"> href=</span><span class="hellblau">" /style.css"</span><span class="violett"> /&gt;</span><br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;form action=<span class="hellblau">"/movie/save"</span><span class="violett"> method=</span><span class="hellblau">"post"</span><span class="violett">&gt;</span><br/>      &lt;input type=<span class="hellblau">"hidden"</span><span class="violett"> id=</span><span class="hellblau">"id"</span><span class="violett"> name=</span><span class="hellblau">"id"</span><span class="violett"> value=</span><span class="hellblau">"${movie.id}"</span><span class="violett"> /&gt;</span><br/>      &lt;div&gt;<br/>        &lt;label for=<span class="hellblau">"title"</span><span class="violett">&gt;Titel:&lt;/label&gt;</span><br/><a id="p204"/>        &lt;input type=<span class="hellblau">"text"</span><span class="violett"> id=</span><span class="hellblau">"title"</span><span class="violett"> name=</span><span class="hellblau">"title"</span><span class="violett"> value=</span><span class="hellblau">"${movie.title}"</span><span class="violett"> /&gt;</span><br/>      &lt;/div&gt;<br/>      &lt;div&gt;<br/>        &lt;label for=<span class="hellblau">"id"</span><span class="violett">&gt;Year:&lt;/label&gt;</span><br/>        &lt;input type=<span class="hellblau">"text"</span><span class="violett"> id=</span><span class="hellblau">"year"</span><span class="violett"> name=</span><span class="hellblau">"year"</span><span class="violett"> value=</span><span class="hellblau">"${movie.year}"</span><span class="violett"> /&gt;</span><br/>      &lt;/div&gt;<br/>      &lt;div&gt;<br/>        &lt;button type=<span class="hellblau">"submit"</span><span class="violett">&gt;save&lt;/button&gt;</span><br/>      &lt;/div&gt;<br/>    &lt;/form&gt;<br/>  &lt;/body&gt;<br/>  &lt;/html&gt; <br/>  `<span class="schwarz">;</span><span class="schwarz"><br/></span><span class="schwarz">};</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 6.27</b>    
            Form View (movie/form.js)</p>
        <p class="standard">The form uses the <samp class="listingcharacter listingcharacter">action="/movie/save"</samp> and <samp class="listingcharacter listingcharacter">method="post"</samp> attributes to ensure that the HTTP <samp class="listingcharacter listingcharacter">POST</samp> method data entered by the user is sent to the server. Based on the presence of an ID value, the server can distinguish whether the request is a creating or modifying operation. The values that are passed during editing are inserted into the individual form fields as <samp class="listingcharacter listingcharacter">value</samp> attributes via template substitutions. To be able to edit a record, you still need to implement the <samp class="listingcharacter listingcharacter">get</samp> method in the model, which you use to load the data record from the data source. In this application, it’s sufficient to call the <samp class="listingcharacter listingcharacter">find</samp> method of the <samp class="listingcharacter listingcharacter">data</samp> array to load the data record based on its ID. <span class="crossreference "><a href="06_008.html#l6.28">Listing 6.28</a></span> shows the corresponding source code.</p>
        <div class="listing " id="l6.28"><pre><span class="rot">let</span><span class="schwarz"> data </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[...];</span><span class="schwarz"><br/></span> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">getAll()</span><span class="schwarz"> </span><span class="schwarz">{...}</span><span class="schwarz"><br/></span> <br/><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> get(id) {</span><br/>  <span class="rot">return</span><span class="schwarz"> Promise.resolve(data.find((movie) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> movie.id </span><span class="dunkelblau">===</span><span class="schwarz"> id));</span><br/>}<br/> </samp></span><br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> remove(id) {...} </span><span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 6.28</b>    
            Extending the Model with the “get” Method (movie/model.js)</p>
        <p class="standard">When reloading your application, you can reach the form either via the <span class="screenelement">New</span> or the <span class="screenelement">Edit</span> links in the list. The results are shown in <span class="crossreference "><a href="06_008.html#f6.9">Figure 6.9</a></span>.</p>
        <div class="imagebox figure-type"><a href="img-f6.9.html" id="f6.9"><img alt="Form for Creating Data Records" id="img-f6.9" src="bilderklein/klein06_009.png"/></a></div>
        <p class="caption "><b>Figure 6.9</b>    
            <a id="p205"/>Form for Creating Data Records</p>
        
            <h3 class="t3" id="h6.8.1">6.8.1    Handling Form Input: Body Parser<a class="indexanchor" id="i06_74"/></h3>
            <p class="standard">To save your users’ input, you must be able to access the form data. The most convenient way to do so is to use the body parser middleware. The body parser package has had a troubled past. Originally, middleware was an integral part of Express, similar to <samp class="listingcharacter listingcharacter">static</samp> middleware. However, with version 4, it was moved out into a package of its own, and with version 4.16, it was incorporated back into the core of Express. So, if you’re using a recent version of Express, you don’t need to install any additional packages to request body processing.</p>
            <p class="standard">The body parser provides you with the two functions, <samp class="listingcharacter listingcharacter">json</samp><a class="indexanchor" id="i06_75"/> and <samp class="listingcharacter listingcharacter">urlencoded</samp><a class="indexanchor" id="i06_76"/> for JSON- and URL-encoded requests, respectively, which you can access directly via the <samp class="listingcharacter listingcharacter">express</samp> object. You can see the middleware integration in the <span class="italic">index.js</span> file of your application in <span class="crossreference "><a href="06_008.html#l6.29">Listing 6.29</a></span>.</p>
            <div class="listing " id="l6.29"><pre><span class="rot">import</span><span class="schwarz"> express </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> morgan </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'morgan'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> dirname </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'path'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> fileURLToPath </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'url'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> router </span><span class="rot">as</span><span class="schwarz"> movieRouter </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie/index.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> app </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">express();</span><span class="schwarz"><br/></span> <br/>app<span class="schwarz">.use(</span><span class="schwarz">express</span><span class="schwarz">.static(</span><span class="violett">`${dirname(fileURLToPath(import.meta.url))}/public`</span><span class="schwarz">));</span><span class="schwarz"><br/></span> <br/>app<span class="schwarz">.use(morgan(</span><span class="hellblau">'common'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> immediate</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz"> </span><span class="schwarz">}));</span><span class="schwarz"><br/></span> <br/><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">app.use(express.urlencoded({ extended: <span class="rot">false</span><span class="schwarz"> }));</span><br/> </samp></span><br/>app.use(<span class="hellblau">'/movie'</span><span class="schwarz">, movieRouter);</span><br/> <br/>app.get(<span class="hellblau">'/'</span><span class="schwarz">, (request, response) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> response.redirect(</span><span class="hellblau">'/movie'</span><span class="schwarz">));</span><br/> <br/><a id="p206"/>app.listen(8080, () <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Server is listening to http://localhost:8080'</span><span class="schwarz">);</span><br/>}); <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 6.29</b>    
            Integrating the Body Parser Middleware (index.js)</p>
            <p class="standard">As already mentioned, the body parser middleware supports various parsers. If you’re processing an ordinary HTML form, as in the example, you should use the <samp class="listingcharacter listingcharacter">urlencoded</samp> parser. If your frontend sends the information in JSON format instead, the JSON parser comes into play. Other parsers include the <samp class="listingcharacter listingcharacter">raw</samp> parser<a class="indexanchor" id="i06_77"/>, which parses the body as a buffer, and the <samp class="listingcharacter listingcharacter">text</samp> parser<a class="indexanchor" id="i06_78"/>, which interprets the body of the request as text. However, these two are only available as of Express version 4.17. You can also use the different parsers in parallel, for example, both the <samp class="listingcharacter listingcharacter">urlencoded</samp> and the JSON parser at the same time. After the inclusion, you must extend the router of your movie module to support the <span class="italic">/movie/save</span> URL path.</p>
            <p class="standard">As you can see in <span class="crossreference "><a href="06_008.html#l6.30">Listing 6.30</a></span>, the extension follows the scheme we’ve been using until now. The <samp class="listingcharacter listingcharacter">saveAction</samp> of the controller passes the information to the model. For better control, the controller extracts the required properties from the <samp class="listingcharacter listingcharacter">request.body</samp> property<a class="indexanchor" id="i06_79"/> provided by the body parser. This property contains all the data of the form as object properties.</p>
            <div class="listing " id="l6.30"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> Router </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"><br/></span>  listAction<span class="schwarz">,</span><span class="schwarz"><br/></span>  removeAction<span class="schwarz">,</span><span class="schwarz"><br/></span>  formAction<span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">saveAction,</samp></span><br/>} <span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./controller.js'</span><span class="schwarz">;</span><br/> <br/><span class="rot">const</span><span class="schwarz"> router </span><span class="dunkelblau">=</span><span class="schwarz"> Router();</span><br/> <br/>router.get(<span class="hellblau">'/'</span><span class="schwarz">, listAction);</span><br/>router.get(<span class="hellblau">'/delete/:id'</span><span class="schwarz">, removeAction);</span><br/>router.get(<span class="hellblau">'/form/:id?'</span><span class="schwarz">, formAction);</span><br/><span class="bold"><samp class="listingcharacter listingcharacter">router.post(<span class="hellblau">'/save'</span><span class="schwarz">, saveAction);</span><br/> </samp></span><br/><span class="rot">export</span><span class="schwarz"> { router }; </span><span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 6.30</b>    
            Extending the Router with the Save Route (movie/index.js)</p>
            <p class="standard">A separate view isn’t needed in the controller because <samp class="listingcharacter listingcharacter">saveAction</samp> redirects to the list. Again, as with deleting data records, the <samp class="listingcharacter listingcharacter">baseUrl</samp> property of the <samp class="listingcharacter listingcharacter">request</samp> object comes into play. <span class="crossreference "><a href="06_008.html#l6.31">Listing 6.31</a></span> shows the customized controller.</p>
            <div class="listing " id="l6.31"><pre><span class="rot"><a id="p207"/>import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> getAll</span><span class="schwarz">,</span><span class="schwarz"> remove</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">get</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">save</samp></span> } <span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./model.js'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { render } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./view.js'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { render </span><span class="rot">as</span><span class="schwarz"> form } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./form.js'</span><span class="schwarz">;</span><br/> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> listAction(request, response) {...}</span><br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> removeAction(request, response) {...}</span><br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> formAction(request, response) {...}</span><br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter"><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> saveAction(request, response) {</span><br/>  <span class="rot">const</span><span class="schwarz"> movie </span><span class="dunkelblau">=</span><span class="schwarz"> {</span><br/>    id: request.body.id,<br/>    title: request.body.title,<br/>    year: request.body.year,<br/>  };<br/>  <span class="rot">await</span><span class="schwarz"> save(movie);</span><br/>  response.redirect(request.baseUrl);</samp></span><br/>} <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 6.31</b>    
            “saveAction” of the Controller (movie/controller.js)</p>
            <p class="standard">The controller doesn’t know whether the current operation is a new creation or an update of a data record. This decision is left to the model. For this reason, the model code is also a bit more extensive at this point, as you can see in <span class="crossreference "><a href="06_008.html#l6.32">Listing 6.32</a></span>.</p>
            <div class="listing " id="l6.32"><pre><span class="rot">let</span><span class="schwarz"> data </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[...];</span><span class="schwarz"><br/></span> <br/><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">function</span><span class="schwarz"> getNextId() {</span><br/>  <span class="rot">return</span><span class="schwarz"> Math.max(...data.map((movie) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> movie.id)) </span><span class="dunkelblau">+</span><span class="schwarz"> 1;</span><br/>}<br/> <br/><span class="rot">function</span><span class="schwarz"> insert(movie) {</span><br/>  movie.id <span class="dunkelblau">=</span><span class="schwarz"> getNextId();</span><br/>  data.push(movie);<br/>}<br/> <br/><span class="rot">function</span><span class="schwarz"> update(movie) {</span><br/>  movie.id <span class="dunkelblau">=</span><span class="schwarz"> parseInt(movie.id, 10);</span><br/>  <span class="rot">const</span><span class="schwarz"> index </span><span class="dunkelblau">=</span><span class="schwarz"> data.findIndex((item) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> item.id </span><span class="dunkelblau">===</span><span class="schwarz"> movie.id);</span><br/>  data[index] <span class="dunkelblau">=</span><span class="schwarz"> movie;</span><br/>}<br/> </samp></span><br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> getAll() {...}</span><br/> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> get(id) {...}</span><br/> <br/><span class="rot"><a id="p208"/>export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> remove(id) {...}</span><br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter"><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> save(movie) {</span><br/>  <span class="rot">if</span><span class="schwarz"> (movie.id </span><span class="dunkelblau">===</span><span class="schwarz"> </span><span class="hellblau">''</span><span class="schwarz">) {</span><br/>    insert(movie);<br/>  } <span class="rot">else</span><span class="schwarz"> {</span><br/>    update(movie);<br/>  }<br/>  <span class="rot">return</span><span class="schwarz"> Promise.resolve();</span></samp></span><br/>} <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 6.32</b>    
            Implementing the “save” Method in the Model (movie/model.js)</p>
            <p class="standard">In the <samp class="listingcharacter listingcharacter">save</samp> function of the model, the <samp class="listingcharacter listingcharacter">id</samp> property of the transferred data is used to decide whether it’s a new or an existing data record. For new records, the <samp class="listingcharacter listingcharacter">hidden</samp> input field of the form isn’t filled or has an empty character string as its value. To keep the method clear and manageable, the <samp class="listingcharacter listingcharacter">insert</samp> and <samp class="listingcharacter listingcharacter">update</samp> functionality are swapped out into separate helper functions. The <samp class="listingcharacter listingcharacter">insert</samp> function uses the <samp class="listingcharacter listingcharacter">getNextId</samp> function, which searches for the next free ID in the data source. Normally, this task is assumed by the database; in our case, the highest ID of the data in the array is searched and incremented by one. Then the new ID is assigned to the record, and the information is pushed into the data array. When updating the data, you must first convert the ID of the record to a number because all information arrives from the client as character strings, and the ID is stored as a number for the calculation of the next higher ID in the data source. This change allows you to find the index of the affected record in the data source and adjust the array by overwriting the old record with the new information.</p>
            <p class="standard">After restarting the process, you can now view, delete, edit, and create new movies in your database.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>