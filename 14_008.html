<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Web Applications with Nest" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Web Applications with Nest" name="description"/>
            <meta content="en" name="language"/>
            <title>Web Applications with Nest</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h14.8">14.8    Documenting the Endpoints with OpenAPI<a class="indexanchor" id="i14_110"/><a class="indexanchor" id="i14_111"/></h2>
        <p class="standard">In addition to the implementation of interfaces, the documentation of these interfaces is another standard problem for which Nest offers an elegant solution. The <samp class="listingcharacter listingcharacter">@nestjs/swagger</samp> package<a class="indexanchor" id="i14_112"/> provides everything you need to document your interfaces and generates graphical documentation from some additional annotations that you can consume via the Swagger UI<a class="indexanchor" id="i14_113"/> or share with other developers. To do this, you must first install the necessary packages via the <samp class="listingcharacter listingcharacter">npm install @nestjs/swagger swagger-ui-express</samp> command. First, you need to integrate the Swagger module<a class="indexanchor" id="i14_114"/> in your application via the <span class="italic">main.ts</span> file, as shown in <span class="crossreference "><a href="14_008.html#l14.24">Listing 14.24</a></span>.</p>
        <div class="listing " id="l14.24"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> NestFactory </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'@nestjs/core'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> { DocumentBuilder, SwaggerModule } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'@nestjs/swagger'</span><span class="schwarz">;</span></samp></span><br/><span class="rot">import</span><span class="schwarz"> { AppModule } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./app.module'</span><span class="schwarz">;</span><br/> <br/><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> bootstrap() {</span><br/>  <span class="rot">const</span><span class="schwarz"> app </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> NestFactory.create(AppModule);</span><br/> <br/>  <span class="bold"><samp class="listingcharacter listingcharacter"><span class="rot">const</span><span class="schwarz"> config </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">DocumentBuilder()</span><br/>    .setTitle(<span class="hellblau">'Movie Database'</span><span class="schwarz">)</span><br/>    .setDescription(<span class="hellblau">'Your favourite movies in one database'</span><span class="schwarz">)</span><br/>    .setVersion(<span class="hellblau">'1.0'</span><span class="schwarz">)</span><br/>    .addTag(<span class="hellblau">'movies'</span><span class="schwarz">)</span><br/>    .build();<br/>  <span class="rot">const</span><span class="schwarz"> </span><span class="violett">document</span><span class="schwarz"> </span><span class="dunkelblau">=</span><span class="schwarz"> SwaggerModule.createDocument(app, config);</span><br/>  SwaggerModule.setup(<span class="hellblau">'api'</span><span class="schwarz">, app, </span><span class="violett">document</span><span class="schwarz">);</span><br/> </samp></span><br/>  <span class="rot">await</span><span class="schwarz"> app.listen(3000);</span><br/>}<br/>bootstrap(); <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 14.24</b>    
            Integrating the Swagger Module (src/main.ts)</p>
        <p class="standard">The <samp class="listingcharacter listingcharacter">DocumentBuilder</samp><a class="indexanchor" id="i14_115"/> is responsible for creating the Swagger documentation. Here, you can include general information such as the title and description of your interface. All other information, such as the available endpoints, is taken by the Swagger module from your application’s annotations. This means you can control the documentation of the interfaces directly from the source code of your application. Because you’re using the movie entity in the controller to specify the type, you can extend this class with the appropriate decorators from the <samp class="listingcharacter listingcharacter">@nestjs/swagger</samp> package. <span class="crossreference "><a href="14_008.html#l14.25">Listing 14.25</a></span> shows an example of this.</p>
        <div class="listing " id="l14.25"><pre><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot"><a id="p440"/>import</span><span class="schwarz"> { ApiProperty } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'@nestjs/swagger'</span><span class="schwarz">;</span></samp></span><br/><span class="rot">import</span><span class="schwarz"> { Column, Entity, PrimaryGeneratedColumn } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'typeorm'</span><span class="schwarz">;</span><br/> <br/>@Entity(<span class="hellblau">'Movie'</span><span class="schwarz">)</span><br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">class Movie</span><span class="schwarz"> {</span><br/>  <span class="bold"><samp class="listingcharacter listingcharacter">@ApiProperty({ <br/>    description: <span class="hellblau">'Id of the movie'</span><span class="schwarz">, </span><br/>    example: 1 <br/>  })</samp></span><br/>  @PrimaryGeneratedColumn()<br/>  id: number;<br/> <br/>  <span class="bold"><samp class="listingcharacter listingcharacter">@ApiProperty({<br/>    description: <span class="hellblau">'Title of the movie'</span><span class="schwarz">,</span><br/>    example: <span class="hellblau">'Iron Man'</span><span class="schwarz">,</span><br/>  })</samp></span><br/>  @Column()<br/>  title: string;<br/> <br/>  <span class="bold"><samp class="listingcharacter listingcharacter">@ApiProperty({<br/>    description: <span class="hellblau">'Year the movie was released'</span><span class="schwarz">,</span><br/>    example: 2008,<br/>  })</samp></span><br/>  @Column()<br/>  year: number;<br/>} <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 14.25</b>    
            Using the ApiProperty Decorator (src/movie/movie.entity.ts)</p>
        <p class="standard">You use the <samp class="listingcharacter listingcharacter">ApiProperty</samp> decorator<a class="indexanchor" id="i14_116"/> to specify that a particular property should be visible in the API documentation. You can also include further details such as a description or concrete examples of values. You can proceed similarly in the controller and also add additional documentation here via decorators. Typically, you use the <samp class="listingcharacter listingcharacter">ApiOkResponse</samp> decorator<a class="indexanchor" id="i14_117"/> in this context to define a description and optionally other details for a successful request, as shown in <span class="crossreference "><a href="14_008.html#l14.26">Listing 14.26</a></span>.</p>
        <div class="listing " id="l14.26"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  Body<span class="schwarz">,</span><span class="schwarz"><br/></span>  Controller<span class="schwarz">,</span><span class="schwarz"><br/></span>  Delete<span class="schwarz">,</span><span class="schwarz"><br/></span>  Get<span class="schwarz">,</span><span class="schwarz"><br/></span>  HttpCode<span class="schwarz">,</span><span class="schwarz"><br/></span>  Param<span class="schwarz">,</span><span class="schwarz"><br/></span>  Post<span class="schwarz">,</span><span class="schwarz"><br/></span>  Put<span class="schwarz">,</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'@nestjs/common'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot"><a id="p441"/>import</span><span class="schwarz"> { ApiOkResponse, ApiTags } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'@nestjs/swagger'</span><span class="schwarz">;</span></samp></span><br/><span class="rot">import</span><span class="schwarz"> { Movie } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie.entity'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { InputMovie } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie.interface'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { MovieService } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie.service'</span><span class="schwarz">;</span><br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter">@ApiTags(<span class="hellblau">'movies'</span><span class="schwarz">)</span></samp></span><br/>@Controller(<span class="hellblau">'movie'</span><span class="schwarz">)</span><br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">class MovieController</span><span class="schwarz"> {</span><br/>  constructor(<span class="rot">private</span><span class="schwarz"> readonly movieService: MovieService) {}</span><br/> <br/>  <span class="bold"><samp class="listingcharacter listingcharacter">@ApiOkResponse({ description: <span class="hellblau">'All available Movies'</span><span class="schwarz"> })</span></samp></span><br/>  @Get()<br/>  getAllMovies(): Promise<span class="dunkelblau">&lt;</span><span class="schwarz">Movie[]</span><span class="dunkelblau">&gt;</span><span class="schwarz"> {</span><br/>    <span class="rot">return</span><span class="schwarz"> </span><span class="rot">this</span><span class="schwarz">.movieService.getAllMovies();</span><br/>  }<br/> <br/>  <span class="bold"><samp class="listingcharacter listingcharacter">@ApiOkResponse({ description: <span class="hellblau">'The movie matching the given id'</span><span class="schwarz"> })</span></samp></span><br/>  @Get(<span class="hellblau">':id'</span><span class="schwarz">)</span><br/>  getOneMovie(@Param(<span class="hellblau">'id'</span><span class="schwarz">) id: string): Promise</span><span class="dunkelblau">&lt;</span><span class="schwarz">Movie</span><span class="dunkelblau">&gt;</span><span class="schwarz"> {</span><br/>    <span class="rot">return</span><span class="schwarz"> </span><span class="rot">this</span><span class="schwarz">.movieService.getOneMovie(parseInt(id, 10));</span><br/>  }<br/> <br/>  <span class="bold"><samp class="listingcharacter listingcharacter">@ApiOkResponse({ description: <span class="hellblau">'The newly created movie'</span><span class="schwarz"> })</span></samp></span><br/>  @Post()<br/>  createNewMovie(@Body() movie: InputMovie): Promise<span class="dunkelblau">&lt;</span><span class="schwarz">Movie</span><span class="dunkelblau">&gt;</span><span class="schwarz"> {</span><br/>    <span class="rot">return</span><span class="schwarz"> </span><span class="rot">this</span><span class="schwarz">.movieService.createNewMovie(movie);</span><br/>  }<br/> <br/>  <span class="bold"><samp class="listingcharacter listingcharacter">@ApiOkResponse({ description: <span class="hellblau">'The updated movie'</span><span class="schwarz"> })</span></samp></span><br/>  @Put(<span class="hellblau">':id'</span><span class="schwarz">)</span><br/>  udpateMovie(@Param(<span class="hellblau">'id'</span><span class="schwarz">) id: string, @Body() movie: Movie): Promise</span><span class="dunkelblau">&lt;</span><span class="schwarz">Movie</span><span class="dunkelblau">&gt;</span><span class="schwarz"> {</span><br/>    <span class="rot">return</span><span class="schwarz"> </span><span class="rot">this</span><span class="schwarz">.movieService.udpateMovie(parseInt(id, 10), movie);</span><br/>  }<br/> <br/>  <span class="bold"><samp class="listingcharacter listingcharacter">@ApiOkResponse({ description: <span class="hellblau">'Nothing'</span><span class="schwarz"> })</span></samp></span><br/>  @Delete(<span class="hellblau">':id'</span><span class="schwarz">)</span><br/>  @HttpCode(204)<br/>  removeMovie(@Param(<span class="hellblau">'id'</span><span class="schwarz">) id: string): </span><span class="rot">void</span><span class="schwarz"> {</span><br/>    <span class="rot">this</span><span class="schwarz">.movieService.removeMovie(parseInt(id, 10));</span><br/>  }<br/>} <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 14.26</b>    
            Documentation of the Movie Controller (src/movie/movie.controller.ts)</p>
        <p class="standard">With these changes to your application, you can go to <span class="italic">http://localhost:3000/api</span> in the browser and view the API documentation<a class="indexanchor" id="i14_118"/>. <span class="crossreference "><a href="14_008.html#f14.3">Figure 14.3</a></span> shows an example of such a view.</p>
        <div class="imagebox figure-type"><a href="img-f14.3.html" id="f14.3"><img alt="API Documentation of the MovieDB Application" id="img-f14.3" src="bilderklein/klein14_003.png"/></a></div>
        <p class="caption "><b>Figure 14.3</b>    
            <a id="p442"/>API Documentation of the MovieDB Application</p>
        <p class="standard">What is still missing in your application now, according to the documentation, is a way for your users to log in and a means to protect your resources from unauthorized access. Both will be discussed in the following sections.</p>
    </div><p class="signatur"/>
                    </body>
                </html>