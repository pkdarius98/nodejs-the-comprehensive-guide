<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Deno" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Deno" name="description"/>
            <meta content="en" name="language"/>
            <title>Deno</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h28.5">28.5    Web Server with Deno<a class="indexanchor" id="i28_43"/></h2>
        <p class="standard">The basic concept of Node.js and Deno is the same. Both platforms make JavaScript available to you outside the browser. The primary use of Deno and Node.js is the implementation of dynamic web servers, so Deno also includes a number of structures that allow you to implement such a web server. <span class="crossreference "><a href="28_005.html#l28.16">Listing 28.16</a></span> shows the implementation of a simple web server. A detailed explanation follows right after.</p>
        <div class="listing " id="l28.16"><pre><span class="rot">const</span><span class="schwarz"> server </span><span class="dunkelblau">=</span><span class="schwarz"> Deno</span><span class="schwarz">.listen({</span><span class="schwarz"> port</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">8080</span><span class="schwarz"> </span><span class="schwarz">});</span><span class="schwarz"><br/></span><span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Server is listening to http://localhost:8080'</span><span class="schwarz">);</span><span class="schwarz"><br/></span> <br/><span class="rot">for</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="rot">const</span><span class="schwarz"> connection </span><span class="rot">of</span><span class="schwarz"> server</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="schwarz">handleConnection(</span><span class="schwarz">connection</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span> <br/><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">handleConnection(</span><span class="schwarz">connection</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> httpConnection </span><span class="dunkelblau">=</span><span class="schwarz"> Deno</span><span class="schwarz">.serveHttp(</span><span class="schwarz">connection</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="rot">for</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="rot">const</span><span class="schwarz"> request </span><span class="rot">of</span><span class="schwarz"> httpConnection</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">const</span><span class="schwarz"> responseBody </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="hellblau">'Hello Deno!'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/>    request<span class="schwarz">.respondWith(</span><span class="schwarz"><br/></span>      <span class="rot">new </span><span class="schwarz">Response(</span><span class="schwarz">responseBody</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>        status<span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">200,</span><span class="schwarz"><br/></span>        headers<span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>          <span class="hellblau">'content-type'</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'text/plain'</span><span class="schwarz">,</span><span class="schwarz"><br/></span>        <span class="schwarz">},</span><span class="schwarz"><br/></span>      <span class="schwarz">}),</span><span class="schwarz"><br/></span>    <span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 28.16</b>    
            Web Server in Deno</p>
        <p class="standard">Calling the <samp class="listingcharacter listingcharacter">listen</samp> function<a class="indexanchor" id="i28_44"/> instructs Deno to listen to the specified address-port combination<a class="indexanchor" id="i28_45"/>. The platform binds itself to this address. If you don’t specify a host name, but only a port, as in this example, Deno listens to the address <samp class="listingcharacter listingcharacter">0.0.0.0</samp>, which represents all available addresses of the system in this case. As a return, you receive a <samp class="listingcharacter listingcharacter">listener</samp> object that stands for the established connection. After this operation, your server is ready to accept incoming connections, so you can output on the console that the server is ready. What is still missing at this point is the actual handling of the requests, and Deno solves <a id="p804"/>this via an asynchronous iterator. The <samp class="listingcharacter listingcharacter">for await</samp> loop makes sure that the loop body is executed for each incoming connection and accordingly calls the <samp class="listingcharacter listingcharacter">handleConnection</samp> function with the <samp class="listingcharacter listingcharacter">connection</samp> object representing the connection.</p>
        <p class="standard">The core of your server is the asynchronous <samp class="listingcharacter listingcharacter">handleConnection</samp> function. The <samp class="listingcharacter listingcharacter">connection</samp> object allows you to call the <samp class="listingcharacter listingcharacter">serveHttp</samp> function of Deno and get a representation of an HTTP connection as a return value. Because you can receive not only one but several requests in this type of connection, you’ll again need an asynchronous iterator that is executed for each incoming request. Here you can access the request and also formulate responses using the <samp class="listingcharacter listingcharacter">respondWith</samp> method of the <samp class="listingcharacter listingcharacter">request</samp> object.</p>
        <p class="standard">You encapsulate a response in an instance of the response class, whose first argument is the body<a class="indexanchor" id="i28_46"/> of the response. As a second argument, you can specify the response in more detail, for example, by defining the status code or certain header fields<a class="indexanchor" id="i28_47"/>.</p>
        <p class="standard">For your server to work, you need to use the permissions system<a class="indexanchor" id="i28_48"/> of Deno again and share network access. As with file system access, you can be very selective here. Once you know that the server will be bound to the address <samp class="listingcharacter listingcharacter">0.0.0.0:8080</samp>, you’ll need to release only that address. <span class="crossreference "><a href="28_005.html#l28.17">Listing 28.17</a></span> contains the command to start the server.</p>
        <div class="listing " id="l28.17"><pre>$ <span class="bold"><samp class="listingcharacter listingcharacter">deno run --allow-net=0.0.0.0:8080 index.js</samp></span><br/>Server is listening to http://localhost:8080 </pre></div>
        <p class="caption "><b>Listing 28.17</b>    
            Running the Web Server</p>
        <p class="standard">Now you can go to your browser and connect to the address <span class="italic">http://localhost:8080/</span>. The results are shown in <span class="crossreference "><a href="28_005.html#f28.1">Figure 28.1</a></span>.</p>
        <div class="imagebox figure-type"><a href="img-f28.1.html" id="f28.1"><img alt="Response of the Deno Web Server in the Browser" id="img-f28.1" src="bilderklein/klein28_001.png"/></a></div>
        <p class="caption "><b>Figure 28.1</b>    
            Response of the Deno Web Server in the Browser</p>
        <p class="standard">Up to this point, your applications have merely been run in one file. Because Deno also supports the ECMAScript module system, it’s not necessary to restrict yourself to only one file. The following sections will introduce you to the module system of Deno.</p>
    </div><p class="signatur"/>
                    </body>
                </html>