<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Express" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Express" name="description"/>
            <meta content="en" name="language"/>
            <title>Express</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h6.7">6.7    Extended Routing<a class="indexanchor" id="i06_65"/>: Deleting Data Records</h2>
        <p class="standard">Until now, the functionality of your application is limited to the display of data. In the next step, you provide your users with the option to delete data, as shown in <span class="crossreference "><a href="06_007.html#l6.20">Listing 6.20</a></span>. To do this, you must first insert one link per record in the frontend. This link leads to a route on the server that takes care of deleting the record. After the deletion is done, you must redirect the user to the list so that the view gets updated.</p>
        <div class="listing " id="l6.20"><pre><span class="dunkelblau">&lt;</span><span class="schwarz">table</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span>  <span class="dunkelblau">&lt;</span><span class="schwarz">thead</span><span class="dunkelblau">&gt;&lt;</span><span class="schwarz">tr</span><span class="dunkelblau">&gt;&lt;</span><span class="schwarz">th</span><span class="dunkelblau">&gt;</span><span class="schwarz">Id</span><span class="dunkelblau">&lt;/</span><span class="schwarz">th</span><span class="dunkelblau">&gt;&lt;</span><span class="schwarz">th</span><span class="dunkelblau">&gt;</span><span class="schwarz">Title</span><span class="dunkelblau">&lt;/</span><span class="schwarz">th</span><span class="dunkelblau">&gt;</span><span class="bold"><samp class="listingcharacter listingcharacter">&lt;<span class="schwarz">th</span><span class="dunkelblau">&gt;&lt;/</span><span class="schwarz">th</span><span class="dunkelblau">&gt;</span></samp></span>&lt;/<span class="schwarz">tr</span><span class="dunkelblau">&gt;&lt;/</span><span class="schwarz">thead</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span>  <span class="dunkelblau">&lt;</span><span class="schwarz">tbody</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span>    ${movies<br/>      .map(<br/>        movie <span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="violett">`</span><br/>        &lt;tr&gt;<br/>          &lt;td&gt;${movie.id}&lt;/td&gt;<br/>          &lt;td&gt;${movie.title}&lt;/td&gt;<br/>          <span class="bold">&lt;td&gt;&lt;a href=<span class="hellblau">"/movie/delete/${movie.id}"</span><span class="violett">&gt;delete&lt;/a&gt;&lt;/td&gt;</span></span><br/>        &lt;/tr&gt;`<span class="schwarz">,</span><br/>      )<br/>      .join(<span class="hellblau">''</span><span class="schwarz">)}</span><br/>  <span class="dunkelblau">&lt;/</span><span class="schwarz">tbody</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span><span class="dunkelblau">&lt;/</span><span class="schwarz">table</span><span class="dunkelblau">&gt;</span><span class="schwarz"> </span><span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 6.20</b>    
            Extending the Template with a Delete Link (movie/view.js)</p>
        <p class="standard">The routing functions in Express support all available HTTP methods, including, for example, the <samp class="listingcharacter listingcharacter">DELETE</samp> method. This should normally be the preferred way of deleting data, as each HTTP method has a specific meaning. In classic web applications, however, the only method you can invoke through a link is <samp class="listingcharacter listingcharacter">GET</samp>. For this reason, you must add an appropriate <samp class="listingcharacter listingcharacter">get</samp> route to your router for deleting data records. In <span class="crossreference "><a href="10_001.html#h10">Chapter 10</a></span>, <a id="p200"/>when you implement a representational state transfer (REST) server, the situation is different. When you take a look at the delivered source code, you’ll notice that each link in the table looks different because you specify the ID of the record you want to delete. This leads to a peculiarity in specifying the path in the router link. In this case, the link contains a variable portion representing the ID you can access through the <samp class="listingcharacter listingcharacter">request</samp> object. You must mark such a variable<a class="indexanchor" id="i06_66"/> in the specification of the path of the routing function by a colon followed by the name of the variable. <span class="crossreference "><a href="06_007.html#l6.21">Listing 6.21</a></span> shows the modification at the router.</p>
        <div class="listing " id="l6.21"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> Router </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> listAction</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">removeAction</samp></span> } <span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./controller.js'</span><span class="schwarz">;</span><br/> <br/><span class="rot">const</span><span class="schwarz"> router </span><span class="dunkelblau">=</span><span class="schwarz"> Router();</span><br/> <br/>router.get(<span class="hellblau">'/'</span><span class="schwarz">, listAction);</span><br/><span class="bold"><samp class="listingcharacter listingcharacter">router.get(<span class="hellblau">'/delete/:id'</span><span class="schwarz">, removeAction);</span><br/> </samp></span><br/><span class="rot">export</span><span class="schwarz"> { router }; </span><span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 6.21</b>    
            Extending the Router with a Delete Route (movie/index.js)</p>
        <p class="standard">In the <samp class="listingcharacter listingcharacter">removeAction</samp> of the controller, you can access the variables of the route via the <samp class="listingcharacter listingcharacter">params</samp> object of the request. In this case, you can reach the ID passed by the user via <samp class="listingcharacter listingcharacter">request.params.id</samp>. Here you should note that Express interprets the transmitted values as strings. To be able to continue using the ID later, you should convert it to a number via the <samp class="listingcharacter listingcharacter">parseInt</samp><a class="indexanchor" id="i06_67"/> function. <span class="crossreference "><a href="06_007.html#l6.22">Listing 6.22</a></span> contains the source code of the controller.</p>
        <div class="listing " id="l6.22"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> getAll</span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">, remove</samp></span> } <span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./model.js'</span><span class="schwarz">;s</span><br/><span class="rot">import</span><span class="schwarz"> { render } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./view.js'</span><span class="schwarz">;</span><br/> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> listAction(request, response) {...}</span><br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter"><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> removeAction(request, response) {</span><br/>  <span class="rot">const</span><span class="schwarz"> id </span><span class="dunkelblau">=</span><span class="schwarz"> parseInt(request.params.id, 10);</span><br/>  <span class="rot">await</span><span class="schwarz"> remove(id);</span><br/>  response.redirect(request.baseUrl);</samp></span><br/>} <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 6.22</b>    
            “removeAction” of the Controller (movie/controller.js)</p>
        <p class="standard">Once you’ve converted the ID, you can call the <samp class="listingcharacter listingcharacter">remove</samp> method of the model, which will make sure that the corresponding record in the data source gets deleted. This operation is also asynchronous and works with promises, so put <samp class="listingcharacter listingcharacter">async</samp>/<samp class="listingcharacter listingcharacter">await</samp><a class="indexanchor" id="i06_68"/> here<a class="indexanchor" id="i06_69"/><a class="indexanchor" id="i06_70"/>. After the operation is complete, you must redirect the user to the list using the <samp class="listingcharacter listingcharacter">response.redirect</samp> method. Here you can see another feature of the modular structure of an application: <a id="p201"/>instead of redirecting directly to <samp class="listingcharacter listingcharacter">"/movie/"</samp> in the <samp class="listingcharacter listingcharacter">redirect</samp> method, the <samp class="listingcharacter listingcharacter">baseUrl</samp> property of the <samp class="listingcharacter listingcharacter">request</samp> object is used in this case. The reason for this is that the movie module itself doesn’t know the base URL for which it’s responsible. To avoid a tight coupling between the embedding location and the module here, you must use the <samp class="listingcharacter listingcharacter">baseUrl</samp> property<a class="indexanchor" id="i06_71"/> that contains the information. This allows you to change the <samp class="listingcharacter listingcharacter">baseUrl</samp> in the <span class="italic">index.js</span> file at a later stage without having to modify the module.</p>
        <p class="standard">Finally, the <samp class="listingcharacter listingcharacter">remove</samp> method of the model filters out the data record to be deleted from the data source and overwrites the data source with the updated information. <span class="crossreference "><a href="06_007.html#l6.23">Listing 6.23</a></span> shows the corresponding implementation.</p>
        <div class="listing " id="l6.23"><pre><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">let</span></samp></span><span class="schwarz"> data </span><span class="dunkelblau">=</span><span class="schwarz"> [...];</span><br/><br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> getAll() {</span><br/>  <span class="rot">return</span><span class="schwarz"> Promise.resolve(data);</span><br/>}<br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter"><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> remove(id) {</span><br/>  data <span class="dunkelblau">=</span><span class="schwarz"> data.filter(movie </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> movie.id </span><span class="dunkelblau">!==</span><span class="schwarz"> id);</span><br/>  <span class="rot">return</span><span class="schwarz"> Promise.resolve();</span><br/>}</samp></span> <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 6.23</b>    
            Customization on the Model (movie/model.js)</p>
        <p class="standard">Note that in the model implementation, to clear the data, you must change the <samp class="listingcharacter listingcharacter">data</samp> array from a constant to a variable via <samp class="listingcharacter listingcharacter">let</samp>.</p>
    </div><p class="signatur"/>
                    </body>
                </html>