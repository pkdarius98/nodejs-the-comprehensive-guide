<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Testing" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Testing" name="description"/>
            <meta content="en" name="language"/>
            <title>Testing</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h23.4">23.4    Jest<a class="indexanchor" id="i23_65"/></h2>
        <p class="standard">Currently, one of the most popular testing frameworks is <span class="italic">Jest</span>, the JavaScript testing framework from Facebook. Jest is actually a frontend framework. Unlike Jasmine, it also provides the infrastructure for frontend testing. Usually, the tests are run in the browser. Jest takes a different approach here and simulates the browser environment with a library called <samp class="listingcharacter listingcharacter">jsdom</samp><a class="indexanchor" id="i23_66"/>. The advantage of this approach is that the tests run much faster than in the regular browser. However, Jest isn’t limited to the frontend as it can also be used in the backend in Node.js.</p>
        
            <h3 class="t3" id="h23.4.1">23.4.1    Installation<a class="indexanchor" id="i23_67"/></h3>
            <p class="standard">To run the test, you need the <samp class="listingcharacter listingcharacter">jest</samp> command-line tool that’s part of the Jest package and is based on Node.js. Jest is available as an npm package and, like Jasmine, can be installed globally or, even better, locally. If you install it globally, you can use Jest system-wide. For a local installation, you run Jest either with <samp class="listingcharacter listingcharacter">npx</samp> or as an npm script. <span class="crossreference "><a href="23_004.html#l23.22">Listing 23.22</a></span> shows the command line required for local installation.</p>
            <div class="listing " id="l23.22"><pre>npm install <span class="dunkelblau">-</span><span class="schwarz">D jest </span></pre></div>
            <p class="caption "><b>Listing 23.22</b>    
            Installing “jest”</p>
            <p class="standard"><a id="p672"/>After the installation, you can use <samp class="listingcharacter listingcharacter">jest</samp> in a similar way as Jasmine. You specify the <samp class="listingcharacter listingcharacter">jest</samp> command and the file containing your tests, and <samp class="listingcharacter listingcharacter">jest</samp> takes care of running<a class="indexanchor" id="i23_68"/> the tests on its own. Alternatively, you can specify an entire directory, and <samp class="listingcharacter listingcharacter">jest</samp> will run all the tests it contains. Another option is that you simply run the <samp class="listingcharacter listingcharacter">jest</samp> command, and the framework will run all the tests of your application. Unlike Jasmine, Jest doesn’t require any further configuration.</p>
        
        
            <h3 class="t3" id="h23.4.2">23.4.2    First Test<a class="indexanchor" id="i23_69"/></h3>
            <p class="standard">Jest uses the same syntax as Jasmine, so switching between the two frameworks is relatively easy. Unlike Jasmine, however, Jest supports native ECMAScript modules in the tests. But this feature is currently still an experiment, and you need to enable it manually. The simplest variant involves using an environment variable named <samp class="listingcharacter listingcharacter">NODE_OPTIONS</samp>. <span class="crossreference "><a href="23_004.html#l23.23">Listing 23.23</a></span> contains an example of a <span class="italic">package.json</span> file with a test script where you enable the <samp class="listingcharacter listingcharacter">-experimental-vm-modules</samp> option.</p>
            <div class="listing " id="l23.23"><pre><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="hellblau">"name"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"node-book"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"version"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"1.0.0"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"main"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"index.js"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"private"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"type"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"module"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"scripts"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="hellblau">"test"</span><span class="schwarz">: </span><span class="hellblau">"NODE_OPTIONS=--experimental-vm-modules jest"</span></samp></span><span class="schwarz"><br/></span>  },<br/>  <span class="hellblau">"license"</span><span class="schwarz">: </span><span class="hellblau">"ISC"</span><span class="schwarz">,</span><br/>  <span class="hellblau">"devDependencies"</span><span class="schwarz">: {</span><br/>    <span class="hellblau">"jest"</span><span class="schwarz">: </span><span class="hellblau">"^27.1.0"</span><span class="schwarz"><br/></span>  }<br/>} <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 23.23</b>    
            Enabling ECMAScript Modules (package.json)</p>
            <p class="standard">Then, you can formulate your test. <span class="crossreference "><a href="23_004.html#l23.24">Listing 23.24</a></span> shows the implementation of a <samp class="listingcharacter listingcharacter">calc</samp> class, which has an <samp class="listingcharacter listingcharacter">add</samp> method that allows you to add two numbers. The class is provided as a default export.</p>
            <div class="listing " id="l23.24"><pre><span class="rot">export</span><span class="schwarz"> </span><span class="rot">default</span><span class="schwarz"> </span><span class="rot">class Calc</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="schwarz">add(</span><span class="schwarz">a</span><span class="schwarz">,</span><span class="schwarz"> b</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">return</span><span class="schwarz"> a </span><span class="dunkelblau">+</span><span class="schwarz"> b</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 23.24</b>    
            Implementing the Class to Be Tested (calc.js)</p>
            <p class="standard"><a id="p673"/>As already mentioned, the test for this class looks very similar to the previous Jasmine tests. <span class="crossreference "><a href="23_004.html#l23.25">Listing 23.25</a></span> contains the corresponding source code.</p>
            <div class="listing " id="l23.25"><pre><span class="rot">import</span><span class="schwarz"> Calc </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./calc.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="schwarz">describe(</span><span class="hellblau">'Calc'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">let</span><span class="schwarz"> calc</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="schwarz">beforeEach(()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    calc <span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Calc();</span><span class="schwarz"><br/></span>  <span class="schwarz">});</span><span class="schwarz"><br/></span> <br/>  <span class="schwarz">describe(</span><span class="hellblau">'add'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="schwarz">it(</span><span class="hellblau">'should add 1 and 1 and return 2'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>      <span class="rot">const</span><span class="schwarz"> result </span><span class="dunkelblau">=</span><span class="schwarz"> calc</span><span class="schwarz">.add(1,</span><span class="schwarz"> </span><span class="schwarz">1);</span><span class="schwarz"><br/></span>      <span class="schwarz">expect(</span><span class="schwarz">result</span><span class="schwarz">).toBe(2);</span><span class="schwarz"><br/></span>    <span class="schwarz">});</span><span class="schwarz"><br/></span>  <span class="schwarz">});</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 23.25</b>    
            Test for the “calc class” (calc.test.js)</p>
            <p class="standard">You can assign either the <span class="italic">.spec.js</span> or <span class="italic">.test.js</span> extension to the test file. Jest finds both variants automatically. In the test itself, you first import the class to be tested and create a new test suite via the <samp class="listingcharacter listingcharacter">describe</samp><a class="indexanchor" id="i23_70"/> function. Within this first test suite, you use the <samp class="listingcharacter listingcharacter">beforeEach</samp><a class="indexanchor" id="i23_71"/> function to create a new instance of the <samp class="listingcharacter listingcharacter">calc</samp> class prior to each test. Then you generate another test suite within the <samp class="listingcharacter listingcharacter">calc</samp> suite for the <samp class="listingcharacter listingcharacter">add</samp> functionality. In this grouping, you then formulate the test that is to check whether the <samp class="listingcharacter listingcharacter">add</samp> method calculates correctly.</p>
            <p class="standard">If you run the test via the <samp class="listingcharacter listingcharacter">npm test</samp> command, you’ll receive a result like the one shown in <span class="crossreference "><a href="23_004.html#l23.26">Listing 23.26</a></span>.</p>
            <div class="listing " id="l23.26"><pre><span class="violett">$ </span><span class="bold"><samp class="listingcharacter listingcharacter">npm <span class="hellblau">test</span><span class="violett"><br/></span></samp></span><br/>&gt; node-book@1.0.0 <span class="hellblau">test</span><span class="violett"><br/></span>&gt; <span class="hellblau">NODE_OPTIONS</span><span class="violett">=--experimental-vm-modules jest</span><br/><br/>(node:42700) <span class="hellblau">ExperimentalWarning</span><span class="violett">: </span><span class="hellblau">VM</span><span class="violett"> </span><span class="hellblau">Modules</span><span class="violett"> is an experimental feature. </span><span class="hellblau">This</span><span class="violett"> feature could change at any time</span><br/>(<span class="hellblau">Use</span><span class="violett"> `node --</span><span class="hellblau">trace</span><span class="violett">-warnings ...` to </span><span class="hellblau">show</span><span class="violett"> </span><span class="hellblau">where</span><span class="violett"> the warning was created)</span><br/> <span class="hellblau">PASS</span><span class="violett">  ./calc.</span><span class="hellblau">test</span><span class="violett">.js</span><br/>  <span class="hellblau">Calc</span><span class="violett"><br/></span>    <span class="hellblau">add</span><span class="violett"><br/></span>      ✓ should <span class="hellblau">add</span><span class="violett"> 1 and 1 and return 2 (1 ms)</span><br/><br/><span class="hellblau">Test</span><span class="violett"> </span><span class="hellblau">Suites</span><span class="violett">: 1 passed, 1 total</span><br/><span class="hellblau"><a id="p674"/>Tests</span><span class="violett">:       1 passed, 1 total</span><br/><span class="hellblau">Snapshots</span><span class="violett">:   0 total</span><br/><span class="hellblau">Time</span><span class="violett">:        0.548 s</span><br/><span class="hellblau">Ran</span><span class="violett"> all </span><span class="hellblau">test</span><span class="violett"> suites.</span><span class="schwarz"> </span><span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 23.26</b>    
            Output of the npm Test Command</p>
            <p class="standard">The warning in the output originates from the <samp class="listingcharacter listingcharacter">-experimental-vm-modules</samp> option. You can either ignore it or suppress it using the <samp class="listingcharacter listingcharacter">--no-warnings</samp> option.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>