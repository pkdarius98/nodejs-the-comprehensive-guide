<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Express" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Express" name="description"/>
            <meta content="en" name="language"/>
            <title>Express</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h6.10">6.10    HTTPS and HTTP/2<a class="indexanchor" id="i06_82"/><a class="indexanchor" id="i06_83"/></h2>
        <p class="standard">Because Express is based on the HTTP module of Node.js, the framework is quite flexible when it comes to exchanging the communication protocol.</p>
        
            <h3 class="t3" id="h6.10.1">6.10.1    HTTPS</h3>
            <p class="standard">Instead of HTTP, you can also use the secure HTTPS variant recommended for productive applications. For this, you don’t need to do anything more than pass the <samp class="listingcharacter listingcharacter">app</samp> object you created by calling the <samp class="listingcharacter listingcharacter">express</samp> function to the <samp class="listingcharacter listingcharacter">createServer</samp> method of the <samp class="listingcharacter listingcharacter">https</samp> module<a class="indexanchor" id="i06_84"/>.</p>
            <p class="standard"><span class="crossreference "><a href="06_010.html#l6.33">Listing 6.33</a></span> contains the necessary customizations to deliver your movie database with HTTPS. The example assumes that you’ve issued yourself a self-signed certificate<a class="indexanchor" id="i06_85"/> and saved the files in the <span class="italic">cert</span> directory as in <span class="crossreference "><a href="05_001.html#h5">Chapter 5</a></span>, <span class="crossreference "><a href="05_003.html#h5.3">Section 5.3</a></span>. When you restart the server after these adjustments, you can reach your application at <span class="italic">https://localhost:8080</span>.</p>
            <div class="listing " id="l6.33"><pre><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> { createServer } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'https'</span><span class="schwarz">; </span><br/><span class="rot">import</span><span class="schwarz"> { readFileSync } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'fs'</span><span class="schwarz">;</span></samp></span><br/><span class="rot">import</span><span class="schwarz"> express </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> morgan </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'morgan'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { dirname } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'path'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { fileURLToPath } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'url'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { router </span><span class="rot">as</span><span class="schwarz"> movieRouter } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie/index.js'</span><span class="violett">;</span><br/><br/>const app = express();<br/><br/>app.use(express.static(`${dirname(fileURLToPath(import.meta.url))}/public`));<br/><br/>app.use(morgan(<span class="hellblau">'common'</span><span class="violett">, { immediate: true }));</span><br/><br/>app.use(express.urlencoded({ extended: false }));<br/><br/>app.use(<span class="hellblau">'/movie'</span><span class="violett">, movieRouter);</span><br/><br/>app.get(<span class="hellblau">'/'</span><span class="violett">, (request, response) =&gt; response.redirect(</span><span class="hellblau">'/movie'</span><span class="violett">));</span><br/><br/><span class="bold"><samp class="listingcharacter listingcharacter"><a id="p210"/>const options = {<br/>  <span class="magenta">key</span><span class="violett">: readFileSync(</span><span class="hellblau">'./cert/localhost.key'</span><span class="violett">),</span><br/>  cert: readFileSync(<span class="hellblau">'./cert/localhost.cert'</span><span class="violett">),</span><br/>};<br/><br/>createServer(options, app).listen(8080, () =&gt; {<br/>  <span class="magenta">console</span><span class="violett">.log(</span><span class="hellblau">'Server is listening to https://localhost:8080'</span><span class="schwarz">);</span><br/>});</samp></span> <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 6.33</b>    
            Express with HTTPS</p>
        
        
            <h3 class="t3" id="h6.10.2">6.10.2    HTTP/2<a class="indexanchor" id="i06_86"/></h3>
            <p class="standard">The integration of HTTP/2 works similar to HTTPS. However, the problem here is that Express version 4 isn’t compatible with the HTTP/2 module of Node.js. Therefore, you have to switch to the <samp class="listingcharacter listingcharacter">spdy</samp> module at this point. Native support is planned for version 5.</p>
            <p class="standard">You can install the <samp class="listingcharacter listingcharacter">spdy</samp> module using the <samp class="listingcharacter listingcharacter">npm install spdy</samp> command. The name of this module is somewhat misleading, as it not only supports SPDY but also HTTP/2. SPDY<a class="indexanchor" id="i06_87"/> is a protocol developed by Google to replace HTTP in version 1. The HTTP/2 protocol picks up some concepts from the SPDY protocol.</p>
            <p class="standard">The <samp class="listingcharacter listingcharacter">spdy</samp> module is API compatible with the <samp class="listingcharacter listingcharacter">http</samp> and <samp class="listingcharacter listingcharacter">https</samp> modules of Node.js, so it combines well with Express. With regard to the integration, you can proceed in a similar way as you did before with the HTTPS integration. As you can see in <span class="crossreference "><a href="06_010.html#l6.34">Listing 6.34</a></span>, instead of importing the <samp class="listingcharacter listingcharacter">https</samp> module, you must import the <samp class="listingcharacter listingcharacter">spdy</samp> package and call the <samp class="listingcharacter listingcharacter">spdy.createServer</samp> function instead of the <samp class="listingcharacter listingcharacter">createServer</samp> function of the <samp class="listingcharacter listingcharacter">https</samp> module.</p>
            <div class="listing " id="l6.34"><pre><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> spdy </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'spdy'</span><span class="schwarz">;</span></samp></span><br/><span class="rot">import</span><span class="schwarz"> { readFileSync } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'fs'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> express </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> morgan </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'morgan'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { dirname } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'path'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { fileURLToPath } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'url'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { router </span><span class="rot">as</span><span class="schwarz"> movieRouter } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie/index.js'</span><span class="violett">;</span><br/><br/>const app = express();<br/><br/>app.use(express.static(`${dirname(fileURLToPath(import.meta.url))}/public`));<br/><br/>app.use(morgan(<span class="hellblau">'common'</span><span class="violett">, { immediate: true }));</span><br/><br/>app.use(express.urlencoded({ extended: false }));<br/><br/>app.use(<span class="hellblau">'/movie'</span><span class="violett">, movieRouter);</span><br/><br/><a id="p211"/>app.get(<span class="hellblau">'/'</span><span class="violett">, (request, response) =&gt; response.redirect(</span><span class="hellblau">'/movie'</span><span class="violett">));</span><br/><br/>const options = {<br/>  <span class="magenta">key</span><span class="violett">: readFileSync(</span><span class="hellblau">'./cert/localhost.key'</span><span class="violett">),</span><br/>  cert: readFileSync(<span class="hellblau">'./cert/localhost.cert'</span><span class="violett">),</span><br/>};<br/><br/><span class="bold"><samp class="listingcharacter listingcharacter">spdy.createServer</samp></span>(options, app).listen(8080, () =&gt; {<br/>  <span class="magenta">console</span><span class="violett">.log(</span><span class="hellblau">'Server is listening to https://localhost:8080'</span><span class="schwarz">);</span><br/>}); <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 6.34</b>    
            HTTP/2 in Express</p>
            <p class="standard">You can verify that the switch to the HTTP/2 protocol worked by opening your browser’s developer tools and making sure that, as in <span class="crossreference "><a href="06_010.html#f6.10">Figure 6.10</a></span>, the <span class="screenelement">h2</span> protocol is used for loading each resource.</p>
            <div class="imagebox figure-type"><a href="img-f6.10.html" id="f6.10"><img alt="Delivery of Resources via the h2 Protocol" id="img-f6.10" src="bilderklein/klein06_010.png"/></a></div>
            <p class="caption "><b>Figure 6.10</b>    
            Delivery of Resources via the h2 Protocol</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>