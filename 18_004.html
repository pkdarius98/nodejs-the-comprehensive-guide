<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Streams" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Streams" name="description"/>
            <meta content="en" name="language"/>
            <title>Streams</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h18.4">18.4    Duplex Streams<a class="indexanchor" id="i18_71"/></h2>
        <p class="standard">Duplex streams represent a combination of readable streams and writable streams. You can read data from a duplex stream as well as write data into it. The write and read operations of a duplex stream are independent of each other, and each has its own buffer<a class="indexanchor" id="i18_72"/>. A typical implementation of a duplex stream are network sockets as they are used in the <samp class="listingcharacter listingcharacter">net</samp> module.</p>
        
            <h3 class="t3" id="h18.4.1">18.4.1    Duplex Streams in Use</h3>
            <p class="standard">Unfortunately, duplex streams can only be described quite abstractly. Much more understandable here, however, are concrete examples. <span class="crossreference "><a href="18_004.html#l18.17">Listing 18.17</a></span> contains source code that demonstrates the use of a duplex stream.</p>
            <div class="listing " id="l18.17"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> createServer </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'net'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="schwarz">createServer((</span><span class="schwarz">socket</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  socket<span class="schwarz">.on(</span><span class="hellblau">'readable'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span><a id="p567"/>    <span class="rot">const</span><span class="schwarz"> data </span><span class="dunkelblau">=</span><span class="schwarz"> socket</span><span class="schwarz">.read();</span><span class="schwarz"><br/></span>    <span class="magenta">console</span><span class="schwarz">.log(</span><span class="schwarz">data</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="schwarz">});</span><span class="schwarz"><br/></span> <br/>  socket<span class="schwarz">.end(</span><span class="hellblau">'Hello Client'</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">}).listen(4321);</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 18.17</b>    
            Duplex Streams in Use</p>
            <p class="standard">The callback function you pass to the <samp class="listingcharacter listingcharacter">createServer</samp> method is bound to the <samp class="listingcharacter listingcharacter">connection</samp> event of the TCP server. As argument, you get a <samp class="listingcharacter listingcharacter">socket</samp> object of the duplex stream type. On this object, you can call the <samp class="listingcharacter listingcharacter">write</samp> and <samp class="listingcharacter listingcharacter">end</samp> methods as usual to send data to the other endpoint of the connection. However, you can also bind a callback function to the <samp class="listingcharacter listingcharacter">readable</samp> event to handle incoming data.</p>
        
        
            <h3 class="t3" id="h18.4.2">18.4.2    Custom Duplex Streams<a class="indexanchor" id="i18_73"/></h3>
            <p class="standard">Implementing a custom duplex stream is very similar to implementing readable and writable streams, except that, in this case, you must override both the <samp class="listingcharacter listingcharacter">_read</samp><a class="indexanchor" id="i18_74"/> and <samp class="listingcharacter listingcharacter">_write</samp><a class="indexanchor" id="i18_75"/> methods to obtain the desired result. The example in <span class="crossreference "><a href="18_004.html#l18.18">Listing 18.18</a></span> summarizes the steps you must take to implement it.</p>
            <div class="listing " id="l18.18"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> Duplex </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'stream'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">class MyDuplex</span><span class="schwarz"> </span><span class="rot">extends Duplex</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="schwarz">_read(</span><span class="schwarz">n</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">this</span><span class="schwarz">.push(</span><span class="schwarz">chunk</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span> <br/>  <span class="schwarz">_write(</span><span class="schwarz">chunk</span><span class="schwarz">,</span><span class="schwarz"> encoding</span><span class="schwarz">,</span><span class="schwarz"> done</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="schwarz">done();</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> myDuplex </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">MyDuplex();</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 18.18</b>    
            Creating a Custom Duplex Stream</p>
            <p class="standard">The example in <span class="crossreference "><a href="18_004.html#l18.18">Listing 18.18</a></span> is highly simplified, as it simply represents a combination of readable and writable streams, both of which you already know.</p>
        
        
            <h3 class="t3" id="h18.4.3">18.4.3    Duplex Shortcut<a class="indexanchor" id="i18_76"/></h3>
            <p class="standard">The short notation for duplex streams allows you to simplify the source code from <span class="crossreference "><a href="18_004.html#l18.18">Listing 18.18</a></span> even further, as you can see in <span class="crossreference "><a href="18_004.html#l18.19">Listing 18.19</a></span>.</p>
            <div class="listing " id="l18.19"><pre><span class="rot"><a id="p568"/>import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> Duplex </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'stream'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> duplex </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Duplex({</span><span class="schwarz"><br/></span>  <span class="schwarz">read()</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">this</span><span class="schwarz">.push(</span><span class="schwarz">chunk</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="schwarz">write(</span><span class="schwarz">chunk</span><span class="schwarz">,</span><span class="schwarz"> encoding</span><span class="schwarz">,</span><span class="schwarz"> next</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="schwarz">next();</span><span class="schwarz"><br/></span>  <span class="schwarz">},</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 18.19</b>    
            Short Notation for Duplex Streams</p>
            <p class="standard">Duplex streams are a special case of the Node.js stream API. In your applications, you’ll come across this type relatively rarely—in contrast to the last variant of streams, transform streams, which is one of the most frequently used types along with writable and readable streams.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>