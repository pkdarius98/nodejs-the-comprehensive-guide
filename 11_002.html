<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="GraphQL" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - GraphQL" name="description"/>
            <meta content="en" name="language"/>
            <title>GraphQL</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h11.2">11.2    Integration with Express<a class="indexanchor" id="i11_13"/></h2>
        <p class="standard">The basis for implementing the GraphQL interface is the state of the application as we developed it in <span class="crossreference "><a href="10_001.html#h10">Chapter 10</a></span>. Now, before you move on to implementing your GraphQL interface, you first need to install some additional packages: the GraphQL package you already know and the Express middleware for GraphQL called <samp class="listingcharacter listingcharacter">express-graphql</samp><a class="indexanchor" id="i11_14"/>. To do this, you must run the command, <samp class="listingcharacter listingcharacter">npm install graphql express-graphql</samp>.</p>
        <p class="standard">In the first step of integrating GraphQL into your application, you assemble the individual components of the interface so that you can easily extend it later. To do this, you must first create a file named <span class="italic">graphql.js</span> in the root directory of your application. This file contains the schema and the resolvers. It’s responsible for integrating with your Express application. First, you implement the same structure as already shown in the example from <span class="crossreference "><a href="11_001.html#l11.1">Listing 11.1</a></span>. Although this doesn’t yet have much to do with our actual application, it allows you to prepare all the necessary components to such an extent that further integration into the application can take place without any problems. <span class="crossreference "><a href="11_002.html#l11.2">Listing 11.2</a></span> contains the source code of this first version of the file.</p>
        <div class="listing " id="l11.2"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> buildSchema </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'graphql'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> expressGraphql </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express-graphql'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> schema </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">buildSchema(</span><span class="violett">`</span><br/>  type Query {<br/>    greet: String<br/>  }<br/>`<span class="schwarz">);</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> rootValue </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="schwarz">greet()</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">return</span><span class="schwarz"> </span><span class="hellblau">'Hello GraphQL'</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="schwarz">},</span><span class="schwarz"><br/></span><span class="schwarz">};</span><span class="schwarz"><br/></span> <br/><span class="rot"><a id="p340"/>export</span><span class="schwarz"> </span><span class="rot">default</span><span class="schwarz"> expressGraphql</span><span class="schwarz">.graphqlHTTP({</span><span class="schwarz"><br/></span>  schema<span class="schwarz">,</span><span class="schwarz"><br/></span>  rootValue<span class="schwarz">,</span><span class="schwarz"><br/></span>  graphiql<span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 11.2</b>    
            Basic Configuration of the GraphQL Interface (graphql.js)</p>
        <p class="standard">In the first code block, you define the schema. Your users can query the <samp class="listingcharacter listingcharacter">greet</samp> field and receive a character string in return. The second block—the <samp class="listingcharacter listingcharacter">rootValue</samp>—contains the resolver function for the <samp class="listingcharacter listingcharacter">greet</samp> field and returns the string <samp class="listingcharacter listingcharacter">Hello GraphQL</samp> on request. In the last line, you export the result of calling the <samp class="listingcharacter listingcharacter">graphqlHTTP</samp><a class="indexanchor" id="i11_15"/> function as <samp class="listingcharacter listingcharacter">default export</samp>. This allows you to include your GraphQL interface as regular Express middleware in your application. When calling the <samp class="listingcharacter listingcharacter">graphqlHTTP</samp> function from the <samp class="listingcharacter listingcharacter">express-graphql</samp> package, you pass an object with the schema, the resolver functions, and the <samp class="listingcharacter listingcharacter">graphiql</samp> property with the value <samp class="listingcharacter listingcharacter">true</samp>.</p>
        <p class="standard">Before you start writing your GraphQL queries, you still need to embed the functionality into your application. This is done in the <span class="italic">index.js</span> file in the root directory of your application.</p>
        <p class="standard">In the <span class="italic">index.js</span> file of your application, as shown in <span class="crossreference "><a href="11_002.html#l11.3">Listing 11.3</a></span>, you import the <samp class="listingcharacter listingcharacter">default export</samp> of the <span class="italic">graphql.js</span> file you just created and include the function as middleware via the <samp class="listingcharacter listingcharacter">use</samp> method of the <samp class="listingcharacter listingcharacter">app</samp> object for the <span class="italic">/graphql</span> route. After these modifications, you can restart your application and already use the GraphQL interface.</p>
        <div class="listing " id="l11.3"><pre><span class="rot">import</span><span class="schwarz"> express </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> morgan </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'morgan'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> expressJwt </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express-jwt'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> swaggerUi </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'swagger-ui-express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> router </span><span class="rot">as</span><span class="schwarz"> movieRouter </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie/index.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> router </span><span class="rot">as</span><span class="schwarz"> loginRouter </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./auth.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> swaggerSpec </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./swagger.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> graphql </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./graphql.js'</span><span class="schwarz">;</span><br/> </samp></span><br/><span class="rot">const</span><span class="schwarz"> app </span><span class="dunkelblau">=</span><span class="schwarz"> express();</span><br/> <br/>app.use(morgan(<span class="hellblau">'common'</span><span class="schwarz">, { immediate: </span><span class="rot">true</span><span class="schwarz"> }));</span><br/> <br/>app.use(express.json());<br/> <br/>app.use(<span class="hellblau">'/login'</span><span class="schwarz">, loginRouter);</span><br/>app.use(<br/>  <span class="hellblau">'/movie'</span><span class="schwarz">,</span><br/>  expressJwt({ secret: <span class="hellblau">'secret'</span><span class="schwarz">, algorithms: [</span><span class="hellblau">'HS256'</span><span class="schwarz">] }),</span><br/>  movieRouter,<br/><a id="p341"/>);<br/> <br/>app.use((err, request, response, next) <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="rot">if</span><span class="schwarz"> (err.name </span><span class="dunkelblau">===</span><span class="schwarz"> </span><span class="hellblau">'UnauthorizedError'</span><span class="schwarz">) {</span><br/>    response.status(401).json(<span class="hellblau">'unauthorized'</span><span class="schwarz">);</span><br/>  } <span class="rot">else</span><span class="schwarz"> {</span><br/>    next();<br/>  }<br/>});<br/> <br/>app.get(<span class="hellblau">'/'</span><span class="schwarz">, (request, response) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> response.redirect(</span><span class="hellblau">'/movie'</span><span class="schwarz">));</span><br/> <br/>app.use(<span class="hellblau">'/api-docs'</span><span class="schwarz">, swaggerUi.serve, swaggerUi.setup(swaggerSpec));</span><br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter">app.use(<span class="hellblau">'/graphql'</span><span class="schwarz">, graphql);</span><br/> </samp></span><br/>app.listen(8080, () <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Server is listening to http://localhost:8080'</span><span class="schwarz">);</span><br/>}); <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 11.3</b>    
            Integrating the GraphQL Interface in Express (index.js)</p>
    </div><p class="signatur"/>
                    </body>
                </html>