<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Type-Safe Applications in Node.js" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Type-Safe Applications in Node.js" name="description"/>
            <meta content="en" name="language"/>
            <title>Type-Safe Applications in Node.js</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h13.2">13.2    Tools and Configuration<a class="indexanchor" id="i13_21"/></h2>
        <p class="standard">TypeScript was first released in 2012. Since then, a very active community has formed around the type system. Microsoft and Google actively support TypeScript. Google <a id="p393"/>developed its own type system called AtScript as part of Angular 2. However, after some time, this system was discontinued in favor of TypeScript, and TypeScript was used as the type system for Angular instead. Tools are constantly emerging from the TypeScript community that you can integrate into your application development process to make your job easier. We’ll introduce you to some of these tools in the following sections.</p>
        
            <h3 class="t3" id="h13.2.1">13.2.1    Configuring the TypeScript Compiler</h3>
            <p class="standard">One tool—and also a direct component of TypeScript—is the <samp class="listingcharacter listingcharacter">tsc --init</samp> command<a class="indexanchor" id="i13_22"/>, which initializes your application by creating a <span class="italic">tsconfig.json</span> file<a class="indexanchor" id="i13_23"/> for it. You can use this file to affect the behavior of the TypeScript compiler.</p>
            <div class="listing " id="l13.10"><pre><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="hellblau">"compilerOptions"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="hellblau">"target"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"ES2021"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>    <span class="hellblau">"module"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"es2020"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>    <span class="hellblau">"strict"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"><br/></span>    <span class="hellblau">"esModuleInterop"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"><br/></span>    <span class="hellblau">"skipLibCheck"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"> </span><br/>    <span class="hellblau">"forceConsistentCasingInFileNames"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz"> </span><br/>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 13.10</b>    
            tsconfig.json</p>
            <p class="standard"><span class="crossreference "><a href="13_002.html#l13.10">Listing 13.10</a></span> contains a minimal example of a <span class="italic">tsconfig.json</span> file. These are the fields that are set by default during initialization. Only <samp class="listingcharacter listingcharacter">target</samp> and <samp class="listingcharacter listingcharacter">module</samp> were manually adjusted for our needs. The individual details are described here:</p>
            <ul>
                <li>
                    <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter"><span class="bold">target</span></samp><a class="indexanchor" id="i13_24"/><br/>Specifies the target format of the compile process. By default, the value <samp class="listingcharacter listingcharacter">es5</samp> is entered here. However, this results in unnecessary overhead because, for example, the class syntax or arrow functions are replaced by polyfills. The <samp class="listingcharacter listingcharacter">ES2017</samp> target allows you to significantly reduce this overhead.</p>
                </li>
                <li>
                    <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter"><span class="bold">module</span></samp><a class="indexanchor" id="i13_25"/><br/>Tells the compiler which module system to use. If you specify the <samp class="listingcharacter listingcharacter">commonjs</samp> value here, the <samp class="listingcharacter listingcharacter">import</samp> and <samp class="listingcharacter listingcharacter">export</samp> statements in the TypeScript source code become <samp class="listingcharacter listingcharacter">require</samp> and <samp class="listingcharacter listingcharacter">module.exports</samp> statements. If you enter the value <samp class="listingcharacter listingcharacter">es2015</samp> here, the <samp class="listingcharacter listingcharacter">import</samp> and <samp class="listingcharacter listingcharacter">export</samp> statements are retained. However, in this case, you must ensure that the ECMAScript module system is enabled for your Node.js process.</p>
                </li>
                <li>
                    <p class="standard first-item last-item"><span class="bold"><samp class="listingcharacter listingcharacter">strict</samp></span><a class="indexanchor" id="i13_26"/><samp class="listingcharacter listingcharacter"><br/></samp>Activates a stricter mode of type checking. For example, statements with an implicit <samp class="listingcharacter listingcharacter">any</samp> type cause errors. Among some other options, <samp class="listingcharacter listingcharacter">strict-null-checks</samp> are also <a id="p394"/>enabled. This means that the <samp class="listingcharacter listingcharacter">null</samp> and <samp class="listingcharacter listingcharacter">undefined</samp> values are no longer included in each type.</p>
                </li>
                <li>
                    <p class="standard first-item last-item"><span class="bold"><samp class="listingcharacter listingcharacter">esModuleInterop</samp></span><a class="indexanchor" id="i13_27"/><samp class="listingcharacter listingcharacter"><br/></samp>Enables compatibility between CommonJS and ECMAScript modules.</p>
                </li>
                <li>
                    <p class="standard first-item last-item"><span class="bold"><samp class="listingcharacter listingcharacter">skipLibCheck</samp></span><a class="indexanchor" id="i13_28"/><samp class="listingcharacter listingcharacter"><br/></samp>Skips files that contain type declarations during the check.</p>
                </li>
                <li>
                    <p class="standard first-item last-item"><span class="bold"><samp class="listingcharacter listingcharacter">forceConsistentCasingInFileNames</samp></span><a class="indexanchor" id="i13_29"/><samp class="listingcharacter listingcharacter"> <br/></samp>Prohibits different spellings when referring to the same file.</p>
                </li>
            </ul>
        
        
            <h3 class="t3" id="h13.2.2">13.2.2    Integration into the Development Environment</h3>
            <p class="standard"><a class="indexanchor" id="i13_30"/>A big advantage of TypeScript is the immediate feedback in the development process. You don’t have to run your application to identify potential errors. The compile step precedes the execution. If you choose the right architecture and provide all variables and functions with type information, you can eliminate numerous errors. To make the feedback even faster and more direct, plug-ins for TypeScript<a class="indexanchor" id="i13_31"/> exist for all common development environments. Using such a plug-in, you’ll see the errors directly in the source code. Thus, violations of the type system are color-coded and provided with a corresponding error message. So, you don’t have to switch to the command line first and run the compiler yourself, but get the feedback directly and without another intermediate step.</p>
            <p class="standard"><span class="crossreference "><a href="13_002.html#f13.1">Figure 13.1</a></span> shows what the integration into the development environment can look like using the example of Visual Studio Code<a class="indexanchor" id="i13_32"/>.</p>
            <div class="imagebox figure-type"><a href="img-f13.1.html" id="f13.1"><img alt="Error Messages with TypeScript in Visual Studio Code" id="img-f13.1" src="bilderklein/klein13_001.png"/></a></div>
            <p class="caption "><b>Figure 13.1</b>    
            Error Messages with TypeScript in Visual Studio Code</p>
        
        
            <h3 class="t3" id="h13.2.3">13.2.3    <a id="p395"/>ESLint<a class="indexanchor" id="i13_33"/></h3>
            <p class="standard">In addition to type checking with TypeScript, there is the ESLint project, which we’ll discuss in more detail in <span class="crossreference "><a href="22_001.html#h22">Chapter 22</a></span>, <span class="crossreference "><a href="22_002.html#h22.2.1">Section 22.2.1</a></span>. Originally, there was a program for static code analysis of TypeScript source code called TSLint. However, TSLint has since been integrated into ESLint, so as a developer, you only need one tool for JavaScript and TypeScript analysis. ESLint is generally used to increase the quality, readability, and maintainability of an application. You can also install ESLint either globally or locally as <samp class="listingcharacter listingcharacter">devDependency</samp> in your project. The <samp class="listingcharacter listingcharacter">npm install -D eslint</samp> command enables you to install the tool locally. After installation, you use <samp class="listingcharacter listingcharacter">npx eslint --init</samp> to create the initial configuration file<a class="indexanchor" id="i13_34"/>, as shown in <span class="crossreference "><a href="13_002.html#l13.11">Listing 13.11</a></span>. This command launches an interactive wizard that helps you create a configuration file.</p>
            <div class="listing " id="l13.11"><pre><span class="bold"><samp class="listingcharacter listingcharacter">$ npx eslint --init<br/></samp></span>✓ How would you like to use ESLint? · <span class="bold"><samp class="listingcharacter listingcharacter">problems<br/></samp></span>✓ What type of modules does your project use? · <span class="bold"><samp class="listingcharacter listingcharacter">esm<br/></samp></span>✓ Which framework does your project use? · <span class="bold"><samp class="listingcharacter listingcharacter">none<br/></samp></span>✓ Does your project use TypeScript? · No / <span class="bold"><samp class="listingcharacter listingcharacter">Yes<br/></samp></span>✓ Where does your code run? · <span class="bold"><samp class="listingcharacter listingcharacter">node<br/></samp></span>✓ What format do you want your config file to be in? · <span class="bold"><samp class="listingcharacter listingcharacter">JSON</samp></span><br/>The config that you've selected requires the following dependencies:<br/><br/>@typescript-eslint/eslint-plugin@latest @typescript-eslint/parser@latest<br/>✓ Would you like to install them now with npm? · No / <span class="bold"><samp class="listingcharacter listingcharacter">Yes</samp></span><br/>Installing @typescript-eslint/eslint-plugin@latest, @typescript-eslint/parser@latest<br/><br/>up to date, audited 149 packages in 1s<br/><br/>27 packages are looking for funding<br/>  run `npm fund` for details<br/><br/>found 0 vulnerabilities<br/>Successfully created .eslintrc.json file in /src/node-buch </pre></div>
            <p class="caption "><b>Listing 13.11</b>    
            Creating an ESLint Configuration</p>
            <p class="standard">The configuration file is usually located in the root directory of your application and is named <span class="italic">.eslint.json</span><a class="indexanchor" id="i13_35"/>. <span class="crossreference "><a href="13_002.html#l13.12">Listing 13.12</a></span> shows an example of such a configuration file.</p>
            <div class="listing " id="l13.12"><pre><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="hellblau">"env"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>        <span class="hellblau">"es2021"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"><br/></span>        <span class="hellblau">"node"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz"><br/></span>    <span class="schwarz">},</span><span class="schwarz"><br/></span>    <span class="hellblau">"extends"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="schwarz"><br/></span><a id="p396"/>        <span class="hellblau">"eslint:recommended"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>        <span class="hellblau">"plugin:@typescript-eslint/recommended"</span><span class="schwarz"><br/></span>    <span class="schwarz">],</span><span class="schwarz"><br/></span>    <span class="hellblau">"parser"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"@typescript-eslint/parser"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>    <span class="hellblau">"parserOptions"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>        <span class="hellblau">"ecmaVersion"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">12,</span><span class="schwarz"><br/></span>        <span class="hellblau">"sourceType"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"module"</span><span class="schwarz"><br/></span>    <span class="schwarz">},</span><span class="schwarz"><br/></span>    <span class="hellblau">"plugins"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="schwarz"><br/></span>        <span class="hellblau">"@typescript-eslint"</span><span class="schwarz"><br/></span>    <span class="schwarz">],</span><span class="schwarz"><br/></span>    <span class="hellblau">"rules"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 13.12</b>    
            ESLint Configuration (.eslint.json)</p>
            <p class="standard">You can specify different basic rule sets in the configuration. First, you use the <samp class="listingcharacter listingcharacter">env</samp> directive to specify that the source code should follow the ECMAScript 2021 standard and run in Node.js. With <samp class="listingcharacter listingcharacter">extends</samp>, you define which predefined rule sets are to be used for the check. As a parser, you use <samp class="listingcharacter listingcharacter">@typescript-eslint/parser</samp>, and you can further configure it via <samp class="listingcharacter listingcharacter">parserOptions</samp>. Finally, you need to load the <samp class="listingcharacter listingcharacter">@typescript-eslint</samp><a class="indexanchor" id="i13_36"/> plug-in. The <samp class="listingcharacter listingcharacter">rules</samp> directive contains project-specific rules you can define here.</p>
            <p class="standard">To run ESLint, you use the <samp class="listingcharacter listingcharacter">npx eslint index.ts'</samp> command, which checks the specified file, that is, <span class="italic">index.ts</span>, against the defined rule. You can also use wildcards here, such as <samp class="listingcharacter listingcharacter">src/**/*.ts</samp>, to check all TypeScript files in the <span class="italic">src</span> directory.</p>
            <p class="standard">ESLint is very well supported by all common development environments and can therefore be embedded seamlessly into the development process.</p>
        
        
            <h3 class="t3" id="h13.2.4">13.2.4    ts-node<a class="indexanchor" id="i13_37"/></h3>
            <p class="standard">When developing Node.js applications with TypeScript, you must first translate the source code into JavaScript code before you can run it. You can omit the compile step with <samp class="listingcharacter listingcharacter">ts-node</samp>. This is a combination of TypeScript compiler and Node.js platform. With <samp class="listingcharacter listingcharacter">ts-node</samp>, you start your application as usual, for example, by executing the <samp class="listingcharacter listingcharacter">ts-node index.ts</samp> command.</p>
            <p class="standard">You can install <samp class="listingcharacter listingcharacter">ts-node</samp> via npm using the <samp class="listingcharacter listingcharacter">npm install -D ts-node</samp> command. The GitHub repository of this project can be found at <span class="url"><a href="https://github.com/TypeStrong/ts-node">https://github.com/TypeStrong/ts-node</a></span>.</p>
            <p class="standard">The same holds true for <samp class="listingcharacter listingcharacter">ts-node</samp> and Node.js itself: The source code of your application is read once at startup and then remains in the engine. If you change the source code, the running process won’t get notified about it. For the changes to take effect, you must restart the process. To prevent errors from creeping in at this point, the <samp class="listingcharacter listingcharacter">ts-node</samp> process <a id="p397"/>can also be automated. However, you’ll need additional tools here, such as <samp class="listingcharacter listingcharacter">nodemon</samp><a class="indexanchor" id="i13_38"/>, because <samp class="listingcharacter listingcharacter">ts-node</samp> doesn’t have its own file system watcher. After installing <samp class="listingcharacter listingcharacter">nodemon</samp> via the <samp class="listingcharacter listingcharacter">npm install -D nodemon</samp> command, you can start your application in watch mode using the command; <samp class="listingcharacter listingcharacter">npx nodemon --watch '**/*.ts' --exec 'ts-node index.ts'</samp>. If you then modify a TypeScript file in your application, the application process gets automatically restarted, and the changes will take effect.</p>
            <p class="standard">Note that <samp class="listingcharacter listingcharacter">nodemon</samp> isn’t suitable for production use, as file changes will also restart the production application, and it will lose its current state, which is normally held in the memory. Running commands such as <samp class="listingcharacter listingcharacter">nodemon</samp> in watch mode are typical examples of npm scripts. For example, you can include this command under the <samp class="listingcharacter listingcharacter">dev</samp> key in the <samp class="listingcharacter listingcharacter">scripts</samp> section of your <span class="italic">package.json</span> file and then run it using the <samp class="listingcharacter listingcharacter">npm run dev</samp> command, which allows you to avoid specifying all options. <span class="crossreference "><a href="13_002.html#l13.13">Listing 13.13</a></span> contains an example of such a <span class="italic">package.json</span> file.</p>
            <div class="listing " id="l13.13"><pre><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="hellblau">"name"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"node-buch"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"version"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"1.0.0"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"description"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">""</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"main"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"index.js"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"private"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"scripts"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="hellblau">"dev"</span><span class="schwarz">:</span><span class="schwarz"> "nodemon </span><span class="dunkelblau">--</span><span class="schwarz">watch </span><span class="hellblau">'**/*.ts'</span><span class="violett"> --exec </span><span class="hellblau">'ts-node'</span><span class="violett"> index.ts</span><span class="hellblau">"</span><br/>  },<br/>  "<span class="violett">author</span><span class="hellblau">": "",</span><br/>  "<span class="violett">license</span><span class="hellblau">": "</span><span class="violett">ISC</span><span class="hellblau">",</span><br/>  "<span class="violett">devDependencies</span><span class="hellblau">": {</span><br/>    "<span class="violett">@typescript-eslint/eslint-plugin</span><span class="hellblau">": "</span><span class="violett">^4.29.1</span><span class="hellblau">",</span><br/>    "<span class="violett">@typescript-eslint/</span><span class="schwarz">parser</span><span class="hellblau">": "</span><span class="dunkelblau">^</span><span class="schwarz">4.29.1</span><span class="hellblau">",</span><br/>    "<span class="schwarz">eslint</span><span class="hellblau">": "</span><span class="dunkelblau">^</span><span class="schwarz">7.32.0</span><span class="hellblau">",</span><br/>    "<span class="schwarz">nodemon</span><span class="hellblau">": "</span><span class="dunkelblau">^</span><span class="schwarz">2.0.12</span><span class="hellblau">",</span><br/>    "<span class="schwarz">ts</span><span class="dunkelblau">-</span><span class="schwarz">node</span><span class="hellblau">": "</span><span class="dunkelblau">^</span><span class="schwarz">10.2.0</span><span class="hellblau">",</span><br/>    "<span class="schwarz">typescript</span><span class="hellblau">": "</span><span class="dunkelblau">^</span><span class="schwarz">4.3.5</span><span class="hellblau">"</span><span class="schwarz"/><br/>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 13.13</b>    
            Activating Watch Mode for “ts-node” (package.json)</p>
            <p class="standard">Note that <samp class="listingcharacter listingcharacter">ts-node</samp> currently has problems supporting ECMAScript modules, so you’ll need to remove the <samp class="listingcharacter listingcharacter">"type": "module"</samp> specification from the <span class="italic">package.json</span> file. Currently, the developer team of <samp class="listingcharacter listingcharacter">ts-node</samp> is working on a solution to this issue, so the workaround will soon become redundant.</p>
            <p class="standard">Now that you’ve learned a bit about TypeScript and the development environment, we’ll turn our attention to a few commonly used features of TypeScript in the next sections.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>