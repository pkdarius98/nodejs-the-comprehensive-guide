<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Type-Safe Applications in Node.js" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Type-Safe Applications in Node.js" name="description"/>
            <meta content="en" name="language"/>
            <title>Type-Safe Applications in Node.js</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main"><h1 class="t1" id="h13">13    <a id="p385"/>Type-Safe Applications in Node.js</h1><p class="introductorynote indent_chapter_double">The best way to predict the future is to shape it yourself.<br/>—Alan Kay</p><p class="standard">One of the most common criticisms of JavaScript is that the language has no data types<a class="indexanchor" id="i13_00"/>. However, this statement is only partially correct. JavaScript knows a number of primitive<a class="indexanchor" id="i13_01"/><a class="indexanchor" id="i13_02"/> as well as composite data types<a class="indexanchor" id="i13_03"/><a class="indexanchor" id="i13_04"/>. The primitive types include character strings, Booleans, numbers, symbols, <samp class="listingcharacter listingcharacter">null</samp>, and <samp class="listingcharacter listingcharacter">undefined</samp>. The composite types are objects, arrays, sets, and maps. However, when working with JavaScript, you get little support from the engine itself. It throws <samp class="listingcharacter listingcharacter">TypeErrors</samp> at most if you try to use data types incorrectly. Nevertheless, you can also use types in pure JavaScript.</p><p class="standard">The source code shown in <span class="crossreference "><a href="13_001.html#l13.1">Listing 13.1</a></span> is interrupted in two places. When creating a new object, you pass two character strings to the constructor instead of one string and a number. This gets detected during the check using the <samp class="listingcharacter listingcharacter">typeof</samp> operator<a class="indexanchor" id="i13_05"/>, and a <samp class="listingcharacter listingcharacter">TypeError</samp> is thrown. The second instance where an exception is thrown is the <samp class="listingcharacter listingcharacter">rateMovie</samp> function. Here, you use the <samp class="listingcharacter listingcharacter">instanceof</samp> operator<a class="indexanchor" id="i13_06"/> to ensure that only one instance of the <samp class="listingcharacter listingcharacter">movie</samp> may be passed. If you call the function with a character string instead, as in the example, this comparison will fail, and the <samp class="listingcharacter listingcharacter">TypeError</samp> you specified will be thrown with an appropriate message.</p><div class="listing " id="l13.1"><pre><span class="rot">class Movie</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="schwarz">constructor(</span><span class="schwarz">title</span><span class="schwarz">,</span><span class="schwarz"> year</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">if</span><span class="schwarz"> (</span><span class="rot">typeof</span><span class="schwarz"> title </span><span class="dunkelblau">!==</span><span class="schwarz"> </span><span class="hellblau">'string'</span><span class="schwarz"> </span><span class="dunkelblau">||</span><span class="schwarz"> </span><span class="rot">typeof</span><span class="schwarz"> year </span><span class="dunkelblau">!==</span><span class="schwarz"> </span><span class="hellblau">'number'</span><span class="schwarz">) {</span></samp></span><br/>      <span class="rot">throw</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">TypeError(</span><span class="hellblau">'Wrong types supplied'</span><span class="schwarz">);</span><br/>    }<br/>    <span class="rot">this</span><span class="schwarz">.title </span><span class="dunkelblau">=</span><span class="schwarz"> title;</span><br/>    <span class="rot">this</span><span class="schwarz">.year </span><span class="dunkelblau">=</span><span class="schwarz"> year;</span><br/>  }<br/>}<br/><br/><span class="rot">function</span><span class="schwarz"> rateMovie(movie, rating) {</span><br/>  <span class="bold"><samp class="listingcharacter listingcharacter"><span class="rot">if</span><span class="schwarz"> (</span><span class="dunkelblau">!</span><span class="schwarz">(movie </span><span class="rot">instanceof Movie</span><span class="schwarz">) </span><span class="dunkelblau">||</span><span class="schwarz"> </span><span class="rot">typeof</span><span class="schwarz"> rating </span><span class="dunkelblau">!==</span><span class="schwarz"> </span><span class="hellblau">'number'</span><span class="schwarz">) {</span></samp></span><br/>    <span class="rot">throw</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">TypeError(</span><span class="hellblau">'Wrong types supplied'</span><span class="schwarz">);</span><br/>  }<br/>  movie.rating <span class="dunkelblau">=</span><span class="schwarz"> rating;</span><br/>}<br/><br/><span class="rot"><a id="p386"/>const</span><span class="schwarz"> ironMan </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Movie(</span><span class="hellblau">'Iron Man'</span><span class="schwarz">, </span><span class="hellblau">'2008'</span><span class="schwarz">);</span><br/><br/>rateMovie(<span class="hellblau">'Iron Man'</span><span class="schwarz">, 4); </span><span class="gruen"> // TypeError: Wrong types supplied</span><span class="schwarz"> </span><span class="schwarz"/></pre></div><p class="caption "><b>Listing 13.1</b>    
            Manual Type Checking in JavaScript (index.js)</p><p class="standard">Although this mechanism secures your application at runtime against the incorrect use of types, it isn’t very helpful during development and causes a lot of typing work. Your development environment can’t support you either in this context. This solution is therefore far removed from a type system in the conventional sense.</p><p class="standard">Compensating for some of the drawbacks of the absence of a type system in JavaScript, tools such as ESLint help statically analyze the source code and point out errors and antipatterns. However, only type systems for JavaScript provide a real solution. There are a number of solutions available; TypeScript and Flow are widely used.</p>
        <h2 class="t2" id="h13.1">13.1    Type Systems for Node.js<a class="indexanchor" id="i13_07"/></h2>
        <p class="standard">The various type systems for JavaScript take different approaches, but all of them serve the goal of defining different data types for an application and referencing them in the source code. Normally, the data types of the type systems are used in connection with variables and function signatures.</p>
        <p class="standard">In addition to providing a set of rules and a JavaScript syntax essay, most type systems also provide programs you can use to check your application. This step occurs before the application is executed. Before we turn to TypeScript, the most widely used type system, let’s consider Flow as an alternative.</p>
        
            <h3 class="t3" id="h13.1.1">13.1.1    Flow<a class="indexanchor" id="i13_08"/></h3>
            <p class="standard">Flow is a type system developed by Facebook<a class="indexanchor" id="i13_09"/>. It came to prominence through its use in the frontend of React applications. The tool is available as an open-source project. The project’s official website can be found at <span class="url"><a href="https://flow.org/en/">https://flow.org/en/</a></span>. Flow’s source code is maintained on GitHub at <span class="url"><a href="https://github.com/facebook/flow">https://github.com/facebook/flow</a></span>. It’s installed via the package manager, that is, either Node Package Manager (npm) or Yarn<a class="indexanchor" id="i13_10"/>. The developers recommend local installation as a development dependency. Before you launch the installation, you must make sure that your project has a <span class="italic">package.json</span> file. If you haven’t created one yet, you must first run the <samp class="listingcharacter listingcharacter">npm init -y</samp> command. Then you must always add the <samp class="listingcharacter listingcharacter">type</samp> and <samp class="listingcharacter listingcharacter">private</samp> fields to the generated file to be able to use the ECMAScript module system and to ensure that your application can’t be published accidentally (see <span class="crossreference "><a href="13_001.html#l13.2">Listing 13.2</a></span>).</p>
            <div class="listing " id="l13.2"><pre><span class="schwarz"><a id="p387"/>{</span><span class="schwarz"><br/></span>  <span class="hellblau">"name"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"node_book"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"version"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"1.0.0"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"description"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">""</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"main"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"index.js"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"type"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"module"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"private"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"scripts"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="hellblau">"test"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"echo \"</span><span class="schwarz">Error</span><span class="schwarz">:</span><span class="schwarz"> no test specified\</span><span class="hellblau">" &amp;&amp; exit 1"</span><span class="schwarz"><br/></span>  <span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="hellblau">"keywords"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">[],</span><span class="schwarz"><br/></span>  <span class="hellblau">"author"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">""</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"license"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"ISC"</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 13.2</b>    
            Initial “package.json” File</p>
            <p class="standard">In the next step, you install Flow via the <samp class="listingcharacter listingcharacter">npm install -D flow-bin</samp> command and initialize it using the <samp class="listingcharacter listingcharacter">npx flow init</samp> command. This command creates the <span class="italic">.flowconfig</span><a class="indexanchor" id="i13_11"/> file in your project, which contains the configuration.</p>
            <p class="standard">Each source code file you want to check with Flow must start with this comment: <samp class="listingcharacter listingcharacter">/* @flow */</samp>. <span class="crossreference "><a href="13_001.html#l13.3">Listing 13.3</a></span> shows an example of a Flow source code.</p>
            <div class="listing " id="l13.3"><pre><span class="gruen">/* @flow */</span><span class="schwarz"><br/></span><span class="rot">class Movie</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  title<span class="schwarz">:</span><span class="schwarz"> string</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  year<span class="schwarz">:</span><span class="schwarz"> number</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  rating<span class="schwarz">:</span><span class="schwarz"> number</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="schwarz">constructor(</span><span class="schwarz">title</span><span class="schwarz">:</span><span class="schwarz"> string</span><span class="schwarz">,</span><span class="schwarz"> year</span><span class="schwarz">:</span><span class="schwarz"> number</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">this</span><span class="schwarz">.</span><span class="schwarz">title </span><span class="dunkelblau">=</span><span class="schwarz"> title</span><span class="schwarz">;</span><span class="schwarz"><br/></span>    <span class="rot">this</span><span class="schwarz">.</span><span class="schwarz">year </span><span class="dunkelblau">=</span><span class="schwarz"> year</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span><br/><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">rateMovie(</span><span class="schwarz">movie</span><span class="schwarz">:</span><span class="schwarz"> Movie</span><span class="schwarz">,</span><span class="schwarz"> rating</span><span class="schwarz">:</span><span class="schwarz"> number</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  movie<span class="schwarz">.</span><span class="schwarz">rating </span><span class="dunkelblau">=</span><span class="schwarz"> rating</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span><br/><span class="rot">const</span><span class="schwarz"> ironMan</span><span class="schwarz">:</span><span class="schwarz"> Movie </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Movie(</span><span class="hellblau">'Iron Man'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'2008'</span><span class="schwarz">);</span><span class="schwarz"><br/></span><br/><span class="schwarz">rateMovie(</span><span class="hellblau">'Iron Man'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">4);</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 13.3</b>    
            Source Code with Flow (index.js)</p>
            <p class="standard"><a id="p388"/>If you save the source code in a file named <span class="italic">index.js</span> and then run the <samp class="listingcharacter listingcharacter">npx flow check</samp> command, Flow checks<a class="indexanchor" id="i13_12"/> the source code of your application and issues the messages shown in <span class="crossreference "><a href="13_001.html#l13.4">Listing 13.4</a></span> for the sample code.</p>
            <div class="listing " id="l13.4"><pre>Error ----------------------------------------------- index.js:16:46<br/> <br/>Cannot call Movie with '2008' bound to year because string [1] is incompatible with number [2]. [incompatible-call]<br/> <br/> [2]  6│   constructor(title: string, year: number) {<br/>       :<br/>     13│   movie.rating = rating;<br/>     14│ }<br/>     15│<br/> [1] 16│ const ironMan: Movie = new Movie('Iron Man', '2008');<br/>     17│<br/>     18│ rateMovie('Iron Man', 4);<br/>     19│<br/> <br/> <br/>Error ----------------------------------------------- index.js:18:11<br/> <br/>Cannot call rateMovie with 'Iron Man' bound to movie because string [1] is incompatible with Movie [2].<br/>[incompatible-call]<br/> <br/> [2] 12│ function rateMovie(movie: Movie, rating: number) {<br/>     13│   movie.rating = rating;<br/>     14│ }<br/>     15│<br/>     16│ const ironMan: Movie = new Movie('Iron Man', '2008');<br/>     17│<br/> [1] 18│ rateMovie('Iron Man', 4);<br/>     19│<br/> <br/>Found 2 errors </pre></div>
            <p class="caption "><b>Listing 13.4</b>    
            Error Message during Type Check with Flow</p>
            <p class="standard">If you try to run the source code directly in Node.js, you get a <samp class="listingcharacter listingcharacter">SyntaxError</samp> because Flow supports the full JavaScript language standard, but the type markup violates JavaScript syntax. For this reason, you need another tool in addition to Flow that converts the code with the markups back into valid JavaScript code. The simplest solution is to use the <samp class="listingcharacter listingcharacter">flow-remove-types</samp> package. You can install this package using the <samp class="listingcharacter listingcharacter">npm install -D flow-remove-types</samp> command. Typically, for flow files, you should add the <span class="italic">.flow.js</span> extension to <a id="p389"/>indicate that these files can’t be executed directly in Node.js. When you save the source code shown in <span class="crossreference "><a href="13_001.html#l13.3">Listing 13.3</a></span> in a file named <span class="italic">index.flow.js</span>, calling <samp class="listingcharacter listingcharacter">npx flow-remove-types index.flow.js &gt; index.js</samp> creates the <span class="italic">index.js</span> file, which you can launch via the <samp class="listingcharacter listingcharacter">node index.js</samp> command.</p>
            <p class="standard">Not only can you execute the two commands directly on the command line, but you can also include and combine them in your <span class="italic">package.json</span> file. So, the <samp class="listingcharacter listingcharacter">start</samp> script shown in <span class="crossreference "><a href="13_001.html#l13.5">Listing 13.5</a></span> combines both commands and runs your application.</p>
            <div class="listing " id="l13.5"><pre><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="hellblau">"name"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"node-buch"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"version"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"1.0.0"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"description"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">""</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"main"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"index.js"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"type"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"module"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"private"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"scripts"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="hellblau">"check"</span><span class="schwarz">: </span><span class="hellblau">"flow check"</span><span class="schwarz">,</span><br/>    <span class="hellblau">"removeTypes"</span><span class="schwarz">: </span><span class="hellblau">"flow-remove-types index.flow.js &gt; index.js"</span><span class="schwarz">,</span><br/>    <span class="hellblau">"start"</span><span class="schwarz">: </span><span class="hellblau">"npm run check &amp;&amp; npm run removeTypes &amp;&amp; node index.js"</span></samp></span><span class="schwarz"><br/></span>  },<br/>  <span class="hellblau">"keywords"</span><span class="schwarz">: [],</span><br/>  <span class="hellblau">"author"</span><span class="schwarz">: </span><span class="hellblau">""</span><span class="schwarz">,</span><br/>  <span class="hellblau">"license"</span><span class="schwarz">: </span><span class="hellblau">"ISC"</span><span class="schwarz">,</span><br/>  <span class="hellblau">"devDependencies"</span><span class="schwarz">: {</span><br/>    <span class="hellblau">"flow-bin"</span><span class="schwarz">: </span><span class="hellblau">"^0.157.0"</span><span class="schwarz">,</span><br/>    <span class="hellblau">"flow-remove-types"</span><span class="schwarz">: </span><span class="hellblau">"^2.157.0"</span><span class="schwarz"><br/></span>  }<br/>} <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 13.5</b>    
            Help Scripts in the “package.json” File</p>
            <p class="standard">For the <samp class="listingcharacter listingcharacter">npm start</samp> command to run successfully, you must first rename the <span class="italic">index.js</span> file to <span class="italic">index.flow.js</span><a class="indexanchor" id="i13_13"/>. Then fix the two errors so that the file looks like <span class="crossreference "><a href="13_001.html#l13.6">Listing 13.6</a></span>.</p>
            <div class="listing " id="l13.6"><pre><span class="gruen">/* @flow */</span><span class="schwarz"><br/></span><span class="rot">class Movie</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  title<span class="schwarz">:</span><span class="schwarz"> string</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  year<span class="schwarz">:</span><span class="schwarz"> number</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  rating<span class="schwarz">:</span><span class="schwarz"> number</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="schwarz">constructor(</span><span class="schwarz">title</span><span class="schwarz">:</span><span class="schwarz"> string</span><span class="schwarz">,</span><span class="schwarz"> year</span><span class="schwarz">:</span><span class="schwarz"> number</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">this</span><span class="schwarz">.</span><span class="schwarz">title </span><span class="dunkelblau">=</span><span class="schwarz"> title</span><span class="schwarz">;</span><span class="schwarz"><br/></span>    <span class="rot">this</span><span class="schwarz">.</span><span class="schwarz">year </span><span class="dunkelblau">=</span><span class="schwarz"> year</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span> <br/><span class="rot"><a id="p390"/>function</span><span class="schwarz"> </span><span class="schwarz">rateMovie(</span><span class="schwarz">movie</span><span class="schwarz">:</span><span class="schwarz"> Movie</span><span class="schwarz">,</span><span class="schwarz"> rating</span><span class="schwarz">:</span><span class="schwarz"> number</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  movie<span class="schwarz">.</span><span class="schwarz">rating </span><span class="dunkelblau">=</span><span class="schwarz"> rating</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> ironMan</span><span class="schwarz">:</span><span class="schwarz"> Movie </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Movie(</span><span class="hellblau">'Iron Man'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">2008</samp></span>);<br/> <br/>rateMovie(<span class="bold"><samp class="listingcharacter listingcharacter">ironMan</samp></span>, 4);<br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter"><span class="magenta">console</span><span class="schwarz">.log(ironMan);</span></samp></span> <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 13.6</b>    
            Error-Free Flow File (index.flow.js)</p>
            <p class="standard">If you now run the <samp class="listingcharacter listingcharacter">npm start</samp> command, you’ll get an output like the one shown in <span class="crossreference "><a href="13_001.html#l13.7">Listing 13.7</a></span>.</p>
            <div class="listing " id="l13.7"><pre><span class="bold"><samp class="listingcharacter listingcharacter">$ npm start<br/> </samp></span><br/>&gt; listing13_2@1.0.0 start<br/>&gt; npm run check &amp;&amp; npm run removeTypes &amp;&amp; node index.js<br/> <br/>&gt; listing13_2@1.0.0 check<br/>&gt; flow check<br/> <br/>Found 0 errors<br/> <br/>&gt; listing13_2@1.0.0 removeTypes<br/>&gt; flow-remove-types index.flow.js &gt; index.js<br/> <br/>Movie { title: 'Iron Man', year: 2008, rating: 4 } </pre></div>
            <p class="caption "><b>Listing 13.7</b>    
            Output of the “npm start” Script</p>
            <p class="standard">An alternative to using the <samp class="listingcharacter listingcharacter">flow-remove-types</samp> package is to use the Babel transpiler.</p>
            <p class="standard">The difference between Flow and other type systems for JavaScript is that Flow focuses only on checking the data types in the source code. Other tools, such as TypeScript, intervene in the source code and transform it.</p>
        
        
            <h3 class="t3" id="h13.1.2">13.1.2    TypeScript<a class="indexanchor" id="i13_14"/></h3>
            <p class="standard">Originally developed my Microsoft, TypeScript is a language based on JavaScript that includes a type system as one of its most important features. <a class="indexanchor" id="i13_15"/>Like Flow, TypeScript is available as an open-source project on GitHub at <span class="url"><a href="https://github.com/Microsoft/TypeScript">https://github.com/Microsoft/TypeScript</a></span>. The official website can be found at <span class="url"><a href="http://www.typescriptlang.org/">www.typescriptlang.org/</a></span>. As described earlier, TypeScript is capable of actively modifying the source code of your application. When you use TypeScript, you also don’t write JavaScript source code—you write <a id="p391"/>TypeScript. However, TypeScript is a superset of JavaScript, so valid JavaScript is also valid TypeScript in most cases. The TypeScript source code is then compiled by the TypeScript compiler<a class="indexanchor" id="i13_16"/> into JavaScript. In this context, you can configure what the resulting source code should look like. For example, ES3 is supported as a target format, but ES2021 is also supported. Depending on your choice, TypeScript uses polyfills<a class="indexanchor" id="i13_17"/> to make new features available in older environments. The newer the ECMAScript version, the smaller the differences between the TypeScript source code and the resulting JavaScript code. However, TypeScript is always adding new features, so you can use them even before they are integrated into the JavaScript language standard. For example, it’s possible to use the ECMAScript module system<a class="indexanchor" id="i13_18"/> with <samp class="listingcharacter listingcharacter">import</samp> and <samp class="listingcharacter listingcharacter">export</samp> already in version 4 of Node.js. However, because Node.js puts your environment much more under your control than the browser does, you can choose a more modern compile target, reducing the overhead generated by TypeScript.</p>
            <p class="standard">As you can see, the TypeScript source code in <span class="crossreference "><a href="13_001.html#l13.8">Listing 13.8</a></span> strongly resembles the implementation in Flow. Both type systems use the same solution to annotate types. A variable is followed by the type specification separated by a colon. In TypeScript, you can use types for variables as well as in function signatures.</p>
            <div class="listing " id="l13.8"><pre><span class="rot">class Movie</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">public</span><span class="schwarz"> rating</span><span class="schwarz">:</span><span class="schwarz"> number</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="schwarz">constructor(</span><span class="rot">public</span><span class="schwarz"> title</span><span class="schwarz">:</span><span class="schwarz"> string</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">public</span><span class="schwarz"> year</span><span class="schwarz">:</span><span class="schwarz"> number</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span><br/><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">rateMovie(</span><span class="schwarz">movie</span><span class="schwarz">:</span><span class="schwarz"> Movie</span><span class="schwarz">,</span><span class="schwarz"> rating</span><span class="schwarz">:</span><span class="schwarz"> number</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  movie<span class="schwarz">.</span><span class="schwarz">rating </span><span class="dunkelblau">=</span><span class="schwarz"> rating</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span><br/><span class="rot">const</span><span class="schwarz"> ironMan</span><span class="schwarz">:</span><span class="schwarz"> Movie </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Movie(</span><span class="hellblau">'Iron Man'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'2008'</span><span class="schwarz">);</span><span class="schwarz"><br/></span><br/><span class="schwarz">rateMovie(</span><span class="hellblau">'Iron Man'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">4);</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 13.8</b>    
            TypeScript Source Code (index.ts)</p>
            <p class="standard">You can install<a class="indexanchor" id="i13_19"/> the TypeScript compiler on your system using the package manager of your choice. To install TypeScript locally in your project, you must use the <samp class="listingcharacter listingcharacter">npm install -D typescript</samp> command. Again, as with Flow before, you should have a local <span class="italic">package.json</span> file where the dependencies are entered correctly. The official documentation recommends the global installation via the <samp class="listingcharacter listingcharacter">npm install -g typescript</samp> command because, in this case, you have the TypeScript compiler accessible everywhere on the command line. However, this variant reaches its limits if you need multiple versions of TypeScript on your system. You can launch the TypeScript compiler via the <samp class="listingcharacter listingcharacter">npx tsc</samp> command or only <samp class="listingcharacter listingcharacter">tsc</samp> if you’ve chosen the global installation. Save the source code from <span class="crossreference "><a href="13_001.html#l13.8">Listing 13.8</a></span> in a file named <span class="italic">index.ts</span>, and use the <samp class="listingcharacter listingcharacter">tsc index.ts</samp> command to check and convert the source code. <span class="crossreference "><a href="13_001.html#l13.9">Listing 13.9</a></span> shows the output of the command.</p>
            <div class="listing " id="l13.9"><pre><span class="violett"><a id="p392"/>index.ts:10:46 - error </span><span class="hellblau">TS2345</span><span class="violett">: </span><span class="hellblau">Argument</span><span class="violett"> of type </span><span class="braun">'string'</span><span class="violett"> is not assignable to parameter of type </span><span class="braun">'number'</span><span class="violett">.</span><br/> <br/>10 const iron<span class="hellblau">Man</span><span class="violett">: </span><span class="hellblau">Movie</span><span class="violett"> = </span><span class="hellblau">new</span><span class="violett"> </span><span class="magenta">Movie</span><span class="violett">(</span><span class="braun">'Iron Man'</span><span class="violett">, </span><span class="braun">'2008'</span><span class="violett">);</span><br/>                                                ~~~~~~<br/> <br/>index.ts:12:11 - error <span class="hellblau">TS2345</span><span class="violett">: </span><span class="hellblau">Argument</span><span class="violett"> of type </span><span class="braun">'string'</span><span class="violett"> is not assignable to parameter of type </span><span class="braun">'Movie'</span><span class="violett">.</span><br/> <br/>12 <span class="magenta">rateMovie</span><span class="violett">(</span><span class="braun">'Iron Man'</span><span class="violett">, 4);</span><br/>             ~~~~~~~~~~<br/> <br/> <br/><span class="hellblau">Found</span><span class="violett"> 2 errors.</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 13.9</b>    
            Error Messages during Type Check with TypeScript</p>
            <p class="standard">As you can see, the output of TypeScript is a bit shorter than that of Flow. However, it contains all the important information such as file name, exact location of the problem, and a detailed error message. In addition to the console output, the compiler generated the <span class="italic">index.js</span> file, which, despite error messages, contains executable JavaScript code that you can run with Node.js.</p>
            <div class="box box_standard">
                <h6 class="boxheading">Duck Typing<a class="indexanchor" id="i13_20"/></h6>
                <p class="standard first">TypeScript doesn’t perform type checking strictly, but in a pattern called <span class="italic">duck typing</span>. Duck typing means that when you assign a particular class as a type to a variable, the value of that variable doesn’t have to be an instance of that class or of one of its subclasses—it just has to match the structure of the class.</p>
                <p class="standard last">Duck typing derives from a saying that if a bird moves, swims, and quacks like a duck, it’s a duck. The same is true for TypeScript objects and classes. So, if an object has the same properties and methods as the <samp class="listingcharacter listingcharacter">user</samp> class, it’s a <samp class="listingcharacter listingcharacter">user</samp> type.</p>
            </div>
            <p class="standard">In the next section, we’ll introduce you to some of the most important concepts of TypeScript. You should rely on this type system when implementing your application due to its prevalence and range of functions.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>