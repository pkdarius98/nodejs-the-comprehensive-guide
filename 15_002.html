<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Node on the Command Line" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Node on the Command Line" name="description"/>
            <meta content="en" name="language"/>
            <title>Node on the Command Line</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h15.2">15.2    <a id="p456"/>Structure<a class="indexanchor" id="i15_30"/> of a Command-Line Application</h2>
        <p class="standard">As an example of a command-line application, we want to create an application that provides calculation tasks for the four basic arithmetic operations and checks the results you enter. In the following sections, you’ll implement such an application step by step and see what options are available to you on the command line.</p>
        
            <h3 class="t3" id="h15.2.1">15.2.1    File and Directory Structure<a class="indexanchor" id="i15_31"/></h3>
            <p class="standard">Normally, a command-line application has at least two subdirectories:</p>
            <ul>
                <li>
                    <p class="standard first-item last-item"><span class="bold">lib</span><a class="indexanchor" id="i15_32"/><span class="italic"><br/></span>The <span class="italic">lib</span> directory contains the actual application. Depending on the size of the tool, you can distribute the source code across several files and subdirectories. As an alternative to the name <span class="italic">lib</span>, you can also name this directory <span class="italic">src</span>. Both variants are quite commonly used.</p>
                </li>
                <li>
                    <p class="standard first-item last-item"><span class="bold">bin</span><a class="indexanchor" id="i15_33"/><span class="italic"><br/></span>The executable files are located in the <span class="italic">bin</span> directory of the application. If you follow this convention, it’s easy for outsiders to get started with the application.</p>
                </li>
            </ul>
            <p class="standard">In addition to the directories and files of the application, there is also the package configuration in the form of the <span class="italic">package.json</span><a class="indexanchor" id="i15_34"/> file. According to the convention, you should store the <span class="italic">index.js</span> file, which is the entry point to your application, in the <span class="italic">lib</span> directory.</p>
            <p class="standard">One of the features of a command-line application is that you can call the tool directly and don’t need to use the <samp class="listingcharacter listingcharacter">node</samp> command first. For this purpose, you can make use of the <span class="italic">shebang</span><a class="indexanchor" id="i15_35"/> (#!) on Unix systems. This is a standardized character string that tells the system how to execute the script. To make sure the Math Trainer application runs on your system, you must create a file named <span class="italic">mathTrainer.js</span> in the <span class="italic">bin</span> directory. The contents of this file are shown in <span class="crossreference "><a href="15_002.html#l15.2">Listing 15.2</a></span>.</p>
            <div class="listing " id="l15.2"><pre>#<span class="dunkelblau">!/</span><span class="schwarz">usr</span><span class="dunkelblau">/</span><span class="schwarz">bin</span><span class="dunkelblau">/</span><span class="schwarz">env node</span><br/> <br/><span class="rot">import</span><span class="schwarz"> </span><span class="hellblau">'../lib/index.js'</span><span class="schwarz">;</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 15.2</b>    
            Math Trainer Executable File (bin/mathTrainer.js)</p>
            <p class="standard">After you’ve made sure the execution permission is also set correctly on a Unix system, you can execute your application via the <samp class="listingcharacter listingcharacter">bin/mathTrainer.js</samp> command line in the root directory<a class="indexanchor" id="i15_36"/> of your application.</p>
        
        
            <h3 class="t3" id="h15.2.2">15.2.2    Package Definition<a class="indexanchor" id="i15_37"/></h3>
            <p class="standard">One of the most important aspects is the <span class="italic">package.json</span> file of a project. It helps you to obtain an initial overview of a project. The file lists the name, description, and version <a id="p457"/>number as well as the dependencies to be installed. Furthermore, it references the entry point into the application. For the Math Trainer, you use the <samp class="listingcharacter listingcharacter">npm init</samp><a class="indexanchor" id="i15_38"/> command to create the <span class="italic">package.json</span> file.</p>
            <p class="standard">The interactive wizard will ask you some questions, after which, you’ll have an initial package<a class="indexanchor" id="i15_39"/> configuration. This configuration file is primarily intended for normal Node.js applications and not for command-line tools. For this reason, you still need to make some adjustments. As a general best practice, you should set the <samp class="listingcharacter listingcharacter">private</samp> key to the value <samp class="listingcharacter listingcharacter">true</samp> so that you don’t accidentally publish your application. As we’re use the ECMAScript module system, you must define the value <samp class="listingcharacter listingcharacter">module</samp> as <samp class="listingcharacter listingcharacter">type</samp>. The <samp class="listingcharacter listingcharacter">bin</samp> object also represents a mapping from the command to the executable. If you’ve already created a file in the <span class="italic">bin</span> directory, as in the example, <samp class="listingcharacter listingcharacter">npm init</samp> will automatically create the mapping for you. You can delete the entries <samp class="listingcharacter listingcharacter">main</samp> for the entry point and <samp class="listingcharacter listingcharacter">scripts</samp> for various helper scripts for the time being. <span class="crossreference "><a href="15_002.html#l15.3">Listing 15.3</a></span> shows the <span class="italic">package.json</span> file for the Math Trainer application.</p>
            <div class="listing " id="l15.3"><pre><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="hellblau">"name"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"math-trainer"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"version"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"1.0.0"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"description"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"A simple tool to train your math skills"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"bin"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="hellblau">"math-trainer"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"bin/mathTrainer.js"</span><span class="schwarz"><br/></span>  <span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="hellblau">"license"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"ISC"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"private"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"type"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"module"</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 15.3</b>    
            “package.json” File for the Math Trainer Application</p>
        
        
            <h3 class="t3" id="h15.2.3">15.2.3    Math Trainer Application</h3>
            <p class="standard">Now that you’ve made the preparations for your application, it’s time to implement the actual application logic<a class="indexanchor" id="i15_40"/>. The user should be shown a certain number of tasks per basic calculating operation on the command line. They can choose between three levels of difficulty. At the first level, both operands are to be single-digit. At the second level, one of the two operands should be one-digit, the second two-digit, and, finally, at the third level, both should be two-digit. A special rule applies to division: only integer divisions should be possible, and to increase the difficulty a bit, you generate the two operands according to the rules mentioned before, multiply the first with the second operand, and use the result as the first operand.</p>
            <p class="standard">First, you implement a helper function that generates a random integer operand for you. You store this function in the <span class="italic">lib/operands.js</span> file. <span class="crossreference "><a href="15_002.html#l15.4">Listing 15.4</a></span> shows the corresponding source code.</p>
            <div class="listing " id="l15.4"><pre><span class="rot"><a id="p458"/>export</span><span class="schwarz"> </span><span class="rot">default</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">digits</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> Math</span><span class="schwarz">.floor(</span><span class="schwarz">Math</span><span class="schwarz">.random()</span><span class="schwarz"> </span><span class="dunkelblau">*</span><span class="schwarz"> </span><span class="schwarz">10</span><span class="schwarz"> </span><span class="dunkelblau">**</span><span class="schwarz"> digits</span><span class="schwarz">);</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 15.4</b>    
            Helper Function to Create Random Operands (lib/operands.js)</p>
            <p class="standard">The function exported as <samp class="listingcharacter listingcharacter">default</samp> expects a number that specifies how many digits the operand should have. With this number, you generate and return a corresponding integer<a class="indexanchor" id="i15_41"/> via a combination of <samp class="listingcharacter listingcharacter">Math.random</samp>, <samp class="listingcharacter listingcharacter">Math.floor</samp>, and the exponentiation operator.</p>
            <p class="standard">In the next step, you create a file named <span class="italic">task.js</span>, which you also save in the <span class="italic">lib</span> directory. This file contains the logic for generating the individual tasks. A task is represented by an object that has the properties <samp class="listingcharacter listingcharacter">task</samp>, <samp class="listingcharacter listingcharacter">result</samp>, and <samp class="listingcharacter listingcharacter">input</samp>. In <samp class="listingcharacter listingcharacter">task</samp>, you store the task as a character string. <samp class="listingcharacter listingcharacter">result</samp> contains the precalculated result of the task as a number, and <samp class="listingcharacter listingcharacter">input</samp> should finally contain the solution entered by the user and is first initialized with an empty string.</p>
            <p class="standard">The <span class="italic">task.js</span> file contains two functions, as shown in <span class="crossreference "><a href="15_002.html#l15.5">Listing 15.5</a></span>. The <samp class="listingcharacter listingcharacter">createTask</samp> method creates a new <samp class="listingcharacter listingcharacter">task</samp> object, and the <samp class="listingcharacter listingcharacter">getOperands</samp> method generates the two operators using the helper function from <span class="italic">operands.js</span>. Because you only need the <samp class="listingcharacter listingcharacter">createTask</samp> function outside the file, it also represents the <samp class="listingcharacter listingcharacter">default export</samp> of the file.</p>
            <div class="listing " id="l15.5"><pre><span class="rot">import</span><span class="schwarz"> createOperand </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./operands.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">default</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">createTask(</span><span class="schwarz">operation</span><span class="schwarz">,</span><span class="schwarz"> level</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="schwarz">operand1</span><span class="schwarz">,</span><span class="schwarz"> operand2</span><span class="schwarz">]</span><span class="schwarz"> </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">getOperands(</span><span class="schwarz">operation</span><span class="schwarz">,</span><span class="schwarz"> level</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> task </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="violett">`${operand1} ${operation} ${operand2}`</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> result </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">eval(</span><span class="schwarz">task</span><span class="schwarz">);</span><span class="schwarz"><br/></span> <br/>  <span class="rot">return</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    task<span class="schwarz">,</span><span class="schwarz"><br/></span>    result<span class="schwarz">,</span><span class="schwarz"><br/></span>    input<span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">''</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="schwarz">};</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span> <br/><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">getOperands(</span><span class="schwarz">operation</span><span class="schwarz">,</span><span class="schwarz"> level</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">let</span><span class="schwarz"> operands</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="rot">switch</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">level</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">case</span><span class="schwarz"> </span><span class="schwarz">1:</span><span class="schwarz"><br/></span>      operands <span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[createOperand(1),</span><span class="schwarz"> </span><span class="schwarz">createOperand(1)];</span><span class="schwarz"><br/></span>      <span class="rot">break</span><span class="schwarz">;</span><span class="schwarz"><br/></span>    <span class="rot">case</span><span class="schwarz"> </span><span class="schwarz">2:</span><span class="schwarz"><br/></span>      operands <span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[createOperand(1),</span><span class="schwarz"> </span><span class="schwarz">createOperand(2)];</span><span class="schwarz"><br/></span>      <span class="rot">if</span><span class="schwarz"> </span><span class="schwarz">(createOperand(1)</span><span class="schwarz"> </span><span class="dunkelblau">%</span><span class="schwarz"> </span><span class="schwarz">2</span><span class="schwarz"> </span><span class="dunkelblau">===</span><span class="schwarz"> </span><span class="schwarz">0)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>        operands<span class="schwarz">.reverse();</span><span class="schwarz"><br/></span>      <span class="schwarz">}</span><span class="schwarz"><br/></span>      <span class="rot">break</span><span class="schwarz">;</span><span class="schwarz"><br/></span><a id="p459"/>    <span class="rot">case</span><span class="schwarz"> </span><span class="schwarz">3:</span><span class="schwarz"><br/></span>      operands <span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[createOperand(2),</span><span class="schwarz"> </span><span class="schwarz">createOperand(2)];</span><span class="schwarz"><br/></span>      <span class="rot">break</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span>  <span class="rot">if</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">operation </span><span class="dunkelblau">===</span><span class="schwarz"> </span><span class="hellblau">'/'</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    operands<span class="schwarz">[0]</span><span class="schwarz"> </span><span class="dunkelblau">=</span><span class="schwarz"> operands</span><span class="schwarz">[0]</span><span class="schwarz"> </span><span class="dunkelblau">*</span><span class="schwarz"> operands</span><span class="schwarz">[1];</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span>  <span class="rot">return</span><span class="schwarz"> operands</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 15.5</b>    
            Creating New Tasks (lib/task.js)</p>
            <p class="standard">The <samp class="listingcharacter listingcharacter">createTask</samp> function creates two operands via the <samp class="listingcharacter listingcharacter">getOperands</samp> function and assigns them to the two variables <samp class="listingcharacter listingcharacter">operand1</samp> and <samp class="listingcharacter listingcharacter">operand2</samp> by means of a destructuring<a class="indexanchor" id="i15_42"/> operation. With these two variables and the type of operation passed as the operator, the string representation of the operation is formed with a template string<a class="indexanchor" id="i15_43"/>. You pass this string to the <samp class="listingcharacter listingcharacter">eval</samp> function to have the result calculated. The <samp class="listingcharacter listingcharacter">eval</samp><a class="indexanchor" id="i15_44"/> function executes a string as JavaScript source code. You should use this function only in exceptional cases, and then only if you have complete control over the character string being executed. This information forms the task object returned by the function.</p>
            <p class="standard">The <samp class="listingcharacter listingcharacter">getOperands</samp> function receives as input the type of task and the difficulty level and then uses this information to generate the operands from the previously defined rules. At the second level of difficulty, the operands are randomly swapped using the <samp class="listingcharacter listingcharacter">Array.prototype.reverse</samp> method. For this purpose, you create an additional random number via the <samp class="listingcharacter listingcharacter">createOperand</samp> function. If it’s an even number, it’s swapped so that the two-digit operand can appear both in first and second place. At the end of the method, you must check if the operation is a division and adjust the first operand according to the task.</p>
            <p class="standard">You can now test the functionality by creating an <span class="italic">index.js</span> file in the <span class="italic">lib</span> directory and integrating the application logic. <span class="crossreference "><a href="15_002.html#l15.6">Listing 15.6</a></span> shows the source code.</p>
            <div class="listing " id="l15.6"><pre><span class="rot">import</span><span class="schwarz"> createTask </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./task.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> amount </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">4;</span><span class="schwarz"><br/></span><span class="rot">const</span><span class="schwarz"> level </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">2;</span><span class="schwarz"><br/></span><span class="rot">const</span><span class="schwarz"> operations </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="hellblau">'+'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'-'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'*'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'/'</span><span class="schwarz">];</span><span class="schwarz"><br/></span> <br/>operations<span class="schwarz">.forEach((</span><span class="schwarz">operation</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">for</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="rot">let</span><span class="schwarz"> i </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">0;</span><span class="schwarz"> i </span><span class="dunkelblau">&lt;</span><span class="schwarz"> amount</span><span class="schwarz">;</span><span class="schwarz"> i</span><span class="dunkelblau">++</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="magenta">console</span><span class="schwarz">.log(createTask(</span><span class="schwarz">operation</span><span class="schwarz">,</span><span class="schwarz"> level</span><span class="schwarz">));</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 15.6</b>    
            Creating Tasks</p>
            <p class="standard"><a id="p460"/>The source code of the <span class="italic">index.js</span> file makes sure that four tasks per basic arithmetic operation are displayed to you when you run the application.</p>
            <p class="standard">By implementing this file, you’ve created the final component for your command-line application, which means your application is theoretically functional. To test this, you can either install your application directly using the <samp class="listingcharacter listingcharacter">npm install -g .</samp> command, or you can use the <samp class="listingcharacter listingcharacter">npm link</samp><a class="indexanchor" id="i15_45"/> command. In this context, you enter the <samp class="listingcharacter listingcharacter">npm link</samp> command in the root directory of your application. npm takes care of everything else by ensuring that the application is installed globally. For this purpose, a symbolic link<a class="indexanchor" id="i15_46"/> to the executable file is created in the global directory. In addition, the application directory is linked into the global <span class="italic">node_modules</span> directory. The advantage of <samp class="listingcharacter listingcharacter">npm link</samp> over an installation with <samp class="listingcharacter listingcharacter">npm install</samp> is that the link makes all changes to the application effective immediately, and you don’t have to reinstall the application. The command, <samp class="listingcharacter listingcharacter">npm uninstall -g math-trainer</samp> allows you to remove the link again when you’ve finished your development work.</p>
            <p class="standard">Whether you choose to install or link, after running the command, you’ll be able to use Math Trainer system-wide. To do this, you enter the <samp class="listingcharacter listingcharacter">math-trainer</samp> command in the command line in any directory on your system. The result is shown in <span class="crossreference "><a href="15_002.html#l15.7">Listing 15.7</a></span>.</p>
            <div class="listing " id="l15.7"><pre>$ <span class="bold"><samp class="listingcharacter listingcharacter">math-trainer</samp></span><br/>{ task: '33 + 3', result: 36, input: '' }<br/>{ task: '99 + 4', result: 103, input: '' }<br/>{ task: '68 + 5', result: 73, input: '' }<br/>{ task: '80 + 0', result: 80, input: '' }<br/>{ task: '9 - 48', result: -39, input: '' }<br/>{ task: '47 - 3', result: 44, input: '' }<br/>{ task: '9 - 5', result: 4, input: '' }<br/>{ task: '56 - 1', result: 55, input: '' }<br/>{ task: '2 * 6', result: 12, input: '' }<br/>{ task: '34 * 8', result: 272, input: '' }<br/>{ task: '26 * 3', result: 78, input: '' }<br/>{ task: '76 * 7', result: 532, input: '' }<br/>{ task: '0 / 32', result: 0, input: '' }<br/>{ task: '252 / 3', result: 84, input: '' }<br/>{ task: '60 / 6', result: 10, input: '' }<br/>{ task: '264 / 88', result: 3, input: '' } </pre></div>
            <p class="caption "><b>Listing 15.7</b>    
            Running Math Trainer</p>
            <p class="standard">In the following sections, you’ll extend Math Trainer into a full-fledged application that a user can interact with.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>