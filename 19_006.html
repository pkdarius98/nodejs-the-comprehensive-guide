<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Working with Files" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Working with Files" name="description"/>
            <meta content="en" name="language"/>
            <title>Working with Files</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h19.6">19.6    Directory Operations<a class="indexanchor" id="i19_41"/></h2>
        <p class="standard">In addition to editing files, you can also manipulate entire directories with using the <samp class="listingcharacter listingcharacter">fs</samp> module of Node.js. The range of available operations extends from creating to renaming to deleting directories. But there’s also a wide range of usage areas for this type of file system operations. For example, if you create an installation routine for your application in Node.js, you can generate the necessary directory structure.</p>
        <p class="standard">Directories appear in your application whenever you need to structure larger amounts of files. A concrete example of this is cache files that you place in a directory structure for faster access. The search operations<a class="indexanchor" id="i19_42"/> of the operating systems are usually faster in a deeper directory structure with relatively few files per directory than with very many files in a single directory.</p>
        <p class="standard">In the course of this section, you’ll learn about different ways to navigate and manipulate directory structures. As an example, you’ll implement a very lightweight file system browser that makes it possible to interactively list the contents of directories, move within the directory structure, and create, rename, and delete files and directories from the command line.</p>
        <p class="standard">The entire source code of this example is shown in <span class="crossreference "><a href="19_006.html#l19.13">Listing 19.13</a></span>. Following this example, we’ll explain the individual steps and the respective peculiarities of the methods used.</p>
        <div class="listing " id="l19.13"><pre><span class="rot">import</span><span class="schwarz"> fs </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'fs'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">class Explorer</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="schwarz">constructor()</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    process<span class="schwarz">.</span><span class="schwarz">stdin</span><span class="schwarz">.resume();</span><span class="schwarz"><br/></span>    process<span class="schwarz">.</span><span class="schwarz">stdin</span><span class="schwarz">.setEncoding(</span><span class="hellblau">'utf8'</span><span class="schwarz">);</span><span class="schwarz"><br/></span>    process<span class="schwarz">.</span><span class="schwarz">stdin</span><span class="schwarz">.on(</span><span class="hellblau">'data'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">this</span><span class="schwarz">.</span><span class="schwarz">dispatch</span><span class="schwarz">.bind(</span><span class="rot">this</span><span class="schwarz">));</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><a id="p587"/> <br/>  <span class="schwarz">dispatch(</span><span class="schwarz">chunk</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">const</span><span class="schwarz"> result </span><span class="dunkelblau">=</span><span class="schwarz"> chunk</span><span class="schwarz">.match(</span><span class="dunkelblau">/</span><span class="schwarz">(</span><span class="schwarz">\w</span><span class="dunkelblau">*</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">(.</span><span class="dunkelblau">*</span><span class="schwarz">)</span><span class="dunkelblau">/</span><span class="schwarz">);</span><span class="schwarz"><br/></span>    <span class="rot">let</span><span class="schwarz"> command </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="hellblau">''</span><span class="schwarz">;</span><span class="schwarz"><br/></span>    <span class="rot">let</span><span class="schwarz"> path </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="hellblau">''</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/>    <span class="rot">if</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">result </span><span class="dunkelblau">!==</span><span class="schwarz"> </span><span class="rot">null</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>      command <span class="dunkelblau">=</span><span class="schwarz"> result</span><span class="schwarz">[1];</span><span class="schwarz"><br/></span>      path <span class="dunkelblau">=</span><span class="schwarz"> result</span><span class="schwarz">[2];</span><span class="schwarz"><br/></span>    <span class="schwarz">}</span><span class="schwarz"><br/></span> <br/>    <span class="rot">switch</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">command</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>      <span class="rot">case</span><span class="schwarz"> </span><span class="hellblau">'list'</span><span class="schwarz">:</span><span class="schwarz"><br/></span>        <span class="rot">this</span><span class="schwarz">.display(</span><span class="schwarz">path</span><span class="schwarz">);</span><span class="schwarz"><br/></span>        <span class="rot">break</span><span class="schwarz">;</span><span class="schwarz"><br/></span>      <span class="rot">case</span><span class="schwarz"> </span><span class="hellblau">'change'</span><span class="schwarz">:</span><span class="schwarz"><br/></span>        process<span class="schwarz">.chdir(</span><span class="schwarz">path</span><span class="schwarz">);</span><span class="schwarz"><br/></span>        <span class="rot">this</span><span class="schwarz">.listCurrent();</span><span class="schwarz"><br/></span>        <span class="rot">break</span><span class="schwarz">;</span><span class="schwarz"><br/></span>      <span class="rot">case</span><span class="schwarz"> </span><span class="hellblau">'file'</span><span class="schwarz">:</span><span class="schwarz"><br/></span>        fs<span class="schwarz">.writeFile(</span><span class="schwarz">path</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">''</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">this</span><span class="schwarz">.</span><span class="schwarz">listCurrent</span><span class="schwarz">.bind(</span><span class="rot">this</span><span class="schwarz">));</span><span class="schwarz"><br/></span>        <span class="rot">break</span><span class="schwarz">;</span><span class="schwarz"><br/></span>      <span class="rot">case</span><span class="schwarz"> </span><span class="hellblau">'remove'</span><span class="schwarz">:</span><span class="schwarz"><br/></span>        fs<span class="schwarz">.stat(</span><span class="schwarz">path</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">err</span><span class="schwarz">,</span><span class="schwarz"> stat</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>          <span class="rot">if</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">stat</span><span class="schwarz">.isFile())</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>            fs<span class="schwarz">.unlink(</span><span class="schwarz">path</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">this</span><span class="schwarz">.</span><span class="schwarz">listCurrent</span><span class="schwarz">.bind(</span><span class="rot">this</span><span class="schwarz">));</span><span class="schwarz"><br/></span>          <span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">else</span><span class="schwarz"> </span><span class="rot">if</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">stat</span><span class="schwarz">.isDirectory())</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>            fs<span class="schwarz">.rmdir(</span><span class="schwarz">path</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">this</span><span class="schwarz">.</span><span class="schwarz">listCurrent</span><span class="schwarz">.bind(</span><span class="rot">this</span><span class="schwarz">));</span><span class="schwarz"><br/></span>          <span class="schwarz">}</span><span class="schwarz"><br/></span>        <span class="schwarz">});</span><span class="schwarz"><br/></span>        <span class="rot">break</span><span class="schwarz">;</span><span class="schwarz"><br/></span>      <span class="rot">case</span><span class="schwarz"> </span><span class="hellblau">'directory'</span><span class="schwarz">:</span><span class="schwarz"><br/></span>        fs<span class="schwarz">.mkdir(</span><span class="schwarz">path</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">this</span><span class="schwarz">.</span><span class="schwarz">listCurrent</span><span class="schwarz">.bind(</span><span class="rot">this</span><span class="schwarz">));</span><span class="schwarz"><br/></span>        <span class="rot">break</span><span class="schwarz">;</span><span class="schwarz"><br/></span>      <span class="rot">case</span><span class="schwarz"> </span><span class="hellblau">'rename'</span><span class="schwarz">:</span><span class="schwarz"><br/></span>        <span class="rot">const</span><span class="schwarz"> paths </span><span class="dunkelblau">=</span><span class="schwarz"> path</span><span class="schwarz">.split(</span><span class="hellblau">' '</span><span class="schwarz">);</span><span class="schwarz"><br/></span>        fs<span class="schwarz">.rename(</span><span class="schwarz">paths</span><span class="schwarz">[0],</span><span class="schwarz"> paths</span><span class="schwarz">[1],</span><span class="schwarz"> </span><span class="rot">this</span><span class="schwarz">.</span><span class="schwarz">listCurrent</span><span class="schwarz">.bind(</span><span class="rot">this</span><span class="schwarz">));</span><span class="schwarz"><br/></span>        <span class="rot">break</span><span class="schwarz">;</span><span class="schwarz"><br/></span>      <span class="rot">default</span><span class="schwarz">:</span><span class="schwarz"><br/></span>        process<span class="schwarz">.exit();</span><span class="schwarz"><br/></span>        <span class="rot">break</span><span class="schwarz">;</span><span class="schwarz"><br/></span>    <span class="schwarz">}</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span>  <span class="schwarz">listCurrent()</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span><a id="p588"/>    <span class="rot">this</span><span class="schwarz">.dispatch(</span><span class="violett">`list ${process.cwd()}`</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span> <br/>  <span class="schwarz">display(</span><span class="schwarz">path</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="magenta">console</span><span class="schwarz">.log(</span><span class="violett">`Current directory: ${process.cwd()}\n\n`</span><span class="schwarz">);</span><span class="schwarz"><br/></span> <br/>    fs<span class="schwarz">.readdir(</span><span class="schwarz">path</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">err</span><span class="schwarz">,</span><span class="schwarz"> files</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>      <span class="rot">let</span><span class="schwarz"> result </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="hellblau">''</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/>      <span class="rot">for</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="rot">let</span><span class="schwarz"> i </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">0;</span><span class="schwarz"> i </span><span class="dunkelblau">&lt;</span><span class="schwarz"> files</span><span class="schwarz">.</span><span class="schwarz">length</span><span class="schwarz">;</span><span class="schwarz"> i</span><span class="dunkelblau">++</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>        result <span class="dunkelblau">+=</span><span class="schwarz"> files</span><span class="schwarz">[</span><span class="schwarz">i</span><span class="schwarz">]</span><span class="schwarz"> </span><span class="dunkelblau">+</span><span class="schwarz"> </span><span class="hellblau">'\t'</span><span class="schwarz">;</span><span class="schwarz"><br/></span>        <span class="rot">if</span><span class="schwarz"> </span><span class="schwarz">((</span><span class="schwarz">i </span><span class="dunkelblau">+</span><span class="schwarz"> </span><span class="schwarz">1)</span><span class="schwarz"> </span><span class="dunkelblau">%</span><span class="schwarz"> </span><span class="schwarz">4</span><span class="schwarz"> </span><span class="dunkelblau">===</span><span class="schwarz"> </span><span class="schwarz">0)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>          result <span class="dunkelblau">+=</span><span class="schwarz"> </span><span class="hellblau">'\n'</span><span class="schwarz">;</span><span class="schwarz"><br/></span>        <span class="schwarz">}</span><span class="schwarz"><br/></span>      <span class="schwarz">}</span><span class="schwarz"><br/></span> <br/>      <span class="rot">const</span><span class="schwarz"> diff </span><span class="dunkelblau">=</span><span class="schwarz"> process</span><span class="schwarz">.</span><span class="schwarz">stdout</span><span class="schwarz">.</span><span class="schwarz">rows </span><span class="dunkelblau">-</span><span class="schwarz"> files</span><span class="schwarz">.</span><span class="schwarz">length</span><span class="schwarz">;</span><span class="schwarz"><br/></span>      <span class="rot">if</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">diff </span><span class="dunkelblau">&gt;</span><span class="schwarz"> </span><span class="schwarz">0)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>        <span class="rot">for</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="rot">let</span><span class="schwarz"> i </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">0;</span><span class="schwarz"> i </span><span class="dunkelblau">&lt;</span><span class="schwarz"> diff</span><span class="schwarz">;</span><span class="schwarz"> i</span><span class="dunkelblau">++</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>          result <span class="dunkelblau">+=</span><span class="schwarz"> </span><span class="hellblau">'\n'</span><span class="schwarz">;</span><span class="schwarz"><br/></span>        <span class="schwarz">}</span><span class="schwarz"><br/></span>      <span class="schwarz">}</span><span class="schwarz"><br/></span> <br/>      <span class="magenta">console</span><span class="schwarz">.log(</span><span class="violett">`${result}</span><br/> <br/>Available commands:<br/>list, change, file, remove, directory, rename, exit<br/>Your input: `<span class="schwarz">);</span><span class="schwarz"><br/></span>    <span class="schwarz">});</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> explorer </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Explorer();</span><span class="schwarz"><br/></span>explorer<span class="schwarz">.listCurrent();</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 19.13</b>    
            File System Browser in Node.js</p>
        <p class="standard">The core of the file system browser is the <samp class="listingcharacter listingcharacter">Explorer</samp> class. In the constructor, the command line is prepared, and the <samp class="listingcharacter listingcharacter">dispatch</samp> method of the explorer is bound to the <samp class="listingcharacter listingcharacter">data</samp> event of the standard input<a class="indexanchor" id="i19_43"/>. The <samp class="listingcharacter listingcharacter">dispatch</samp> method is responsible for the actual processing of the command and supports the following commands:</p>
        <ul>
            <li>
                <p class="standard first-item last-item"><span class="bold"><samp class="listingcharacter listingcharacter">list</samp></span><br/>Display of the desired directory content by calling the <samp class="listingcharacter listingcharacter">display</samp> method.</p>
            </li>
            <li>
                <p class="standard first-item last-item"><span class="bold"><samp class="listingcharacter listingcharacter"><a id="p589"/>change</samp></span><br/>Change of the current working directory and display of the content.</p>
            </li>
            <li>
                <p class="standard first-item last-item"><span class="bold"><samp class="listingcharacter listingcharacter">file</samp></span><br/>Creation of a new empty file.</p>
            </li>
            <li>
                <p class="standard first-item last-item"><span class="bold"><samp class="listingcharacter listingcharacter">remove</samp></span><br/>Deletion of a file or directory.</p>
            </li>
            <li>
                <p class="standard first-item last-item"><span class="bold"><samp class="listingcharacter listingcharacter">directory</samp></span><br/>Creation of a new directory.</p>
            </li>
            <li>
                <p class="standard first-item last-item"><span class="bold"><samp class="listingcharacter listingcharacter">rename</samp></span><br/>Renaming of a path.</p>
            </li>
            <li>
                <p class="standard first-item last-item"><span class="bold"><samp class="listingcharacter listingcharacter">exit</samp></span><br/>Exiting the application.</p>
            </li>
        </ul>
        <p class="standard">The commands are just wrappers around the actual file system functions of Node.js. Only the display of the folder contents requires a bit more logic. For this reason, you also swap out this functionality to the <samp class="listingcharacter listingcharacter">display</samp> method. This method ensures that the files and directories within a directory are output. The rest of the screen is filled with blank lines.</p>
        <p class="standard">You can use the application by running the script from the command line. Then you can enter the required command. In most cases, a command consisting of two parts is required, such as <samp class="listingcharacter listingcharacter">list /tmp</samp>, for example.</p>
        <p class="standard">In the concluding sections of this chapter, you’ll learn more about other features of the <samp class="listingcharacter listingcharacter">fs</samp> module that allow you, for example, to read metadata<a class="indexanchor" id="i19_44"/> from files, monitor files for changes, or manipulate the ownership and permissions of files.</p>
    </div><p class="signatur"/>
                    </body>
                </html>