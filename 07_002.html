<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Template Engines" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Template Engines" name="description"/>
            <meta content="en" name="language"/>
            <title>Template Engines</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h7.2">7.2    Template Engines in Practice: Pug<a class="indexanchor" id="i07_14"/></h2>
        <p class="standard">Given the quality of the available template engines, it doesn’t make sense to write another implementation yourself. A very widely used template engine for Node.js is called Pug and was known as Jade for a long time. Due to trademark issues, the engine was renamed from Jade<a class="indexanchor" id="i07_15"/> to Pug. In the following sections, you’ll learn about the most important features of such an engine and its practical use in an application, using Pug as an example. In this chapter, we’ll also go into more detail about the architecture and design of template structures. But first you need to install the engine on your system.</p>
        
            <h3 class="t3" id="h7.2.1">7.2.1    Installation<a class="indexanchor" id="i07_16"/></h3>
            <p class="standard">Pug is installed using the <samp class="listingcharacter listingcharacter">npm install pug</samp> command. Like so many other Node Package Manager (npm)<a class="indexanchor" id="i07_17"/> packages, Pug is an open-source project maintained on GitHub. You <a id="p216"/>can find the source code at <span class="url"><a href="https://github.com/pugjs/pug">https://github.com/pugjs/pug</a></span>. The project site, including extensive documentation, can be reached at <span class="url"><a href="https://pugjs.org">https://pugjs.org</a></span>.</p>
        
        
            <h3 class="t3" id="h7.2.2">7.2.2    Pug<a class="indexanchor" id="i07_18"/> and Express: Integration</h3>
            <p class="standard">Using the source code from <span class="crossreference "><a href="06_001.html#h6">Chapter 6</a></span> and having Pug installed in your application, you now can integrate Pug with your application. To do this, you must first expand the initial file as shown in <span class="crossreference "><a href="07_002.html#l7.2">Listing 7.2</a></span>.</p>
            <div class="listing " id="l7.2"><pre><span class="rot">import</span><span class="schwarz"> express </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> morgan </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'morgan'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> dirname </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'path'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> fileURLToPath </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'url'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> router </span><span class="rot">as</span><span class="schwarz"> movieRouter </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie/index.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> app </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">express();</span><span class="schwarz"><br/></span> <br/><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">app.set(<span class="hellblau">'view engine'</span><span class="schwarz">, </span><span class="hellblau">'pug'</span><span class="schwarz">);</span><br/> </samp></span><br/>app.use(express.static(<span class="violett">`${dirname(fileURLToPath(import.meta.url))}/public`</span><span class="schwarz">));</span><br/> <br/>app.use(morgan(<span class="hellblau">'common'</span><span class="schwarz">, { immediate: </span><span class="rot">true</span><span class="schwarz"> }));</span><br/> <br/>app.use(express.urlencoded({ extended: <span class="rot">false</span><span class="schwarz"> }));</span><br/> <br/>app.use(<span class="hellblau">'/movie'</span><span class="schwarz">, movieRouter);</span><br/> <br/>app.get(<span class="hellblau">'/'</span><span class="schwarz">, (request, response) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> response.redirect(</span><span class="hellblau">'/movie'</span><span class="schwarz">));</span><br/> <br/>app.listen(8080, () <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Server is listening to http://localhost:8080'</span><span class="schwarz">);</span><br/>}); <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 7.2</b>    
            Integrating Pug with Express</p>
            <p class="standard">Calling <samp class="listingcharacter listingcharacter">app.set('vie</samp>w <samp class="listingcharacter listingcharacter">engine', 'pug')</samp><a class="indexanchor" id="i07_19"/> causes the default template engine to be set from Express to Pug. This allows you to use the <samp class="listingcharacter listingcharacter">render</samp> method of the <samp class="listingcharacter listingcharacter">response</samp> object for rendering<a class="indexanchor" id="i07_20"/> your templates.</p>
            <p class="standard">By default, the <samp class="listingcharacter listingcharacter">render</samp><a class="indexanchor" id="i07_21"/> method expects the templates to be located in a <span class="italic">views</span> directory. By calling <samp class="listingcharacter listingcharacter">app.set('views', './templates')</samp>, you can change this behavior and adjust the default directory to <span class="italic">templates</span>, for example. In a modularized application like the movie database, however, a central default directory for the templates makes little sense. In this case, the templates are located in the respective modules.</p>
            <p class="standard"><a id="p217"/>The connection of a template engine to Express takes place through a method named <samp class="listingcharacter listingcharacter">__express</samp><a class="indexanchor" id="i07_22"/> in the respective template engine. Thus, Pug implements this method and then calls its own <samp class="listingcharacter listingcharacter">renderFile</samp> method. If you want to connect to another template engine, you just need to make sure that such a method is implemented, so you’re not limited to Pug.</p>
            <p class="standard">As a first view, you should change the list view to Pug. You can do this by changing it into a static version as a first step with a hard-coded data record. To do this, you must create a <span class="italic">views</span> subdirectory in the <span class="italic">movie</span> directory and create a file named <span class="italic">list.pug</span> there. Express expects the <span class="italic">.pug</span> file extension<a class="indexanchor" id="i07_23"/> for template files in combination with Pug. In <span class="crossreference "><a href="07_002.html#l7.3">Listing 7.3</a></span>, you can see that Pug uses its own syntax<a class="indexanchor" id="i07_24"/> for creating templates.</p>
            <div class="listing " id="l7.3"><pre>doctype html<br/>html(lang="en")<br/>  head<br/>    meta(charset="UTF-8")<br/>    title Movie list<br/>    link(rel="stylesheet" href="/style.css")<br/>  body<br/>    table<br/>      thead<br/>        tr<br/>          th Id<br/>          th Title<br/>          th Year<br/>          th<br/>          th<br/>      tbody<br/>        tr<br/>          td 1<br/>          td Iron Man<br/>          td 2008<br/>          td<br/>            a(href="/movie/delete/1") delete<br/>          td<br/>            a(href="/movie/form/1") edit<br/>    a(href="/movie/form") new </pre></div>
            <p class="caption "><b>Listing 7.3</b>    
            Pug Template for the List View (movie/views/list.pug)</p>
            <p class="standard">Pug changes the structure of the file considerably, which means the angle brackets of the tags are dropped and so are the closing tags. The first word in a line is interpreted as a tag. The indention of the lines reflects the nesting in the Document Object Model <a id="p218"/>(DOM). The attributes of an element are written in parentheses after the tag name, followed by the textual content of a node. To use this template in your application, you should use the <samp class="listingcharacter listingcharacter">render</samp> method instead of the <samp class="listingcharacter listingcharacter">send</samp> method of the <samp class="listingcharacter listingcharacter">response</samp> object in the <samp class="listingcharacter listingcharacter">listAction</samp> of the controller. <span class="crossreference "><a href="07_002.html#l7.4">Listing 7.4</a></span> contains the corresponding source code.</p>
            <div class="listing " id="l7.4"><pre><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> { dirname } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'path'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { fileURLToPath } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'url'</span><span class="schwarz">;</span></samp></span><br/><span class="rot">import</span><span class="schwarz"> { getAll, remove, </span><span class="rot">get</span><span class="schwarz">, save } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./model.js'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { render } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./view.js'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { render </span><span class="rot">as</span><span class="schwarz"> form } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./form.js'</span><span class="schwarz">;</span><br/> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> listAction(request, response) {</span><br/>  <span class="rot">const</span><span class="schwarz"> data </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> getAll();</span><br/>  <span class="bold"><samp class="listingcharacter listingcharacter">response.render(<span class="violett">`${dirname(fileURLToPath(import.meta.url))}/views/list`</span><span class="schwarz">);</span></samp></span><br/>}<br/> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> removeAction(request, response) {...}</span><br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> formAction(request, response) {...}</span><br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> saveAction(request, response) {...} </span><span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 7.4</b>    
            Rendering the List Template (movie/controller.js)</p>
            <p class="standard">Specifying <samp class="listingcharacter listingcharacter">`${dirname(fileURLToPath(import.meta.url))}/views/list`</samp> ensures that the local views directory of the module is used instead of the default views directory<a class="indexanchor" id="i07_25"/> of Express. The <span class="italic">.pug</span> file extension is added automatically by Express. You can now start your application via the <samp class="listingcharacter listingcharacter">npm start</samp> command, and you’ll see in your browser the list with a static entry, as shown in <span class="crossreference "><a href="07_002.html#f7.1">Figure 7.1</a></span>.</p>
            <div class="imagebox figure-type"><a href="img-f7.1.html" id="f7.1"><img alt="List View" id="img-f7.1" src="bilderklein/klein07_001.png"/></a></div>
            <p class="caption "><b>Figure 7.1</b>    
            List View</p>
            <p class="standard">If you take a look at <span class="crossreference "><a href="07_002.html#f7.2">Figure 7.2</a></span>, which shows the delivered source code of the page, you’ll notice that the result of template processing by Pug is standards-compliant HTML<a class="indexanchor" id="i07_26"/>.</p>
            <div class="imagebox figure-type"><a href="img-f7.2.html" id="f7.2"><img alt="HTML Source Code of the List Display" id="img-f7.2" src="bilderklein/klein07_002.png"/></a></div>
            <p class="caption "><b>Figure 7.2</b>    
            <a id="p219"/>HTML Source Code of the List Display</p>
        
        
            <h3 class="t3" id="h7.2.3">7.2.3    Variables<a class="indexanchor" id="i07_27"/> in Pug</h3>
            <p class="standard">As you’ve seen in the previous examples, by using Pug, you can deliver static HTML files just as well and generate less overhead. The use of template engines becomes really useful when you use dynamic elements<a class="indexanchor" id="i07_28"/> or assemble a page from several parts. Like many other template engines, Pug supports the use of variables in templates. This allows you to pass an object to the <samp class="listingcharacter listingcharacter">render</samp> method, which you can access in the template.</p>
            <p class="standard">The source code shown in <span class="crossreference "><a href="07_002.html#l7.5">Listing 7.5</a></span> ensures that you can access the <samp class="listingcharacter listingcharacter">movie</samp> object in the template. In the template, you can then access the object via interpolation<a class="indexanchor" id="i07_29"/>. To do this, you must use the <samp class="listingcharacter listingcharacter">#{&lt;variable&gt;}</samp> syntax, where <samp class="listingcharacter listingcharacter">&lt;variable&gt;</samp> corresponds to the name of the variable you want to access. You’re not limited to just reading variables but can also have any JavaScript expressions<a class="indexanchor" id="i07_30"/> evaluated. However, you should refrain from doing this because logic within the template worsens the maintainability of your application.</p>
            <div class="listing " id="l7.5"><pre><span class="rot"><a id="p220"/>export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">listAction(</span><span class="schwarz">request</span><span class="schwarz">,</span><span class="schwarz"> response</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> data </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> </span><span class="schwarz">getAll();</span><span class="schwarz"><br/></span>  response<span class="schwarz">.render(</span><span class="violett">`${dirname(fileURLToPath(import.meta.url))}/views/list`</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">{<br/>    movie: data[0],<br/>  }</samp></span>);<br/>} <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 7.5</b>    
            Passing an Object to the Template (movie/controller.js)</p>
            <p class="standard">In addition to interpolation, <span class="crossreference "><a href="07_002.html#l7.6">Listing 7.6</a></span> also shows how you can use variables in attributes via the <samp class="listingcharacter listingcharacter">href</samp> attribute. In this case, you don’t need to use any special syntax, but you can access the variables directly and join the target path by string concatenation.</p>
            <div class="listing " id="l7.6"><pre>doctype html<br/>html(lang="en")<br/>  head<br/>    meta(charset="UTF-8")<br/>    title Movie list<br/>    link(rel="stylesheet" href="/style.css")<br/>  body<br/>    table<br/>      thead<br/>        tr<br/>          th Id<br/>          th Title<br/>          th Year<br/>          th<br/>          th<br/>      tbody<br/>        tr<br/>          <span class="bold"><samp class="listingcharacter listingcharacter">td #{movie.id}<br/>          td #{movie.title}<br/>          td #{movie.year}</samp></span><br/>          td<br/>            a(href="/movie/delete/" + <span class="bold"><samp class="listingcharacter listingcharacter">movie.id</samp></span>) delete<br/>          td<br/>            a(href="/movie/form/" + <span class="bold"><samp class="listingcharacter listingcharacter">movie.id</samp></span>) edit<br/>    a(href="/movie/form") new </pre></div>
            <p class="caption "><b>Listing 7.6</b>    
            Using Variables in the Template (movie/views/list.pug)</p>
            <p class="standard">When using variables in Pug, you should note that the template engine escapes<a class="indexanchor" id="i07_31"/> the values to be displayed for security reasons to prevent malicious code from being introduced. For example, the <samp class="listingcharacter listingcharacter">&lt;</samp> and <samp class="listingcharacter listingcharacter">&gt;</samp> characters are masked so that you can’t insert tags in the variables. If you want to bypass this filtering<a class="indexanchor" id="i07_32"/>, you must use the character combination <samp class="listingcharacter listingcharacter">!{}</samp> instead of <samp class="listingcharacter listingcharacter">#{}</samp>. And that wasn’t even the only specific feature of the Pug template engine.</p>
        
        
            <h3 class="t3" id="h7.2.4">7.2.4    <a id="p221"/>Specific Features of Pug<a class="indexanchor" id="i07_33"/></h3>
            <p class="standard">One of the most important differences of Pug compared to other template engines such as Handlebars is the formulation of templates. Whereas in other cases you resort to HTML, in Pug, you write the templates in a specific syntax. As you’ve already seen in the examples, this syntax isn’t at all reminiscent of HTML. The word at the beginning of the line is automatically interpreted as a tag. This notation forces a developer to better and more clearly structure<a class="indexanchor" id="i07_34"/> the templates. Too deep a nesting will be noticed very quickly here, as you’ll have to indent nested tags. For indention, you can choose either two or four spaces. However, you should maintain this standard consistently for the entire project.</p>
            <p class="standard">Because Pug interprets the beginning of a line as an HTML tag, it becomes difficult to insert multiline<a class="indexanchor" id="i07_35"/> blocks. There are several ways to solve this. First, Pug interprets any line that starts with a <samp class="listingcharacter listingcharacter">&lt;</samp> character as text. This means, for example, that regular HTML tags can be written without any problem. Another option is to have a period directly follow the tag that is to be followed by the text. A third variant is to place a <samp class="listingcharacter listingcharacter">|</samp> symbol at the beginning of the line. Even then, Pug interprets this line as text.</p>
            <p class="standard">To organize your HTML code and also to apply CSS, HTML classes and IDs are used in most cases. A class is introduced by a <samp class="listingcharacter listingcharacter">.</samp> and an ID by a <samp class="listingcharacter listingcharacter">#</samp> character; each directly follows the tag. You can combine classes, IDs, and also multiple classes by simply concatenating them. In Pug, you can use any attributes besides the <samp class="listingcharacter listingcharacter">class</samp> and <samp class="listingcharacter listingcharacter">id</samp> attribute. All you have to do is write them in parentheses after the tag. <span class="crossreference "><a href="07_002.html#t7.1">Table 7.1</a></span> summarizes the most important statements in Pug.</p>
            <table class="standardtable" id="t7.1">
                <thead>
                    <tr>
                        <th class="tablehead tablecell_first top_border_cell">
                            <p class="standard first-item last-item">Statement</p>
                        </th>
                        <th class="tablehead tablecell_last top_border_cell">
                            <p class="standard first-item last-item">Description</p>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="tablecell tablecell_first top_border_cell">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">tag.myClass</samp></p>
                        </td>
                        <td class="tablecell tablecell_last top_border_cell">
                            <p class="standard first-item last-item">This sets the HTML <samp class="listingcharacter listingcharacter">class</samp> attribute to the value <samp class="listingcharacter listingcharacter">myClass</samp>.</p>
                        </td>
                    </tr>
                    <tr class="light">
                        <td class="tablecell tablecell_first">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">tag#myId</samp></p>
                        </td>
                        <td class="tablecell tablecell_last">
                            <p class="standard first-item last-item">This sets the HTML <samp class="listingcharacter listingcharacter">id</samp> attribute to the value <samp class="listingcharacter listingcharacter">myId</samp>.</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="tablecell tablecell_first">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">tag(href="www.google.com")</samp></p>
                        </td>
                        <td class="tablecell tablecell_last">
                            <p class="standard first-item last-item">The <samp class="listingcharacter listingcharacter">href</samp> attribute is set to the value <samp class="listingcharacter listingcharacter">www.google.com</samp>.</p>
                        </td>
                    </tr>
                    <tr class="light">
                        <td class="tablecell tablecell_first">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">tag text<br/>  | more text</samp></p>
                        </td>
                        <td class="tablecell tablecell_last">
                            <p class="standard first-item last-item">The <samp class="listingcharacter listingcharacter">|</samp> indicates that the text in the second line still belongs to the previous tag.</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="tablecell tablecell_first">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">${1 + 1}</samp></p>
                        </td>
                        <td class="tablecell tablecell_last">
                            <p class="standard first-item last-item">The expression is interpreted as JavaScript code, and the result is output in the template.</p>
                        </td>
                    </tr>
                    <tr class="light">
                        <td class="tablecell tablecell_first">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">- for (var i = 0; i &lt; 10; i++)</samp></p>
                        </td>
                        <td class="tablecell tablecell_last">
                            <p class="standard first-item last-item">Everything that follows a <samp class="listingcharacter listingcharacter">-</samp> after the beginning of the line is interpreted as JavaScript code; the result isn’t output.</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="tablecell tablecell_first">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">// Comment</samp></p>
                        </td>
                        <td class="tablecell tablecell_last">
                            <p class="standard first-item last-item">Everything that follows <samp class="listingcharacter listingcharacter">//</samp> is interpreted as an HTML comment. You can also form blocks by indention.</p>
                        </td>
                    </tr>
                </tbody>
            </table>
            <p class="caption "><b>Table 7.1</b>    
            Most Important Statements in Pug</p>
        
        
            <h3 class="t3" id="h7.2.5">7.2.5    <a id="p222"/>Conditions<a class="indexanchor" id="i07_36"/> and Loops<a class="indexanchor" id="i07_37"/></h3>
            <p class="standard">As you already know, you should avoid having program logic<a class="indexanchor" id="i07_38"/> in your templates. However, there are some exceptions to this rule. These exceptions are the reason elements such as loops or conditions exist in template engines. Currently, your application displays only the first entry from the database. To be more flexible in this context, you can use a loop to iterate over the individual entries. To do this, you must first ensure that the controller passes all records to the view. <span class="crossreference "><a href="07_002.html#l7.7">Listing 7.7</a></span> shows the customized controller code and how you can use the object shortcut notation. For this to work, you still need to rename the <samp class="listingcharacter listingcharacter">data</samp> variable to <samp class="listingcharacter listingcharacter">movies</samp>.</p>
            <div class="listing " id="l7.7"><pre><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">listAction(</span><span class="schwarz">request</span><span class="schwarz">,</span><span class="schwarz"> response</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> </span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">movies</samp></span> <span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> getAll();</span><br/>  response.render(<span class="violett">`${dirname(fileURLToPath(import.meta.url))}/views/list`</span><span class="schwarz">, {</span><br/>    movies,<br/>  });<br/>} <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 7.7</b>    
            Assigning the Data Records to the View (movie/controller.js)</p>
            <p class="standard">In the template, the changes are limited to inserting the loop into the table. To include JavaScript code in a Pug template, you must precede the expression with a hyphen. For the loop, you can omit the curly brackets because the block limitation in Pug is implemented by indenting<a class="indexanchor" id="i07_39"/> the code. <span class="crossreference "><a href="07_002.html#l7.8">Listing 7.8</a></span> contains the customized code of the template.</p>
            <div class="listing " id="l7.8"><pre>doctype html<br/>html(lang="en")<br/>  head<br/>    meta(charset="UTF-8")<br/>    title Movie list<br/>    link(rel="stylesheet" href="/style.css")<br/>  body<br/>    table<br/>      thead<br/>        tr<br/>          th Id<br/>          th Title<br/>          th Year<br/>          th<br/>          th<br/>      tbody<br/>        <span class="bold"><samp class="listingcharacter listingcharacter">- for(let movie of movies)</samp></span><br/>          tr<br/>            td #{movie.id}<br/><a id="p223"/>            td #{movie.title}<br/>            td #{movie.year}<br/>            td<br/>              a(href="/movie/delete/" + movie.id) delete<br/>            td<br/>              a(href="/movie/form/" + movie.id) edit<br/>    a(href="/movie/form") new </pre></div>
            <p class="caption "><b>Listing 7.8</b>    
            Implementing a Loop in Pug (movie/views/list.pug)</p>
            <p class="standard">Inside the loop, you can access the Pug template syntax as usual. You can also use the local variable <samp class="listingcharacter listingcharacter">movie</samp> here. However, template engines such as Pug have a number of other functionalities that allow you to make your templates more maintainable and reusable.</p>
        
        
            <h3 class="t3" id="h7.2.6">7.2.6    Extends<a class="indexanchor" id="i07_40"/> and Includes<a class="indexanchor" id="i07_41"/></h3>
            <p class="standard">Extends and includes allow you to create reusable blocks and then combine them into larger templates. The extends feature starts from a base template in which certain blocks are overwritten. The includes feature works in exactly the opposite way—integrating other subtemplates into one template.</p>
            <p class="standard">But let’s first take a look at how the extends feature works. You should use this feature mainly if you have a base template<a class="indexanchor" id="i07_42"/> that is to be used for multiple pages within your application—if the page title and logo, for example, should always remain the same, while only the content area varies. You can see an example of such a base template in <span class="crossreference "><a href="07_002.html#l7.9">Listing 7.9</a></span>. Save this source code to a file named <span class="italic">base.pug</span> in the <span class="italic">templates</span> directory.</p>
            <div class="listing " id="l7.9"><pre>doctype html<br/>html(lang="en")<br/>  head<br/>    meta(charset="UTF-8")<br/>    title Movie list<br/>    link(rel="stylesheet" href="/style.css")<br/>  body<br/><br/>  img.logo(src="logo.png" height="50")<br/><br/>  block content<br/>    div No content </pre></div>
            <p class="caption "><b>Listing 7.9</b>    
            Base Template (templates/base.pug)</p>
            <p class="standard">The only special feature in your base template is the <samp class="listingcharacter listingcharacter">block</samp> markup<a class="indexanchor" id="i07_43"/>. You can overwrite it in a template that extends the base template. Optionally, you can specify placeholders that will be displayed if the block isn’t overwritten. For the example to work properly, <a id="p224"/>you need the logo of your application as a PNG file named <span class="italic">logo.png</span> in the <span class="italic">public</span> directory. You should also adjust your stylesheet a little. The code from <span class="crossreference "><a href="07_002.html#l7.10">Listing 7.10</a></span> ensures that the logo is displayed in the upper-right corner.</p>
            <div class="listing " id="l7.10"><pre><span class="gruen">...</span><br/>img.logo<span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="magenta">position</span><span class="schwarz">:</span><span class="dunkelblau"> absolute</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="magenta">top</span><span class="schwarz">:</span><span class="dunkelblau"> 0</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="magenta">right</span><span class="schwarz">:</span><span class="dunkelblau"> 10px</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 7.10</b>    
            Stylesheet (public/style.css)</p>
            <p class="standard">To use the base template, you still need to customize the list template of your application. <span class="crossreference "><a href="07_002.html#l7.11">Listing 7.11</a></span> contains the corresponding source code.</p>
            <div class="listing " id="l7.11"><pre><span class="bold"><samp class="listingcharacter listingcharacter">extends ../../templates/base<br/><br/>block content<br/>  h1 movie database</samp></span><br/>  table<br/>    thead<br/>      tr<br/>        th Id<br/>        th Title<br/>        th Year<br/>        th<br/>        th<br/>    tbody<br/>      - for(let movie of movies)<br/>        tr<br/>          td #{movie.id}<br/>          td #{movie.title}<br/>          td #{movie.year}<br/>          td<br/>            a(href="/movie/delete/" + movie.id) delete<br/>          td<br/>            a(href="/movie/form/" + movie.id) edit<br/>  a(href="/movie/form") new </pre></div>
            <p class="caption "><b>Listing 7.11</b>    
            Extending the Base Template (movie/views/list.pug)</p>
            <p class="standard">First, you bind the base template by using the <samp class="listingcharacter listingcharacter">extends</samp> keyword followed by the file name of the base template, in this case, <samp class="listingcharacter listingcharacter">base</samp>. After that, you just need to fill the blocks <a id="p225"/>with content. The base template has only one block. You address this block using <samp class="listingcharacter listingcharacter">block content</samp> and define the content of the page there. Markup outside the defined blocks or blocks<a class="indexanchor" id="i07_44"/> not defined in the base template are ignored. You can see the result of this example in <span class="crossreference "><a href="07_002.html#f7.3">Figure 7.3</a></span>.</p>
            <div class="imagebox figure-type"><a href="img-f7.3.html" id="f7.3"><img alt="Extends in Pug" id="img-f7.3" src="bilderklein/klein07_003.png"/></a></div>
            <p class="caption "><b>Figure 7.3</b>    
            Extends in Pug</p>
            <p class="standard">When using extends, it’s assumed that the basic structure<a class="indexanchor" id="i07_45"/> of several pages is similar. However, if you want to use the same blocks on several pages, you should use <samp class="listingcharacter listingcharacter">include</samp> instead. Note that includes are not only used to reuse<a class="indexanchor" id="i07_46"/> sections of templates but also to simplify and better structure templates by separating sections into separate files. The source code in <span class="crossreference "><a href="07_002.html#l7.12">Listing 7.12</a></span> allows you to outsource the structure of the individual list entries to a separate file.</p>
            <div class="listing " id="l7.12"><pre>tr<br/>  td #{movie.id}<br/>  td #{movie.title}<br/>  td #{movie.year}<br/>  td<br/>    a(href="/movie/delete/" + movie.id) delete<br/>  td<br/>    a(href="/movie/form/" + movie.id) edit </pre></div>
            <p class="caption "><b>Listing 7.12</b>    
            Includes in Pug (movie/views/list-item.pug)</p>
            <p class="standard">The partial template from <span class="crossreference "><a href="07_002.html#l7.12">Listing 7.12</a></span> doesn’t have a valid structure for an HTML page because it contains only the table row, but neither a doctype nor <samp class="listingcharacter listingcharacter">html</samp>, <samp class="listingcharacter listingcharacter">head</samp>, or <samp class="listingcharacter listingcharacter">body</samp> tags. This is already a first indication that this template is used elsewhere. The next step is to include the table row in the list template. <span class="crossreference "><a href="07_002.html#l7.13">Listing 7.13</a></span> shows how you can do this.</p>
            <div class="listing " id="l7.13"><pre><a id="p226"/>extends ../../templates/base<br/><br/>block content<br/>  h1 movie database<br/>  table<br/>    thead<br/>      tr<br/>        th Id<br/>        th Title<br/>        th Year<br/>        th<br/>        th<br/>    tbody<br/>      - for(let movie of movies)<br/>        include ./list-item<br/>  a(href="/movie/form") new </pre></div>
            <p class="caption "><b>Listing 7.13</b>    
            Embedding Templates in Pug (movie/views/list.pug)</p>
            <p class="standard">As you’ve seen in <span class="crossreference "><a href="07_002.html#l7.12">Listing 7.12</a></span> and <span class="crossreference "><a href="07_002.html#l7.13">Listing 7.13</a></span>, you can access variables of the including template from within an include<a class="indexanchor" id="i07_47"/>. The problem with this type of inclusion is that you must rely on the outer template to provide the appropriate variables. Furthermore, it isn’t obvious at first glance which variables are required for such an include to function. Includes are therefore better suited for independent subtemplates. If the template needs to be integrated into an environment with certain variables, the mixins presented next are more suitable.</p>
        
        
            <h3 class="t3" id="h7.2.7">7.2.7    Mixins<a class="indexanchor" id="i07_48"/></h3>
            <p class="standard">A mixin is very similar to a function. You must first define a mixin, and then you can call it as often as you like. The result of such a call is a template block<a class="indexanchor" id="i07_49"/>. Like a function, a mixin can also be parameterized. A mixin allows you to create a dynamic HTML block relying on a defined interface, namely, the mixin’s signature. In the case of the list display, you can outsource the display of the list entries to a mixin. To do this, you must first modify the source code of the <samp class="listingcharacter listingcharacter">listItem</samp> template, as shown in <span class="crossreference "><a href="07_002.html#l7.14">Listing 7.14</a></span>.</p>
            <div class="listing " id="l7.14"><pre><span class="bold"><samp class="listingcharacter listingcharacter">mixin listItem(movie)</samp></span><br/>  tr<br/>    td #{movie.id}<br/>    td #{movie.title}<br/>    td #{movie.year}<br/>    td<br/><a id="p227"/>      a(href="/movie/delete/" + movie.id) delete<br/>    td<br/>      a(href="/movie/form/" + movie.id) edit </pre></div>
            <p class="caption "><b>Listing 7.14</b>    
            Defining a Mixin in Pug (movie/views/list-item.pug)</p>
            <p class="standard">To use this mixin, you must first include the file in your list template and then address the mixin. <span class="crossreference "><a href="07_002.html#l7.15">Listing 7.15</a></span> contains the necessary changes.</p>
            <div class="listing " id="l7.15"><pre>extends ../../templates/base<br/><span class="bold"><samp class="listingcharacter listingcharacter">include ./list-item<br/></samp></span><br/>block content<br/>  h1 movie database<br/>  table<br/>    thead<br/>      tr<br/>        th Id<br/>        th Title<br/>        th Year<br/>        th<br/>        th<br/>    tbody<br/>      - for(let movie of movies)<br/>        <span class="bold"><samp class="listingcharacter listingcharacter">+listItem(movie)</samp></span><br/>  a(href="/movie/form") new </pre></div>
            <p class="caption "><b>Listing 7.15</b>    
            Using the Mixin (movie/views/list.pug)</p>
            <p class="standard">As you can see in <span class="crossreference "><a href="07_002.html#l7.15">Listing 7.15</a></span>, you define a mixin via the <samp class="listingcharacter listingcharacter">mixin</samp> keyword followed by the mixin name. Optionally, you can also specify a parameter list<a class="indexanchor" id="i07_50"/> that you access within the mixin. You then use the mixin through its name preceded by a <samp class="listingcharacter listingcharacter">+</samp> sign. Mixins become particularly interesting when you combine them with includes. Specifically, this means that you can either swap out individual mixins or a collection of mixins into a separate file, include it via includes, and then use it. With such a strategy, you achieve maximum reusability of your mixins. It’s also sometimes helpful to group frequently used mixins together in some kind of library<a class="indexanchor" id="i07_51"/> that you can then use in multiple applications.</p>
            <p class="standard">Mixins are the last of the important features of Pug you should be aware of. You should now have a rough overview of how the template engine works and know how to write concise and reusable templates. At this point, we’ll discuss how you can use Pug without Express in your application.</p>
        
        
            <h3 class="t3" id="h7.2.8">7.2.8    <a id="p228"/>Using Pug without Express<a class="indexanchor" id="i07_52"/></h3>
            <p class="standard">Basically, Pug isn’t bound to Express. After installing the package, you can use Pug directly to render templates. In this context, you can access all the features already presented. In <span class="crossreference "><a href="07_002.html#l7.16">Listing 7.16</a></span>, the <samp class="listingcharacter listingcharacter">render</samp> method of Pug is used to render a template that is a JavaScript string.</p>
            <div class="listing " id="l7.16"><pre><span class="rot">import</span><span class="schwarz"> pug </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'pug'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> template </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="hellblau">'h1 Hello World'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> output </span><span class="dunkelblau">=</span><span class="schwarz"> pug</span><span class="schwarz">.render(</span><span class="schwarz">template</span><span class="schwarz">);</span><span class="schwarz"><br/></span> <br/><span class="magenta">console</span><span class="schwarz">.log(</span><span class="schwarz">output</span><span class="schwarz">);</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 7.16</b>    
            Direct Rendering with Pug</p>
            <p class="standard">After you include Pug via the module system, you can access one of several variants to render a character string. The simplest way to do that is the <samp class="listingcharacter listingcharacter">render</samp> method shown in <span class="crossreference "><a href="07_002.html#l7.16">Listing 7.16</a></span>. You pass it the template string and optionally an object with substitutions you want Pug to make. What you get in return is the transformed character string. If you run the example on your command line, you’ll get the string <samp class="listingcharacter listingcharacter">&lt;h1&gt;Hello World&lt;/h1&gt;</samp> as output.</p>
            <p class="standard">In addition to the <samp class="listingcharacter listingcharacter">render</samp> method, there is also the <samp class="listingcharacter listingcharacter">renderFile</samp> method, which allows you to swap out the template to a separate file. Basically, it works like the <samp class="listingcharacter listingcharacter">render</samp> method, except that instead of passing it a template string, you pass it the name of the template file.</p>
            <p class="standard">Finally, we’ll briefly introduce how Pug internally handles templates to optimize the runtime.</p>
        
        
            <h3 class="t3" id="h7.2.9">7.2.9    Compiling<a class="indexanchor" id="i07_53"/></h3>
            <p class="standard">To load the templates, Pug currently uses the <samp class="listingcharacter listingcharacter">readFileSync</samp> method. This function blocks the execution of the remaining source code because it waits for the completion of the read process. However, with Pug, this isn’t a big deal, especially when templates are used several times, because the template engine keeps a cache<a class="indexanchor" id="i07_54"/> of previously used templates. Pug divides the template processing process into two parts. First, the template is prepared in the compile process. The placeholders<a class="indexanchor" id="i07_55"/> are then inserted into this compiled template. Pug performs the compile operation only once for each template. All further uses of the templates are served from the cache. You can also address this feature directly, for example, by using the <samp class="listingcharacter listingcharacter">compileFile</samp> method. To demonstrate this feature, it’s best to use a simple template like the one shown in <span class="crossreference "><a href="07_002.html#l7.17">Listing 7.17</a></span>.</p>
            <div class="listing " id="l7.17"><pre><a id="p229"/>h1 Hello #{name} </pre></div>
            <p class="caption "><b>Listing 7.17</b>    
            Sample Template for the Compile Process (templates/compile.pug)</p>
            <p class="standard">In the next step, you compile the template using the <samp class="listingcharacter listingcharacter">compileFile</samp> method. For the source code to work, you should save the template in the <span class="italic">compile.pug</span> file within the <span class="italic">templates</span> directory.</p>
            <p class="standard">As you can see in <span class="crossreference "><a href="07_002.html#l7.18">Listing 7.18</a></span>, the <samp class="listingcharacter listingcharacter">compileFile</samp> method returns a function. This function represents the prepared template to which you still need to pass the placeholders, in this case, an object with the <samp class="listingcharacter listingcharacter">name</samp> key. You can call this function as often as you like and with different values. In the example, the compiled template is used in a web server. For each request, only the template function is called with the values, and the result is sent to the client.</p>
            <div class="listing " id="l7.18"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> createServer </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'http'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> pug </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'pug'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> fn </span><span class="dunkelblau">=</span><span class="schwarz"> pug</span><span class="schwarz">.compileFile(</span><span class="hellblau">'templates/compile.pug'</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">createServer((</span><span class="schwarz">req</span><span class="schwarz">,</span><span class="schwarz"> res</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">let</span><span class="schwarz"> output </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">fn({</span><span class="schwarz"> name</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'World'</span><span class="schwarz"> </span><span class="schwarz">});</span><span class="schwarz"><br/></span>  output <span class="dunkelblau">+=</span><span class="schwarz"> </span><span class="schwarz">fn({</span><span class="schwarz"> name</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Node.js'</span><span class="schwarz"> </span><span class="schwarz">});</span><span class="schwarz"><br/></span> <br/>  res<span class="schwarz">.end(</span><span class="schwarz">output</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">}).listen(8080);</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 7.18</b>    
            Compiling Templates</p>
            <p class="standard">As mentioned earlier, Pug isn’t the only template engine for Node.js. An alternative, for example, is the more lightweight Handlebars.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>