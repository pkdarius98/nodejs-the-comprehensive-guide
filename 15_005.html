<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Node on the Command Line" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Node on the Command Line" name="description"/>
            <meta content="en" name="language"/>
            <title>Node on the Command Line</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h15.5">15.5    Signals<a class="indexanchor" id="i15_99"/></h2>
        <p class="standard">On a Unix system, a <span class="italic">signal</span> is a message<a class="indexanchor" id="i15_100"/> to a process. Such signals are often used to terminate a process. However, you can also just send some information to the process, for example, that the window size has changed. Most signals you send to a Node.js process cause an event to which you can bind a callback function to respond to the signal. For example, if a user presses the shortcut <span class="keyboard">(Ctrl)</span>+<span class="keyboard">(C)</span>, the <samp class="listingcharacter listingcharacter">SIGINT</samp> signal<a class="indexanchor" id="i15_101"/> gets triggered. You can intercept this via <samp class="listingcharacter listingcharacter">process.on('SIGINT', () =&gt; {})</samp> and act accordingly. When integrating it into your Math Trainer application, you have to keep in mind that the <samp class="listingcharacter listingcharacter">readline</samp> interface intercepts the signals, so you can’t respond to them directly. The solution to this problem is to register the event handler for the program termination not on the <samp class="listingcharacter listingcharacter">process</samp> object but on the <samp class="listingcharacter listingcharacter">rl</samp> object. Upon termination, the user should be shown a message that tells him how many tasks he has already solved until termination. For this purpose, you define another helper function and save it in the <span class="italic">lib/handleCancel.js</span> file. The source code of this file is shown in <span class="crossreference "><a href="15_005.html#l15.27">Listing 15.27</a></span>.</p>
        <div class="listing " id="l15.27"><pre><span class="rot">export</span><span class="schwarz"> </span><span class="rot">default</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">rl</span><span class="schwarz">,</span><span class="schwarz"> tasks</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  rl<span class="schwarz">.on(</span><span class="hellblau">'SIGINT'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">const</span><span class="schwarz"> solvedCount </span><span class="dunkelblau">=</span><span class="schwarz"> tasks</span><span class="schwarz">.reduce((</span><span class="schwarz">solvedCount</span><span class="schwarz">,</span><span class="schwarz"> task</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>      <span class="rot">if</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">task</span><span class="schwarz">.</span><span class="schwarz">input </span><span class="dunkelblau">!==</span><span class="schwarz"> </span><span class="hellblau">''</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>        solvedCount<span class="dunkelblau">++</span><span class="schwarz">;</span><span class="schwarz"><br/></span>      <span class="schwarz">}</span><span class="schwarz"><br/></span>      <span class="rot">return</span><span class="schwarz"> solvedCount</span><span class="schwarz">;</span><span class="schwarz"><br/></span>    <span class="schwarz">},</span><span class="schwarz"> </span><span class="schwarz">0);</span><span class="schwarz"><br/></span>    <span class="magenta">console</span><span class="schwarz">.log(</span><span class="schwarz"><br/></span>      <span class="violett">`\nToo bad you want to leave, you only solved ${solvedCount} </span><img alt="inline image" class="inline_image" src="bilder/umbruchpfeil.png"/><br/>        of ${tasks.length} tasks.`<span class="schwarz">,</span><span class="schwarz"><br/></span>    <span class="schwarz">);</span><span class="schwarz"><br/></span>    rl<span class="schwarz">.close();</span><span class="schwarz"><br/></span>  <span class="schwarz">});</span><span class="schwarz"><br/></span><span class="schwarz">};</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 15.27</b>    
            Integrating a Signal Handler (lib/handleCancel.js)</p>
        <p class="standard"><a id="p477"/>You pass a reference to the <samp class="listingcharacter listingcharacter">readline</samp> interface and the task array to the helper function. First, you register a handler function for the <samp class="listingcharacter listingcharacter">SIGINT</samp> signal. In the callback function, use the array-<samp class="listingcharacter listingcharacter">reduce</samp> function to calculate how many tasks have been solved. Then you issue a message and end the process. This step is needed because a custom signal handler overrides the default, so it’s no longer possible to exit the program via the <span class="keyboard">(Ctrl)</span>+<span class="keyboard">(C)</span> shortcut<a class="indexanchor" id="i15_102"/>.</p>
        <p class="standard">You still need to include the <samp class="listingcharacter listingcharacter">handleCancel</samp> function in the <span class="italic">lib/index.js</span> file now, so that you can intercept the signal correctly. <span class="crossreference "><a href="15_005.html#l15.28">Listing 15.28</a></span> shows the point at which you should integrate the function call.</p>
        <div class="listing " id="l15.28"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> createInterface </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'readline'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> chalk </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'chalk'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> createTask </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./task.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> promisedQuestion </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./promisedQuestion.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> getOptions </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./getOptions.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> summary </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./summary.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> handleCancel </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./handleCancel.js'</span><span class="schwarz">;</span><br/> </samp></span><br/><span class="rot">const</span><span class="schwarz"> { amount, level } </span><span class="dunkelblau">=</span><span class="schwarz"> getOptions();</span><br/> <br/><span class="rot">const</span><span class="schwarz"> operations </span><span class="dunkelblau">=</span><span class="schwarz"> [</span><span class="hellblau">'+'</span><span class="schwarz">, </span><span class="hellblau">'-'</span><span class="schwarz">, </span><span class="hellblau">'*'</span><span class="schwarz">, </span><span class="hellblau">'/'</span><span class="schwarz">];</span><br/><span class="rot">const</span><span class="schwarz"> tasks </span><span class="dunkelblau">=</span><span class="schwarz"> [];</span><br/> <br/>operations.forEach((operation) <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="rot">for</span><span class="schwarz"> (</span><span class="rot">let</span><span class="schwarz"> i </span><span class="dunkelblau">=</span><span class="schwarz"> 0; i </span><span class="dunkelblau">&lt;</span><span class="schwarz"> amount; i</span><span class="dunkelblau">++</span><span class="schwarz">) {</span><br/>    tasks.push(createTask(operation, level));<br/>  }<br/>});<br/> <br/><span class="rot">const</span><span class="schwarz"> rl </span><span class="dunkelblau">=</span><span class="schwarz"> createInterface({</span><br/>  input: process.stdin,<br/>  output: process.stdout,<br/>});<br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter">handleCancel(rl, tasks);<br/> </samp></span><br/><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> question(index) {</span><br/>  <span class="rot">const</span><span class="schwarz"> result </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> promisedQuestion(</span><span class="violett">`${tasks[index].task} = `</span><span class="schwarz">, rl);</span><br/>  tasks[index].input <span class="dunkelblau">=</span><span class="schwarz"> parseInt(result);</span><br/>  <span class="rot">if</span><span class="schwarz"> (tasks[index].input </span><span class="dunkelblau">===</span><span class="schwarz"> tasks[index].result) {</span><br/>    <span class="magenta">console</span><span class="schwarz">.log(chalk.bold.green(</span><span class="hellblau">'Correct!'</span><span class="schwarz">));</span><br/>  } <span class="rot">else</span><span class="schwarz"> {</span><br/>    <span class="magenta">console</span><span class="schwarz">.log(chalk.bold.red(</span><span class="hellblau">'Wrong'</span><span class="schwarz">));</span><br/>  }<br/><a id="p478"/>  <span class="rot">if</span><span class="schwarz"> (</span><span class="dunkelblau">++</span><span class="schwarz">index </span><span class="dunkelblau">&lt;</span><span class="schwarz"> tasks.length) {</span><br/>    question(index);<br/>  } <span class="rot">else</span><span class="schwarz"> {</span><br/>    <span class="magenta">console</span><span class="schwarz">.log(summary(tasks));</span><br/>    rl.close();<br/>  }<br/>}<br/> <br/>question(0); <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 15.28</b>    
            Integrating the Signal Handler (lib/index.js)</p>
        <p class="standard">If you restart your application after making these adjustments, you can terminate the application at any time by pressing <span class="keyboard">(Ctrl)</span>+<span class="keyboard">(C)</span> and obtain a summary like the one shown in <span class="crossreference "><a href="15_005.html#f15.1">Figure 15.1</a></span>.</p>
        <div class="imagebox figure-type"><a href="img-f15.1.html" id="f15.1"><img alt="Terminating the Application" id="img-f15.1" src="bilderklein/klein15_001.png"/></a></div>
        <p class="caption "><b>Figure 15.1</b>    
            Terminating the Application</p>
    </div><p class="signatur"/>
                    </body>
                </html>