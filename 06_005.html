<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Express" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Express" name="description"/>
            <meta content="en" name="language"/>
            <title>Express</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h6.5">6.5    Movie Database</h2>
        <p class="standard">A movie database will serve as a sample application for Express. This covers all essential aspects of a typical application. You can add movies to the database, view the existing records, update them if necessary, and also delete them. In addition, further functionalities such as ratings can be implemented. This application also serves as a basis for the following chapters when it comes to integrating template engines<a class="indexanchor" id="i06_29"/>, connecting different databases<a class="indexanchor" id="i06_30"/>, or authenticating users.</p>
        <p class="standard">For the sample application, we chose the structure of a large application, although it will initially consist of only one module. The reason is that this structure offers the highest degree of flexibility, allowing you to get to know more features of Express.</p>
        <p class="standard">The first step in the implementation of the application consists of the initialization. For this purpose, you should create a directory named <span class="italic">movie-db</span> and go to this directory via the command line. After that, you must run the <samp class="listingcharacter listingcharacter">npm init -y</samp> command to create a <span class="italic">package.json</span><a class="indexanchor" id="i06_31"/> file. Once you’ve created the file, you must add the <samp class="listingcharacter listingcharacter">type</samp> field with the <samp class="listingcharacter listingcharacter">module</samp> value to be able to use the ECMAScript module system<a class="indexanchor" id="i06_32"/>. You’re relatively free to choose a name, but you should select a unique name in case you want to publish your application. Note that the name must be written in lowercase letters and consist of only one word. However, it may contain hyphens and underscores. Then you must install Express using the <samp class="listingcharacter listingcharacter">npm install express</samp> command. <span class="crossreference "><a href="06_005.html#l6.2">Listing 6.2</a></span> shows the <span class="italic">package.json</span> file of the application.</p>
        <div class="listing " id="l6.2"><pre><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="hellblau">"name"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"node-book"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"version"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"1.0.0"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"description"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">""</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"main"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"index.js"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="hellblau">"type"</span><span class="schwarz">: </span><span class="hellblau">"module"</span><span class="schwarz">,</span></samp></span><br/>  <span class="hellblau">"scripts"</span><span class="schwarz">: {</span><br/>    <span class="bold"><samp class="listingcharacter listingcharacter"><span class="hellblau">"start"</span><span class="schwarz">: </span><span class="hellblau">"node index.js"</span></samp></span><span class="schwarz"><br/></span>  },<br/><a id="p186"/>  <span class="hellblau">"keywords"</span><span class="schwarz">: [],</span><br/>  <span class="hellblau">"author"</span><span class="schwarz">: </span><span class="hellblau">""</span><span class="schwarz">,</span><br/>  <span class="hellblau">"license"</span><span class="schwarz">: </span><span class="hellblau">"ISC"</span><span class="schwarz">,</span><br/>  <span class="hellblau">"dependencies"</span><span class="schwarz">: {</span><br/>    <span class="hellblau">"express"</span><span class="schwarz">: </span><span class="hellblau">"^4.17.1"</span><span class="schwarz"><br/></span>  }<br/>} <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 6.2</b>    
            Initial Configuration of the Application (package.json)</p>
        <p class="standard">The two changes you need to make manually to the file are the <samp class="listingcharacter listingcharacter">type</samp> field and a startup script that allows you to conveniently start your application using the <samp class="listingcharacter listingcharacter">npm start</samp> command.</p>
        <p class="standard">In the final step of initialization, you must create an <span class="italic">index.js</span> file in the root directory of your application as the entry point to your application. During development, you should make sure that this file is only responsible for initializing the application and doesn’t perform any other tasks. The preliminary source code of this file is shown in <span class="crossreference "><a href="06_005.html#l6.3">Listing 6.3</a></span>.</p>
        <div class="listing " id="l6.3"><pre><span class="rot">import</span><span class="schwarz"> express </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> app </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">express();</span><span class="schwarz"><br/></span> <br/>app<span class="schwarz">.listen(8080,</span><span class="schwarz"> </span><span class="schwarz">()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Server is listening to http://localhost:8080'</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 6.3</b>    
            Getting Started with the Application (index.js)</p>
        
            <h3 class="t3" id="h6.5.1">6.5.1    Routing<a class="indexanchor" id="i06_33"/></h3>
            <p class="standard">In the first step, you want your application to output a simple list of movie titles. For this purpose, you must first define a module, that is, a unit in your application that covers all aspects related to movies in the application. Based on the default guidelines for the structure, you first need a directory with the name of the module, in this case, <span class="italic">movie</span>. In this directory, you create a file named <span class="italic">index.js</span>. The file is the entry point to the module. If you integrate it into your application at a later point in time, this file ensures that all other relevant parts of the module are loaded so that the integration causes as little effort as possible.</p>
            <p class="standard">The index file of your module exports the <samp class="listingcharacter listingcharacter">router</samp> object<a class="indexanchor" id="i06_34"/> you later include in the index file of your application. In addition to creating the <samp class="listingcharacter listingcharacter">router</samp> object, this file currently takes care of managing the data and the response to the request in the callback function of the route. <span class="crossreference "><a href="06_005.html#l6.4">Listing 6.4</a></span> contains the source code of the file.</p>
            <div class="listing " id="l6.4"><pre><span class="rot"><a id="p187"/>import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> Router </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> router </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">Router();</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> data </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="schwarz"><br/></span>  <span class="schwarz">{</span><span class="schwarz"> id</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">1,</span><span class="schwarz"> title</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Iron Man'</span><span class="schwarz">,</span><span class="schwarz"> year</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'2008'</span><span class="schwarz"> </span><span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="schwarz">{</span><span class="schwarz"> id</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">2,</span><span class="schwarz"> title</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Thor'</span><span class="schwarz">,</span><span class="schwarz"> year</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'2011'</span><span class="schwarz"> </span><span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="schwarz">{</span><span class="schwarz"> id</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">3,</span><span class="schwarz"> title</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Captain America'</span><span class="schwarz">,</span><span class="schwarz"> year</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'2011'</span><span class="schwarz"> </span><span class="schwarz">},</span><span class="schwarz"><br/></span><span class="schwarz">];</span><span class="schwarz"><br/></span> <br/>router<span class="schwarz">.get(</span><span class="hellblau">'/'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">request</span><span class="schwarz">,</span><span class="schwarz"> response</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  response<span class="schwarz">.send(</span><span class="schwarz">data</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"><br/></span> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> router </span><span class="schwarz">};</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 6.4</b>    
            Router File of the Movie Module (movie/index.js)</p>
            <p class="standard">Before you can display the data in the browser, you must integrate the router into your application. This is done in the <span class="italic">index.js</span> file in the root directory of your application, as shown in <span class="crossreference "><a href="06_005.html#l6.5">Listing 6.5</a></span>.</p>
            <div class="listing " id="l6.5"><pre><span class="rot">import</span><span class="schwarz"> express </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> { router </span><span class="rot">as</span><span class="schwarz"> movieRouter } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie/index.js'</span><span class="schwarz">;</span><br/> </samp></span><br/><span class="rot">const</span><span class="schwarz"> app </span><span class="dunkelblau">=</span><span class="schwarz"> express();</span><br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter">app.use(<span class="hellblau">'/movie'</span><span class="schwarz">, movieRouter);</span><br/> <br/>app.get(<span class="hellblau">'/'</span><span class="schwarz">, (request, response) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> response.redirect(</span><span class="hellblau">'/movie'</span><span class="schwarz">));</span><br/> </samp></span><br/>app.listen(8080, () <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Server is listening to http://localhost:8080'</span><span class="schwarz">);</span><br/>}); <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 6.5</b>    
            Integrating the Router (index.js)</p>
            <p class="standard">When loading the router, you must specify the name of the file in the ECMAScript module system<a class="indexanchor" id="i06_35"/>, that is, <span class="italic">index.js</span>, as Node.js doesn’t use this automatically when specifying a directory. This is different from the CommonJS module system. To make the code a bit more meaningful, you should rename the <samp class="listingcharacter listingcharacter">router</samp> to <samp class="listingcharacter listingcharacter">movieRouter</samp> on import. The <samp class="listingcharacter listingcharacter">use</samp> method specifies that the <samp class="listingcharacter listingcharacter">movieRouter</samp> is responsible for the <samp class="listingcharacter listingcharacter">/movie</samp> path. Currently, users of your application need to know that the movie list can be found at <span class="italic">http://localhost:8080/movie</span>. By using the <samp class="listingcharacter listingcharacter">get</samp> route for the <span class="italic">/</span> path and then redirecting to <samp class="listingcharacter listingcharacter">/movie</samp>, you enable users to also access the list via <span class="italic">http://localhost:8080</span>. This way, you’ve defined the entry point for your application. If you start your application via the <samp class="listingcharacter listingcharacter">npm start</samp><a id="p188"/> or <samp class="listingcharacter listingcharacter">node index.js</samp> commands, you can open it in your browser and get a display similar to the one shown in <span class="crossreference "><a href="06_005.html#f6.6">Figure 6.6</a></span>.</p>
            <div class="imagebox figure-type"><a href="img-f6.6.html" id="f6.6"><img alt="Movie List in the Browser" id="img-f6.6" src="bilderklein/klein06_006.png"/></a></div>
            <p class="caption "><b>Figure 6.6</b>    
            Movie List in the Browser</p>
            
                <h4 class="t4" id="h6.5.1.1">Patterns in Routes<a class="indexanchor" id="i06_36"/></h4>
                <p class="standard">Static routes, as you’ve come to know them so far, cover most use cases in a web application. However, there are use cases where you reach the limits due to little flexibility. For this reason, it’s possible to formulate dynamic routes in Express.</p>
                <table class="standardtable" id="t6.3">
                    <thead>
                        <tr>
                            <th class="tablehead tablecell_first top_border_cell">
                                <p class="standard first-item last-item">Patterns</p>
                            </th>
                            <th class="tablehead tablecell_middle top_border_cell">
                                <p class="standard first-item last-item">Example</p>
                            </th>
                            <th class="tablehead tablecell_middle top_border_cell">
                                <p class="standard first-item last-item">Path</p>
                            </th>
                            <th class="tablehead tablecell_last top_border_cell">
                                <p class="standard first-item last-item">Description</p>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="tablecell tablecell_first top_border_cell">
                                <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">?</samp></p>
                            </td>
                            <td class="tablecell tablecell_middle top_border_cell">
                                <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">/ab?c</samp></p>
                            </td>
                            <td class="tablecell tablecell_middle top_border_cell">
                                <p class="standard first-item last-item"><span class="italic">/abc</span> or<span class="italic"> /ac</span></p>
                            </td>
                            <td class="tablecell tablecell_last top_border_cell">
                                <p class="standard first-item last-item">Sign may occur, but doesn’t have to.</p>
                            </td>
                        </tr>
                        <tr class="light">
                            <td class="tablecell tablecell_first">
                                <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">+</samp></p>
                            </td>
                            <td class="tablecell tablecell_middle">
                                <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">/ab+c</samp></p>
                            </td>
                            <td class="tablecell tablecell_middle">
                                <p class="standard first-item last-item"><span class="italic">/abc </span>or<span class="italic"> /abbc</span></p>
                            </td>
                            <td class="tablecell tablecell_last">
                                <p class="standard first-item last-item">Character occurs once or multiple times.</p>
                            </td>
                        </tr>
                        <tr>
                            <td class="tablecell tablecell_first">
                                <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">*</samp></p>
                            </td>
                            <td class="tablecell tablecell_middle">
                                <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">/a*c</samp></p>
                            </td>
                            <td class="tablecell tablecell_middle">
                                <p class="standard first-item last-item"><span class="italic">/ac </span>or<span class="italic"> /aABCc</span></p>
                            </td>
                            <td class="tablecell tablecell_last">
                                <p class="standard first-item last-item">Any character string.</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <p class="caption "><b>Table 6.3</b>    
            Patterns in Routes</p>
                <p class="standard">In addition to the patterns listed in <span class="crossreference "><a href="06_005.html#t6.3">Table 6.3</a></span>, you can create groups of characters by means of parentheses and apply the multipliers<a class="indexanchor" id="i06_37"/> to these groups. Thus, a route from <samp class="listingcharacter listingcharacter">/a(bc)?d</samp> applies to both <samp class="listingcharacter listingcharacter">/ad</samp> and <samp class="listingcharacter listingcharacter">/abcd</samp>. If these options are still not sufficient to cover your use case, you can also specify routes as regular expressions. <span class="crossreference "><a href="06_005.html#l6.6">Listing 6.6</a></span> shows an example of such a route, which is responsible for all paths that contain the string <samp class="listingcharacter listingcharacter">/movie</samp> somewhere in the path.</p>
                <div class="box box_standard">
                    <h6 class="boxheading">Route Dependency<a class="indexanchor" id="i06_38"/></h6>
                    <p class="standard first last">Note that a route in Express can cause other routes to stop running, depending on where you place it in your application. Express always uses the first suitable route it can find. If it sends its response to the client, the middleware chain is broken, and Express doesn’t perform any further functions for this request.</p>
                </div>
                <div class="listing " id="l6.6"><pre>app<span class="schwarz">.get(</span><span class="dunkelblau">/</span><span class="schwarz">.</span><span class="dunkelblau">*</span><span class="schwarz">\</span><span class="dunkelblau">/</span><span class="schwarz">movie</span><span class="schwarz">.</span><span class="dunkelblau">*</span><span class="schwarz">$</span><span class="dunkelblau">/</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">request</span><span class="schwarz">,</span><span class="schwarz"> response</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  response<span class="schwarz">.send(</span><span class="hellblau">'Movie Route'</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
                <p class="caption "><b>Listing 6.6</b>    
            Regular Expressions as Routes</p>
                <p class="standard"><a id="p189"/>If you formulate your routes with regular expressions, you have maximum flexibility. However, this often makes the routes less legible, which makes troubleshooting more difficult. For this reason, you should use regular expressions sparingly in this case and rather as an exception when the normal route definitions are no longer sufficient.</p>
            
        
        
            <h3 class="t3" id="h6.5.2">6.5.2    Controller<a class="indexanchor" id="i06_39"/></h3>
            <p class="standard">At this point, your router still implements the complete MVC pattern on its own. This isn’t desirable because readability suffers with increasing functionality, so in the next step, you must outsource everything except the actual route definition to a controller. The controller has the task of merging the view and the model. In addition, at this point, the information is usually extracted from the request, and the response to the client is formulated. As to the naming of routing callback functions<a class="indexanchor" id="i06_40"/>, it has become standard in many web frameworks to refer to these functions as actions. A controller can contain several of these action functions. <span class="crossreference "><a href="06_005.html#l6.7">Listing 6.7</a></span> shows the implementation of the controller for the list view.</p>
            <div class="listing " id="l6.7"><pre><span class="rot">const</span><span class="schwarz"> data </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="schwarz"><br/></span>  <span class="schwarz">{</span><span class="schwarz"> id</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">1,</span><span class="schwarz"> title</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Iron Man'</span><span class="schwarz">,</span><span class="schwarz"> year</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'2008'</span><span class="schwarz"> </span><span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="schwarz">{</span><span class="schwarz"> id</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">2,</span><span class="schwarz"> title</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Thor'</span><span class="schwarz">,</span><span class="schwarz"> year</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'2011'</span><span class="schwarz"> </span><span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="schwarz">{</span><span class="schwarz"> id</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">3,</span><span class="schwarz"> title</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Captain America'</span><span class="schwarz">,</span><span class="schwarz"> year</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'2011'</span><span class="schwarz"> </span><span class="schwarz">},</span><span class="schwarz"><br/></span><span class="schwarz">];</span><span class="schwarz"><br/></span> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">listAction(</span><span class="schwarz">request</span><span class="schwarz">,</span><span class="schwarz"> response</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  response<span class="schwarz">.send(</span><span class="schwarz">data</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 6.7</b>    
            Controller (movie/controller.js)</p>
            <p class="standard">Export and implementation are linked in this case. However, at this point, you may as well collect all exports at the end of the file. There is no right or wrong here; the only important thing is to stay consistent and always use the same type of export. Typically, you use the combination of export and definition in files that contain only a few exports. In general, you should make sure that a file doesn’t export too many structures, as this can quickly become confusing and indicate that the file hosts too many structures.</p>
            <p class="standard">The controller is included in the router, where a reference to the <samp class="listingcharacter listingcharacter">listAction</samp> method of the controller is entered instead of the routing callback function. The source code of the customized router is shown in <span class="crossreference "><a href="06_005.html#l6.8">Listing 6.8</a></span>.</p>
            <div class="listing " id="l6.8"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> Router </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> { listAction } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./controller.js'</span><span class="schwarz">;</span><br/> </samp></span><br/><span class="rot">const</span><span class="schwarz"> router </span><span class="dunkelblau">=</span><span class="schwarz"> Router();</span><br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter"><a id="p190"/>router.get(<span class="hellblau">'/'</span><span class="schwarz">, listAction);</span><br/> </samp></span><br/><span class="rot">export</span><span class="schwarz"> { router }; </span><span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 6.8</b>    
            Including the Controller Action in the Router (movie/index.js)</p>
            <p class="standard">When extending the router, you must import <samp class="listingcharacter listingcharacter">listAction</samp> and use it in the <samp class="listingcharacter listingcharacter">get</samp> method of the router. With this modification, you’ve separated the routing of your module and the handling of request and response. However, model, view, and controller are still quite tightly connected. The next step is to resolve this.</p>
        
        
            <h3 class="t3" id="h6.5.3">6.5.3    Model<a class="indexanchor" id="i06_41"/></h3>
            <p class="standard">The movie database data has the form of a simple array of objects<a class="indexanchor" id="i06_42"/>. The model encapsulates this array and provides a function to read the data and later further methods to modify this data structure. You’re not yet working with a database or other external system for data storage in your application. But to make the source code of the application a bit more realistic, you should implement the interfaces of the model with promises and, thus, asynchronously.</p>
            <div class="box box_standard">
                <h6 class="boxheading">Promises<a class="indexanchor" id="i06_43"/></h6>
                <p class="standard first">A <span class="italic">promise</span> is an object that represents the fulfillment of an asynchronous operation in JavaScript. Unlike callback functions, you can work much better with promises and also bind multiple operations to the fulfillment of such a promise object.</p>
                <p class="standard">Promises are a language feature of JavaScript and part of the standard, so they are supported on both the client side and server side. You can create a promise object either with the promise constructor or with <samp class="listingcharacter listingcharacter">Promise.resolve</samp><a class="indexanchor" id="i06_44"/> or <samp class="listingcharacter listingcharacter">Promise.reject</samp><a class="indexanchor" id="i06_45"/>. <span class="crossreference "><a href="06_005.html#l6.9">Listing 6.9</a></span> shows a simple example of a function that works with promises.</p>
                <div class="listing " id="l6.9"><pre><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">asyncFunction()</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">return</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Promise((</span><span class="schwarz">resolve</span><span class="schwarz">,</span><span class="schwarz"> reject</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="schwarz">setTimeout(()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>      <span class="schwarz">resolve(</span><span class="hellblau">'Hello world!'</span><span class="schwarz">);</span><span class="schwarz"><br/></span>    <span class="schwarz">},</span><span class="schwarz"> </span><span class="schwarz">1000);</span><span class="schwarz"><br/></span>  <span class="schwarz">});</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span><br/><span class="rot">const</span><span class="schwarz"> promise </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">asyncFunction();</span><span class="schwarz"><br/></span>promise<span class="schwarz">.then((</span><span class="magenta">value</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="magenta">value</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
                <p class="caption "><b>Listing 6.9</b>    
            Using Promises</p>
                <p class="standard"><a id="p191"/>You pass a callback function to the promise constructor in the <samp class="listingcharacter listingcharacter">asyncFunction</samp> function. This function has access to the <samp class="listingcharacter listingcharacter">resolve</samp> and <samp class="listingcharacter listingcharacter">reject</samp> arguments. You can use these functions to indicate a success or failure of an asynchronous operation by calling the respective function. Here, you can pass any value that represents something like the return value of the asynchronous operation.</p>
                <p class="standard last">The promise object that the <samp class="listingcharacter listingcharacter">asyncFunction</samp> returns has the <samp class="listingcharacter listingcharacter">then</samp><a class="indexanchor" id="i06_46"/>, <samp class="listingcharacter listingcharacter">catch</samp><a class="indexanchor" id="i06_47"/>, and <samp class="listingcharacter listingcharacter">finally</samp><a class="indexanchor" id="i06_48"/> methods. Each of these methods accepts a callback function that will be executed in case of success, error, or both, respectively, and will be passed the value you passed when calling <samp class="listingcharacter listingcharacter">resolve</samp> or <samp class="listingcharacter listingcharacter">reject</samp>. The <samp class="listingcharacter listingcharacter">then</samp> method is a special case because here you can specify a second callback function for the case of an error.</p>
            </div>
            <p class="standard">The data of the model is in the scope of the file and can’t be modified directly from outside. The <samp class="listingcharacter listingcharacter">getAll</samp> method returns a promise object that you can create using the <samp class="listingcharacter listingcharacter">Promise.resolve</samp> method (see <span class="crossreference "><a href="06_005.html#l6.10">Listing 6.10</a></span>). This promise object is resolved with a reference to the data. This is a problem at first because the information could be changed via this reference. At a later date, this data structure will be exchanged for a fully-fledged database, so there’s currently no need to worry about this problem. After you’ve created the basis for the model, you still need to integrate it into your application. The controller is the place to go for this. <span class="crossreference "><a href="06_005.html#l6.11">Listing 6.11</a></span> shows the adjustments you need to make to your code.</p>
            <div class="listing " id="l6.10"><pre><span class="rot">const</span><span class="schwarz"> data </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="schwarz"><br/></span>  <span class="schwarz">{</span><span class="schwarz"> id</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">1,</span><span class="schwarz"> title</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Iron Man'</span><span class="schwarz">,</span><span class="schwarz"> year</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'2008'</span><span class="schwarz"> </span><span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="schwarz">{</span><span class="schwarz"> id</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">2,</span><span class="schwarz"> title</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Thor'</span><span class="schwarz">,</span><span class="schwarz"> year</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'2011'</span><span class="schwarz"> </span><span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="schwarz">{</span><span class="schwarz"> id</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">3,</span><span class="schwarz"> title</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Captain America'</span><span class="schwarz">,</span><span class="schwarz"> year</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'2011'</span><span class="schwarz"> </span><span class="schwarz">},</span><span class="schwarz"><br/></span><span class="schwarz">];</span><span class="schwarz"><br/></span> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">getAll()</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">return</span><span class="schwarz"> Promise</span><span class="schwarz">.resolve(</span><span class="schwarz">data</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 6.10</b>    
            Implementing the Model (movie/model.js)</p>
            <div class="listing  listing_no_margin_bottom" id="l_none_6113"><pre><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> { getAll } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./model.js'</span><span class="schwarz">;</span></samp></span> <span class="schwarz"/></pre></div>
            <div class="listing " id="l6.11"><pre> <br/>export <span class="bold"><samp class="listingcharacter listingcharacter">async</samp></span> function listAction(request, response) {<br/>  <span class="bold"><samp class="listingcharacter listingcharacter">const data = await getAll();</samp></span><br/>  response.send(data);<br/>} </pre></div>
            <p class="caption "><b>Listing 6.11</b>    
            Adapting the Controller to Integrate the Model (movie/controller.js)</p>
            <p class="standard"><a id="p192"/>If you implement the <samp class="listingcharacter listingcharacter">listAction</samp> function as an <samp class="listingcharacter listingcharacter">async</samp> function as in our example, you can use the <samp class="listingcharacter listingcharacter">await</samp> keyword within this function to wait for the promise to resolve. This whole task is done asynchronously, that is, nonblocking, making the source code much more readable than if you were using callback functions. Express supports this type of asynchronicity directly and without additional configuration.</p>
        
        
            <h3 class="t3" id="h6.5.4">6.5.4    View<a class="indexanchor" id="i06_49"/></h3>
            <p class="standard">The final component of your MVC application with Express is the view. This part is responsible for the display. The output of a JavaScript object isn’t a particularly appealing form of presentation. Therefore, it’s better to use HTML as the output format at this point. You have several options for the display. For example, you can save the HTML code in a separate HTML file, read it with JavaScript, and replace the appropriate sections. You can either do this replacement directly using the <samp class="listingcharacter listingcharacter">replace</samp> method of the HTML string, or you can use an HTML parser such as Cheerio<a class="indexanchor" id="i06_50"/>. A simpler variant is to use JavaScript template strings, as you’ll see later in this section. Another option is to use a template engine<a class="indexanchor" id="i06_51"/>. The next chapter describes this topic in greater detail. <span class="crossreference "><a href="06_005.html#l6.12">Listing 6.12</a></span> contains the movie list view.</p>
            <div class="listing " id="l6.12"><pre><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">render(</span><span class="schwarz">movies</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">return</span><span class="schwarz"> </span><span class="violett">`</span><br/>&lt;!DOCTYPE html&gt;<br/>&lt;html lang=<span class="hellblau">"en"</span><span class="violett">&gt;</span><br/>&lt;head&gt;<br/>  &lt;meta charset=<span class="hellblau">"UTF-8"</span><span class="violett">&gt;</span><br/>  &lt;title&gt;Movie list&lt;/title&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>  &lt;table&gt;<br/>    &lt;thead&gt;&lt;tr&gt;&lt;th&gt;Id&lt;/th&gt;&lt;th&gt;Title&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;<br/>    &lt;tbody&gt;<br/>      ${movies<br/>        .map(movie =&gt; `<span class="dunkelblau">&lt;</span><span class="schwarz">tr</span><span class="dunkelblau">&gt;&lt;</span><span class="schwarz">td</span><span class="dunkelblau">&gt;</span><span class="schwarz">$</span><span class="schwarz">{</span><span class="schwarz">movie</span><span class="schwarz">.</span><span class="schwarz">id</span><span class="schwarz">}</span><span class="dunkelblau">&lt;/</span><span class="schwarz">td</span><span class="dunkelblau">&gt;&lt;</span><span class="schwarz">td</span><span class="dunkelblau">&gt;</span><span class="schwarz">$</span><span class="schwarz">{</span><span class="schwarz">movie</span><span class="schwarz">.</span><span class="schwarz">title</span><span class="schwarz">}</span><span class="dunkelblau">&lt;/</span><span class="schwarz">td</span><span class="dunkelblau">&gt;&lt;/</span><span class="schwarz">tr</span><span class="dunkelblau">&gt;</span><span class="violett">`)</span><br/>        .join(<span class="hellblau">''</span><span class="violett">)}</span><br/>    &lt;/tbody&gt;<br/>  &lt;/table&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;<br/>  `<span class="schwarz">;</span><span class="schwarz"><br/></span><span class="schwarz">};</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 6.12</b>    
            Displaying the Movie List View (movie/view.js)</p>
            <p class="standard"><a id="p193"/>The view in this case consists of a <samp class="listingcharacter listingcharacter">render</samp> function that receives the data to be displayed as an argument. Within the HTML structure, each entry is transformed into a table row using the <samp class="listingcharacter listingcharacter">map</samp> method. You connect this structure with the <samp class="listingcharacter listingcharacter">join</samp> method into a character string, which is then output at the correct position within the template string. The task of the controller is to bring the model and view together. <span class="crossreference "><a href="06_005.html#l6.13">Listing 6.13</a></span> contains the customized code of the controller.</p>
            <div class="listing " id="l6.13"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> getAll </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./model.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> render </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./view.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">listAction(</span><span class="schwarz">request</span><span class="schwarz">,</span><span class="schwarz"> response</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> data </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> </span><span class="schwarz">getAll();</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> body </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">render(</span><span class="schwarz">data</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  response<span class="schwarz">.send(</span><span class="schwarz">body</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 6.13</b>    
            View Integration in the Controller (movie/controller.js)</p>
            <p class="standard">The <samp class="listingcharacter listingcharacter">listAction</samp> function loads the list of movies in the first step. This is passed to the view in the second step. In the last step, you send the HTML structure to the client. When you restart your application via the command line using the <samp class="listingcharacter listingcharacter">npm start</samp> command now, you’ll get an output like the one shown in <span class="crossreference "><a href="06_005.html#f6.7">Figure 6.7</a></span>.</p>
            <div class="imagebox figure-type"><a href="img-f6.7.html" id="f6.7"><img alt="Display of the Movie List after the View Conversion" id="img-f6.7" src="bilderklein/klein06_007.png"/></a></div>
            <p class="caption "><b>Figure 6.7</b>    
            Display of the Movie List after the View Conversion</p>
            <p class="standard">When implementing your application, make sure that you move as little logic as possible into the view. Iteration, as you’ve implemented here, or simple conditions to hide or show parts are recommended options. You should definitely outsource more extensive logic to your models.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>