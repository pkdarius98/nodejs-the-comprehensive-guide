<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Web Applications with Nest" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Web Applications with Nest" name="description"/>
            <meta content="en" name="language"/>
            <title>Web Applications with Nest</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h14.10">14.10    <a id="p449"/>Outlook: Testing in Nest<a class="indexanchor" id="i14_132"/></h2>
        <p class="standard">One issue we’ve completely ignored so far is checking the functionality we’ve implemented. At this point, we’re getting a little ahead of <span class="crossreference "><a href="23_001.html#h23">Chapter 23</a></span>, which covers testing, but only to show you how convenient it can be to write tests for your application in Nest. So, if some terms or concepts are unfamiliar to you, you can learn even more about testing in <span class="crossreference "><a href="23_001.html#h23">Chapter 23</a></span>.</p>
        <p class="standard">When you create structures for your application via the Nest CLI, the command-line tool not only creates the actual file but also a test file. As an example, let’s take the <samp class="listingcharacter listingcharacter">MovieController</samp> and test the <samp class="listingcharacter listingcharacter">getAllMovies</samp> method there. In this test, it’s important that we only want to test the controller and not the implementation of the underlying service. For this reason, we’ll use Nest’s dependency injection system<a class="indexanchor" id="i14_133"/> to provide the controller not with the actual implementation of the service, but instead with an instance customized for the test. <span class="crossreference "><a href="14_010.html#l14.35">Listing 14.35</a></span> shows the source code of the test.</p>
        <div class="listing " id="l14.35"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> Test</span><span class="schwarz">,</span><span class="schwarz"> TestingModule </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'@nestjs/testing'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> MovieController </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie.controller'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> MovieService </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie.service'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="schwarz">describe(</span><span class="hellblau">'MovieController'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">let</span><span class="schwarz"> controller</span><span class="schwarz">:</span><span class="schwarz"> MovieController</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="rot">let</span><span class="schwarz"> service</span><span class="schwarz">:</span><span class="schwarz"> MovieService</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/>  <span class="rot">const</span><span class="schwarz"> movies </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="schwarz"><br/></span>    <span class="schwarz">{</span><span class="schwarz"><br/></span>      id<span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">1,</span><span class="schwarz"><br/></span>      title<span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Iron Man'</span><span class="schwarz">,</span><span class="schwarz"><br/></span>      year<span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">2008,</span><span class="schwarz"><br/></span>    <span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="schwarz">];</span><span class="schwarz"><br/></span> <br/>  <span class="schwarz">beforeEach(</span><span class="rot">async</span><span class="schwarz"> </span><span class="schwarz">()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">const</span><span class="schwarz"> module</span><span class="schwarz">:</span><span class="schwarz"> TestingModule </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> Test</span><span class="schwarz">.createTestingModule({</span><span class="schwarz"><br/></span>      controllers<span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="schwarz">MovieController</span><span class="schwarz">],</span><span class="schwarz"><br/></span>      providers<span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="schwarz"><br/></span>        <span class="schwarz">{</span><span class="schwarz"><br/></span>          provide<span class="schwarz">:</span><span class="schwarz"> MovieService</span><span class="schwarz">,</span><span class="schwarz"><br/></span>          useValue<span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>            <span class="rot">async</span><span class="schwarz"> </span><span class="schwarz">getAllMovies()</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>              <span class="rot">return</span><span class="schwarz"> movies</span><span class="schwarz">;</span><span class="schwarz"><br/></span>            <span class="schwarz">},</span><span class="schwarz"><br/></span>          <span class="schwarz">},</span><span class="schwarz"><br/></span>        <span class="schwarz">},</span><span class="schwarz"><br/></span>      <span class="schwarz">],</span><span class="schwarz"><br/></span><a id="p450"/>    <span class="schwarz">}).compile();</span><span class="schwarz"><br/></span> <br/>    controller <span class="dunkelblau">=</span><span class="schwarz"> module</span><span class="schwarz">.</span><span class="rot">get</span><span class="dunkelblau">&lt;</span><span class="schwarz">MovieController</span><span class="dunkelblau">&gt;</span><span class="schwarz">(</span><span class="schwarz">MovieController</span><span class="schwarz">);</span><span class="schwarz"><br/></span>    service <span class="dunkelblau">=</span><span class="schwarz"> module</span><span class="schwarz">.</span><span class="rot">get</span><span class="dunkelblau">&lt;</span><span class="schwarz">MovieService</span><span class="dunkelblau">&gt;</span><span class="schwarz">(</span><span class="schwarz">MovieService</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="schwarz">});</span><span class="schwarz"><br/></span> <br/>  <span class="schwarz">it(</span><span class="hellblau">'should return all movies'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="schwarz">()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">const</span><span class="schwarz"> result </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> controller</span><span class="schwarz">.getAllMovies();</span><span class="schwarz"><br/></span> <br/>    <span class="schwarz">expect(</span><span class="schwarz">result</span><span class="schwarz">).toStrictEqual([</span><span class="schwarz"><br/></span>      <span class="schwarz">{</span><span class="schwarz"><br/></span>        id<span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">1,</span><span class="schwarz"><br/></span>        title<span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Iron Man'</span><span class="schwarz">,</span><span class="schwarz"><br/></span>        year<span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">2008,</span><span class="schwarz"><br/></span>      <span class="schwarz">},</span><span class="schwarz"><br/></span>    <span class="schwarz">]);</span><span class="schwarz"><br/></span>  <span class="schwarz">});</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 14.35</b>    
            Testing a Controller in Nest (src/movie/movie.controller.spec.ts)</p>
        <p class="standard">The key to an independent test is that the test isn’t run in the context of the application, but in a separate testing module<a class="indexanchor" id="i14_134"/>. For this purpose, you use the <samp class="listingcharacter listingcharacter">createTestingModule</samp> method<a class="indexanchor" id="i14_135"/> to which you pass an object that resembles the configuration object of a module. As a controller, you pass a reference to the controller. With regard to the provider, you replace the provider with an object you have complete control over and can define how it should behave. In this case, when the <samp class="listingcharacter listingcharacter">getAllMovies</samp> method is called, it returns an array with an object wrapped in a promise object.</p>
        <p class="standard">In the actual test, which is initiated via the <samp class="listingcharacter listingcharacter">it</samp> function, you call the <samp class="listingcharacter listingcharacter">getAllMovies</samp> method and use the <samp class="listingcharacter listingcharacter">toStrictEqual</samp> method to check whether the returned object matches the expected structure. You can run the test using the <samp class="listingcharacter listingcharacter">npm test movie.controller</samp> command, which makes sure that only this one test file is run and all other currently potentially failing tests are ignored. <span class="crossreference "><a href="14_010.html#l14.36">Listing 14.36</a></span> shows the output of the test run.</p>
        <div class="listing " id="l14.36"><pre><span class="bold"><samp class="listingcharacter listingcharacter">$ npm test movie.controller<br/></samp></span><br/>&gt; movie-db@0.0.1 test<br/>&gt; jest "movie.controller"<br/><br/> PASS  src/movie/movie.controller.spec.ts<br/>  MovieController<br/>    ✓ should return all movies (11 ms)<br/><br/><a id="p451"/>Test Suites: 1 passed, 1 total<br/>Tests:       1 passed, 1 total<br/>Snapshots:   0 total<br/>Time:        3.385 s, estimated 4 s<br/>Ran all test suites matching /movie.controller/i. </pre></div>
        <p class="caption "><b>Listing 14.36</b>    
            Running the Unit Test</p>
        <p class="standard">Based on this schema, you can test all the structures Nest provides separate from the overall context of your application, thus ensuring the proper functioning of the individual units.</p>
    </div><p class="signatur"/>
                    </body>
                </html>