<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="REST Server" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - REST Server" name="description"/>
            <meta content="en" name="language"/>
            <title>REST Server</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h10.7">10.7    OpenAPI Specification: Documentation with Swagger<a class="indexanchor" id="i10_64"/><a class="indexanchor" id="i10_65"/></h2>
        <p class="standard">Swagger is a widely used tool for designing and documenting<a class="indexanchor" id="i10_66"/> interfaces. It’s available as an open-source project at <span class="url"><a href="https://swagger.io/">https://swagger.io/</a></span>. There are two different approaches to using Swagger in Node.js. First, you can use the <samp class="listingcharacter listingcharacter">swagger</samp> package to have a server generated based on an existing application programming interface (API) description. In this section, however, we’ll describe the second variant in greater detail, that is, integrating Swagger into an existing application.</p>
        <p class="standard"><a id="p325"/>The <samp class="listingcharacter listingcharacter">swagger-jsdoc</samp> package, which you install via the <samp class="listingcharacter listingcharacter">npm install swagger-jsdoc</samp> command, enables you to have Swagger documentation generated from JSDoc comments<a class="indexanchor" id="i10_67"/> of your routes and make it publicly available via the Swagger UI<a class="indexanchor" id="i10_68"/>. Alternatively, you can write the documentation in a separate YAML or JSON file.</p>
        <p class="standard">The API documentation is usually located in a file called <span class="italic">swagger.json</span><a class="indexanchor" id="i10_69"/>. If you use <samp class="listingcharacter listingcharacter">swagger-jsdoc</samp>, you can also generate the documentation directly in the code. For this purpose, you must add a JSDoc comment to the routes of your application, prefixed with the character string <samp class="listingcharacter listingcharacter">@swagger</samp>. <span class="crossreference "><a href="10_007.html#l10.32">Listing 10.32</a></span> contains the documentation for the list as well as for retrieving a single data record.</p>
        <div class="listing " id="l10.32"><pre><span class="rot">import</span><span class="schwarz"> { Router } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> {</span><br/>  listAction,<br/>  detailAction,<br/>  createAction,<br/>  updateAction,<br/>  deleteAction,<br/>} <span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./controller.js'</span><span class="schwarz">;</span><br/> <br/><span class="rot">const</span><span class="schwarz"> router </span><span class="dunkelblau">=</span><span class="schwarz"> Router();</span><br/> <span class="gruen"><br/></span><span class="bold"><samp class="listingcharacter listingcharacter">/**<br/> * @swagger<br/> * definitions:<br/> *  movie:<br/> *    properties:<br/> *      id:<br/> *        type: integer<br/> *        example: 1<br/> *      title:<br/> *        type: string<br/> *        example: Iron Man<br/> *      year:<br/> *        type: integer<br/> *        example: 2008<br/> *      public:<br/> *        type: integer<br/> *        example: 1<br/> *      user:<br/> *        type: integer<br/> *        example: 1<br/> */<span class="schwarz"><br/></span> <span class="gruen"><br/></span><a id="p326"/>/**<br/> * @swagger<br/> * /movie:<br/> *  get:<br/> *    tags:<br/> *      - movies<br/> *    description: Returns all movies<br/> *    produces:<br/> *      - application/json<br/> *      - application/xml<br/> *    responses:<br/> *      200:<br/> *        description: An array of movie datasets<br/> *        schema:<br/> *          type: array<br/> *          items:<br/> *            $ref: '#/definitions/movie'<br/> */</samp></span><span class="schwarz"><br/></span>router.get(<span class="hellblau">'/'</span><span class="schwarz">, listAction);</span><span class="gruen"><br/></span><span class="bold"><samp class="listingcharacter listingcharacter">/**<br/> * @swagger<br/> * /movie/{movieId}:<br/> *  get:<br/> *    tags:<br/> *      - movies<br/> *    description: Returns one movie<br/> *    produces:<br/> *      - application/json<br/> *      - application/xml<br/> *    responses:<br/> *      200:<br/> *        description: One movie object<br/> *        schema:<br/> *          $ref: '#/definitions/movie'<br/> */</samp></span><span class="schwarz"><br/></span>router.get(<span class="hellblau">'/:id'</span><span class="schwarz">, detailAction);</span><br/>router.post(<span class="hellblau">'/'</span><span class="schwarz">, createAction);</span><br/>router.put(<span class="hellblau">'/:id'</span><span class="schwarz">, updateAction);</span><br/>router.delete(<span class="hellblau">'/:id'</span><span class="schwarz">, deleteAction);</span><br/> <br/><span class="rot">export</span><span class="schwarz"> { router }; </span><span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 10.32</b>    
            Swagger Documentation as JSDoc Blocks (movie/index.js)</p>
        <p class="standard"><a id="p327"/>The first comment block in <span class="crossreference "><a href="10_007.html#l10.32">Listing 10.32</a></span> creates the schema of a movie record. You then use this scheme with the comments of the two routes to describe them in detail while having as few duplicates in the code as possible. The structure in which you write the comments is YAML<a class="indexanchor" id="i10_70"/>.</p>
        <p class="standard">Based on these comments, you can now have the documentation generated, as shown in <span class="crossreference "><a href="10_007.html#l10.33">Listing 10.33</a></span>. For this purpose, you create a file named <span class="italic">swagger.js</span>, which contains the configuration and initialization of <samp class="listingcharacter listingcharacter">swagger-jsdoc</samp>.</p>
        <div class="listing " id="l10.33"><pre><span class="rot">import</span><span class="schwarz"> swaggerJSDoc </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'swagger-jsdoc'</span><span class="schwarz">;</span><br/> <br/><span class="rot">const</span><span class="schwarz"> swaggerDefinition </span><span class="dunkelblau">=</span><span class="schwarz"> {</span><br/>  info: {<br/>    title: <span class="hellblau">'Movie Database API'</span><span class="schwarz">,</span><br/>    version: <span class="hellblau">'1.0.0'</span><span class="schwarz">,</span><br/>    description: <span class="hellblau">'API of the movie database'</span><span class="schwarz">,</span><br/>  },<br/>  host: <span class="hellblau">'localhost:8080'</span><span class="schwarz">,</span><br/>  basePath: <span class="hellblau">'/'</span><span class="schwarz">,</span><br/>};<br/> <br/><span class="rot">const</span><span class="schwarz"> options </span><span class="dunkelblau">=</span><span class="schwarz"> {</span><br/>  swaggerDefinition,<br/>  apis: [<span class="hellblau">'./movie/index.js'</span><span class="schwarz">],</span><br/>};<br/> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">default</span><span class="schwarz"> swaggerJSDoc(options); </span><span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 10.33</b>    
            Configuration and Initialization of “swagger-jsdoc” (swagger.js)</p>
        <p class="standard">In addition to the pure API documentation<a class="indexanchor" id="i10_71"/>, you can specify general information about the <samp class="listingcharacter listingcharacter">swaggerDefinition</samp> property, such as the title, version, or description of the interface. At this point, you also pass the host and <samp class="listingcharacter listingcharacter">basePath</samp> to <samp class="listingcharacter listingcharacter">swagger-jsdoc</samp>. Using the <samp class="listingcharacter listingcharacter">apis</samp> property, you specify an array of files containing the Swagger comments from which to create the documentation. </p>
        <p class="standard">Based on this information, <samp class="listingcharacter listingcharacter">swagger-jsdoc</samp> generates the Swagger specification<a class="indexanchor" id="i10_72"/>. You can either provide this specification directly in JSON format via your web server, or use the <samp class="listingcharacter listingcharacter">swagger-ui-express</samp> package to include the documentation in your Express application via middleware. To do this, you must install the package via the command <samp class="listingcharacter listingcharacter">npm install</samp> <samp class="listingcharacter listingcharacter">swagger-ui-express</samp> and include it as shown in <span class="crossreference "><a href="10_007.html#l10.34">Listing 10.34</a></span>.</p>
        <div class="listing " id="l10.34"><pre><span class="rot">import</span><span class="schwarz"> express </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> morgan </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'morgan'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> expressJwt </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express-jwt'</span><span class="schwarz">;</span><br/><span class="bold"><samp class="listingcharacter listingcharacter"><span class="rot"><a id="p328"/>import</span><span class="schwarz"> swaggerUi </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'swagger-ui-express'</span><span class="schwarz">;</span></samp></span><br/><span class="rot">import</span><span class="schwarz"> { router </span><span class="rot">as</span><span class="schwarz"> movieRouter } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie/index.js'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { router </span><span class="rot">as</span><span class="schwarz"> loginRouter } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./auth.js'</span><span class="schwarz">;</span><br/><span class="bold"><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> swaggerSpec </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./swagger.js'</span><span class="schwarz">;</span><br/> </samp></span><br/><span class="rot">const</span><span class="schwarz"> app </span><span class="dunkelblau">=</span><span class="schwarz"> express();</span><br/> <br/>app.use(morgan(<span class="hellblau">'common'</span><span class="schwarz">, { immediate: </span><span class="rot">true</span><span class="schwarz"> }));</span><br/> <br/>app.use(express.json());<br/> <br/>app.use(<span class="hellblau">'/login'</span><span class="schwarz">, loginRouter);</span><br/>app.use(<br/>  <span class="hellblau">'/movie'</span><span class="schwarz">,</span><br/>  expressJwt({ secret: <span class="hellblau">'secret'</span><span class="schwarz">, algorithms: [</span><span class="hellblau">'HS256'</span><span class="schwarz">] }),</span><br/>  movieRouter,<br/>);<br/> <br/>app.use((err, request, response, next) <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="rot">if</span><span class="schwarz"> (err.name </span><span class="dunkelblau">===</span><span class="schwarz"> </span><span class="hellblau">'UnauthorizedError'</span><span class="schwarz">) {</span><br/>    response.status(401).json(<span class="hellblau">'unauthorized'</span><span class="schwarz">);</span><br/>  } <span class="rot">else</span><span class="schwarz"> {</span><br/>    next();<br/>  }<br/>});<br/> <br/>app.get(<span class="hellblau">'/'</span><span class="schwarz">, (request, response) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> response.redirect(</span><span class="hellblau">'/movie'</span><span class="schwarz">));</span><br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter">app.use(<span class="hellblau">'/api-docs'</span><span class="schwarz">, swaggerUi.serve, swaggerUi.setup(swaggerSpec));</span><br/> </samp></span><br/>app.listen(8080, () <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Server is listening to http://localhost:8080'</span><span class="schwarz">);</span><br/>}); <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 10.34</b>    
            Integrating the Swagger UI in Express (index.js)</p>
        <p class="standard">After restarting your application, you can access the API documentation of your interface via <span class="italic">http://localhost:8080/api-docs</span>. The result should look similar to <span class="crossreference "><a href="10_007.html#f10.10">Figure 10.10</a></span>.</p>
        <div class="imagebox figure-type"><a href="img-f10.10.html" id="f10.10"><img alt="Swagger UI" id="img-f10.10" src="bilderklein/klein10_010.png"/></a></div>
        <p class="caption "><b>Figure 10.10</b>    
            <a id="p329"/>Swagger UI</p>
    </div><p class="signatur"/>
                    </body>
                </html>