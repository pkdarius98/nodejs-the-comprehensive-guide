<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Working with Files" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Working with Files" name="description"/>
            <meta content="en" name="language"/>
            <title>Working with Files</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main"><h1 class="t1" id="h19">19    <a id="p573"/>Working with Files</h1><p class="introductorynote indent_chapter_double">One waits for the times to change, the other seizes them and acts.<br/>—Dante Alighieri</p><p class="standard">In<a class="indexanchor" id="i19_00"/> the previous chapters, you’ve already seen how you can handle data streams<a class="indexanchor" id="i19_01"/> in Node.js for the purpose of processing information. One of the most important sources of information and one of the most important targets of read and write operations is the file system.</p><p class="standard">First of all, here are some hints on handling files:</p><ul>
        <li>
            <p class="standard first-item last-item"><span class="bold">Permissions</span><a class="indexanchor" id="i19_02"/><br/>A common source of errors related to the file system involves incorrect permissions. In Node.js, you work with the permissions of the user under which the application is running. If this user doesn’t have the permission to access the desired files, the Node.js process isn’t permitted to do so either, and an attempt to do so is responded to with an error.</p>
        </li>
        <li>
            <p class="standard first-item last-item"><span class="bold">Paths</span><a class="indexanchor" id="i19_03"/><br/>You should always make sure to use the correct path for your access. You can either use absolute paths, starting from the root of the file system, or use relative paths, operating from the current directory. You should always prefer relative path specifications, as they increase the portability of your application.</p>
        </li>
        <li>
            <p class="standard first-item last-item"><span class="bold">Path separators</span><a class="indexanchor" id="i19_04"/><br/>Windows uses backslashes as path separators, while Unix-based systems such as Linux or macOS use a forward slash. To make sure you use the correct separator, you should refer to the <samp class="listingcharacter listingcharacter">sep</samp> property of the <samp class="listingcharacter listingcharacter">path</samp> module.</p>
        </li>
    </ul>
        <h2 class="t2" id="h19.1">19.1    Synchronous and Asynchronous Functions<a class="indexanchor" id="i19_05"/></h2>
        <p class="standard">Besides permissions and paths, there are a few things you should be aware with regard to doing file system operations: For most operations, both a synchronous and an asynchronous version exist. Version 10 of Node.js also added a promise-based<a class="indexanchor" id="i19_06"/> application programming interface (API) to the <samp class="listingcharacter listingcharacter">fs</samp> module, so you now have three different functions available for most operations. The promise-based version of the file system interface, which was added later, was initially marked as experimental, like most new modules. However, this extension has proven to be stable and reliable over the past few <a id="p574"/>years, so you can use it in your application without a problem. The synchronous and callback-based version of the interface is directly available in the <samp class="listingcharacter listingcharacter">fs</samp> module. You can access the promise-based variant via the <samp class="listingcharacter listingcharacter">fs/promises</samp> module<a class="indexanchor" id="i19_07"/>.</p>
        <p class="standard">Basically, you already know what asynchronicity in Node.js is all about. But here’s a brief review: What does that mean for you as a developer? For your application, a synchronous file system operation means that you issue a call to read a file, for example. This command is passed to the Node.js platform and then further on to the operating system, which eventually executes the read operation and returns the result to Node.js and thus to your application. During this process your application won’t continue to run, the whole process is blocked. Once the result is available, the application continues to run normally. If file system operations<a class="indexanchor" id="i19_08"/> occur frequently in your application or if you need to perform operations on large files, the synchronous methods of the <samp class="listingcharacter listingcharacter">fs</samp> module may have a negative impact on your application due to the interruptions in program execution. In <span class="crossreference "><a href="19_001.html#l19.1">Listing 19.1</a></span>, you can see an example of a synchronous file reading operation using the <samp class="listingcharacter listingcharacter">readFileSync</samp> function of the <samp class="listingcharacter listingcharacter">fs</samp> module.</p>
        <div class="listing " id="l19.1"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> readFileSync </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'fs'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">try</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> data </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">readFileSync(</span><span class="hellblau">'./input.txt'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'utf-8'</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="schwarz">data</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">catch </span><span class="schwarz">(</span><span class="rot">err</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="magenta">console</span><span class="schwarz">.error(</span><span class="schwarz">err</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 19.1</b>    
            Synchronous File Reading Operation</p>
        <p class="standard">To avoid the negative impact on the performance of your application, the asynchronous methods exist. They work in the same way as their synchronous counterparts, except that, in this case, the result of the operation isn’t returned to your application as a return value but is processed by a callback function. These callbacks<a class="indexanchor" id="i19_09"/> always have a similar signature in Node.js. The first argument is usually an error object that contains a value only if problems occurred during the operation. The other values passed represent the result of the operation, which you can handle within your callback. The example in <span class="crossreference "><a href="19_001.html#l19.2">Listing 19.2</a></span> should clarify this.</p>
        <div class="listing " id="l19.2"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> readFile </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'fs'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="schwarz">readFile(</span><span class="hellblau">'./input.txt'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'utf-8'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">err</span><span class="schwarz">,</span><span class="schwarz"> data</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">if</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">err</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="magenta">console</span><span class="schwarz">.error(</span><span class="schwarz">err</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">else</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span><a id="p575"/>    <span class="magenta">console</span><span class="schwarz">.log(</span><span class="schwarz">data</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 19.2</b>    
            Callback Functions in Node.js</p>
        <p class="standard">The same result can be solved a bit more elegantly with the promise-based variant in conjunction with top-level await. To access this new variant of the file system module, you must include the <samp class="listingcharacter listingcharacter">fs/promises</samp> module. The source code from <span class="crossreference "><a href="19_001.html#l19.3">Listing 19.3</a></span> benefits from the fact that promises can be combined with async functions, so you can get by without callback functions and use <samp class="listingcharacter listingcharacter">try-catch</samp> for error handling.</p>
        <div class="listing " id="l19.3"><pre><span class="rot"/><span class="rot">import</span><span class="schwarz"/><span class="schwarz"> </span><span class="schwarz"/><span class="schwarz">{</span><span class="schwarz"/><span class="schwarz"> readFile </span><span class="schwarz"/><span class="schwarz">}</span><span class="schwarz"/><span class="schwarz"> </span><span class="rot"/><span class="rot">from</span><span class="schwarz"/><span class="schwarz"> </span><span class="hellblau"/><span class="hellblau">'fs/promises'</span><span class="schwarz"/><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="schwarz"> </span><br/><span class="rot"/><span class="rot">try</span><span class="schwarz"/><span class="schwarz"> </span><span class="schwarz"/><span class="schwarz">{</span><span class="schwarz"><br/></span><span class="schwarz">  </span><span class="rot"/><span class="rot">const</span><span class="schwarz"/><span class="schwarz"> data </span><span class="dunkelblau"/><span class="dunkelblau">=</span><span class="schwarz"/><span class="schwarz"> </span><span class="rot"/><span class="rot">await</span><span class="schwarz"/><span class="schwarz"> </span><span class="schwarz"/><span class="schwarz">readFile(</span><span class="hellblau"/><span class="hellblau">'./input.txt'</span><span class="schwarz"/><span class="schwarz">,</span><span class="schwarz"/><span class="schwarz"> </span><span class="hellblau"/><span class="hellblau">'utf-8'</span><span class="schwarz"/><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">  </span><span class="magenta"/><span class="magenta">console</span><span class="schwarz"/><span class="schwarz">.log(</span><span class="schwarz"/><span class="schwarz">data</span><span class="schwarz"/><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"/><span class="schwarz"> </span><span class="rot"/><span class="rot">catch </span><span class="schwarz"/><span class="schwarz">(</span><span class="rot"/><span class="rot">err</span><span class="schwarz"/><span class="schwarz">)</span><span class="schwarz"/><span class="schwarz"> </span><span class="schwarz"/><span class="schwarz">{</span><span class="schwarz"><br/></span><span class="schwarz">  </span><span class="magenta"/><span class="magenta">console</span><span class="schwarz"/><span class="schwarz">.error(</span><span class="schwarz"/><span class="schwarz">err</span><span class="schwarz"/><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"/><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 19.3</b>    
            Reading a Promise-Based File</p>
    </div><p class="signatur"/>
                    </body>
                </html>