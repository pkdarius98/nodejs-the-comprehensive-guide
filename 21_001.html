<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Package Manager" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Package Manager" name="description"/>
            <meta content="en" name="language"/>
            <title>Package Manager</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main"><h1 class="t1" id="h21">21    <a id="p615"/>Package Manager</h1><p class="introductorynote indent_chapter_double">Those who have only a hammer as a tool see a nail in every problem.<br/>—Paul Watzlawick</p><p class="standard">When<a class="indexanchor" id="i21_00"/> we talk about the number of packages, the <span class="italic">Node Package Manager (npm)</span><a class="indexanchor" id="i21_01"/> is the most successful package manager worldwide and across all programming languages. This tool enables you to create modules and make them available to other developers. In the same way, you can use the modules other programmers have developed in your application. The npm website can be found at <span class="url"><a href="https://npmjs.com">https://npmjs.com</a></span>. It contains various resources such as module lists as well as detailed documentation of the npm and all available options. The npm was originally developed independently of the Node.js platform by Isaac Schlueter. Since version 0.6.3 of Node.js, npm is directly integrated into the platform and no longer needs to be installed separately. This means you can either install the Microsoft Software Installer (MSI) on Windows, the <samp class="listingcharacter listingcharacter">.pkg</samp> package on macOS, or the binary package on Linux, and then immediately use npm<a class="indexanchor" id="i21_02"/>. npm is used from the command line and can be controlled via various options. Today, npm and the repository are managed by one company—<span class="italic">npm Inc</span>. This company ensures the free availability of the registry and also offers commercial services such as private packages. In 2020, npm Inc. was bought by GitHub and thus belongs to Microsoft. As a result, behind the free package manager, there’s also a very large company, which hasn’t had any negative impact on npm since the acquisition.</p><p class="standard">npm is a full-fledged package manager for JavaScript that isn’t limited to Node.js but also allows you to manage packages for other environments such as the web browser. The core functions of npm include searching, installing, updating, and deleting packages. The <span class="italic">Node Packaged Modules</span><a class="indexanchor" id="i21_03"/>, which are the modules you can install via npm, are used to extend the functionality of the Node.js platform. This means they add the V8 engine and internal Node.js modules to the core Node.js platform. The npm packages are managed centrally on the server at <span class="url"><a href="http://registry.npmjs.com">http://registry.npmjs.com</a></span>. If you access this address from your browser, you’ll only get data structures in JavaScript Object Notation (JSON) format. In the root of the server, you can find general information about the repository, such as the number of modules.</p>
        <h2 class="t2" id="h21.1">21.1    <a id="p616"/>Most Common Operations<a class="indexanchor" id="i21_04"/></h2>
        <p class="standard">In the course of this book, you’ve already come across npm several times. In this chapter, we’ll introduce you to some more features of the package manager as well as its main competitors.</p>
        <p class="standard">During Node.js application development, you use npm in various ways, for example, to initialize your application, install packages, delete packages that are no longer needed, or update packages that have already been installed.</p>
        
            <h3 class="t3" id="h21.1.1">21.1.1    Searching Packages<a class="indexanchor" id="i21_05"/></h3>
            <p class="standard">The number of packages in the package manager’s repository<a class="indexanchor" id="i21_06"/> is constantly increasing, making npm currently the most popular package manager for JavaScript. However, this entails the disadvantage that you can quickly lose your overview due to the large number of packages. If you know which functionality you need in your application, you can search for specific packages. A first place to start is at <span class="url"><a href="http://www.npmjs.com">www.npmjs.com</a></span>, which allows you to search through the repository. Additionally, you can search directly via the <samp class="listingcharacter listingcharacter">npm</samp> command-line tool. To do this, you must use the <samp class="listingcharacter listingcharacter">search</samp><a class="indexanchor" id="i21_07"/> option with an appropriate keyword<a class="indexanchor" id="i21_08"/>. The fields <samp class="listingcharacter listingcharacter">Name</samp>, <samp class="listingcharacter listingcharacter">Description</samp>, <samp class="listingcharacter listingcharacter">Author</samp>, and <samp class="listingcharacter listingcharacter">Keywords</samp> are available for the search.</p>
            <p class="standard">Let’s suppose you want to include an XML parser<a class="indexanchor" id="i21_09"/> in your application, but you don’t know the exact name of the package to install. You can search the repository for it, and see the command and its output, as shown in <span class="crossreference "><a href="21_001.html#f21.1">Figure 21.1</a></span>.</p>
            <div class="imagebox figure-type"><a href="img-f21.1.html" id="f21.1"><img alt="The “npm search” Command" id="img-f21.1" src="bilderklein/klein21_001.png"/></a></div>
            <p class="caption "><b>Figure 21.1</b>    
            The “npm search” Command</p>
            <p class="standard">The <samp class="listingcharacter listingcharacter">npm search</samp> command directly accesses the application programming interface (API) of the npm registry<a class="indexanchor" id="i21_10"/> to display the information you’re looking for. To make the command work faster, a local index is created when it’s used for the first time, which will be used for all further searches. The npm automatically updates the index. The output of the command consists of the name of the module, the short description, the author of <a id="p617"/>the module, the date of the last update, and any keywords defined by the creator of the module.</p>
        
        
            <h3 class="t3" id="h21.1.2">21.1.2    Installing Packages<a class="indexanchor" id="i21_11"/></h3>
            <p class="standard">When you’ve found the package and know its name, you can install it on your system in the next step. To do this, you use the <samp class="listingcharacter listingcharacter">npm install</samp><a class="indexanchor" id="i21_12"/> command and append the package name to it. For example, if you want to install the <samp class="listingcharacter listingcharacter">lodash</samp><a class="indexanchor" id="i21_13"/> library in your application, you can do so by using the <samp class="listingcharacter listingcharacter">npm install lodash</samp> command. You can see the corresponding output in <span class="crossreference "><a href="21_001.html#l21.1">Listing 21.1</a></span>.</p>
            <div class="listing " id="l21.1"><pre><span class="bold"><samp class="listingcharacter listingcharacter">$ npm install lodash<br/></samp></span><br/>added 1 package, and audited 2 packages in 752ms<br/><br/>found 0 vulnerabilities </pre></div>
            <p class="caption "><b>Listing 21.1</b>    
            Installing “lodash” via npm</p>
            <p class="standard">In a first step, the <samp class="listingcharacter listingcharacter">npm install</samp> command queries the registry for information about the required package. The query consists of an HTTP <samp class="listingcharacter listingcharacter">GET</samp> request, like the one you can make from your browser. The data of the package is available as a JSON object. Among other things, this object contains information about the current version of the module, including the URL to the package itself. The package is available on the server as a zipped tar archive<a class="indexanchor" id="i21_14"/>. With another <samp class="listingcharacter listingcharacter">GET</samp> request, the npm downloads this archive and installs it on your computer.</p>
            <p class="standard">The installation of modules via npm is done locally in the directory you’re currently in within your shell without any further command-line entries. For you, this means you don’t need administrator permissions to install modules locally. The downloaded tar archive gets unpacked into the <span class="italic">node_modules</span><a class="indexanchor" id="i21_15"/> directory. In it, you’ll find a subdirectory per package with the name of the respective package. In the case of our example, the <span class="italic">node_modules</span><a class="indexanchor" id="i21_16"/> directory had to be created because it hadn’t existed yet. A subdirectory named <span class="italic">lodash</span> was created in it, which contains the files of the module.</p>
            <p class="standard">In addition to the pure installation of the package, the <samp class="listingcharacter listingcharacter">npm install</samp> command has two side effects: First, the package is entered as a dependency in the <span class="italic">package.json</span> file<a class="indexanchor" id="i21_17"/> of your application. <span class="crossreference "><a href="21_001.html#l21.2">Listing 21.2</a></span> contains an example of a <span class="italic">package.json</span> file. The dependencies section is especially relevant for the installation because that’s where the packages are entered.</p>
            <div class="listing " id="l21.2"><pre><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="hellblau">"name"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"node-book"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"version"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"1.0.0"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"description"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">""</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"main"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"index.js"</span><span class="schwarz">,</span><span class="schwarz"><br/></span><a id="p618"/>  <span class="hellblau">"private"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"type"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"module"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"keywords"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">[],</span><span class="schwarz"><br/></span>  <span class="hellblau">"author"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">""</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"license"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"ISC"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="hellblau">"dependencies"</span><span class="schwarz">: {</span><br/>    <span class="hellblau">"lodash"</span><span class="schwarz">: </span><span class="hellblau">"^4.17.21"</span><span class="schwarz"><br/></span>  }</samp></span><br/>} <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 21.2</b>    
            Sample “package.json” File</p>
            <p class="standard">Second, entries are created in <span class="italic">package-lock.json</span><a class="indexanchor" id="i21_18"/> for the package and all dependencies. This file contains the exact versions of all installed packages and their dependencies, including a checksum to ensure the integrity of the installation. <span class="crossreference "><a href="21_001.html#l21.3">Listing 21.3</a></span> contains the <span class="italic">package-lock.json</span> matching the <span class="italic">package.json</span> from <span class="crossreference "><a href="21_001.html#l21.2">Listing 21.2</a></span>.</p>
            <div class="listing " id="l21.3"><pre><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="hellblau">"name"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"node-book"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"version"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"1.0.0"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"lockfileVersion"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">2,</span><span class="schwarz"><br/></span>  <span class="hellblau">"requires"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"packages"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="hellblau">""</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>      <span class="hellblau">"name"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"node-book"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>      <span class="hellblau">"version"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"1.0.0"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>      <span class="hellblau">"license"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"ISC"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>      <span class="hellblau">"dependencies"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>        <span class="hellblau">"lodash"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"^4.17.21"</span><span class="schwarz"><br/></span>      <span class="schwarz">}</span><span class="schwarz"><br/></span>    <span class="schwarz">},</span><span class="schwarz"><br/></span>    <span class="hellblau">"node_modules/lodash"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>      <span class="hellblau">"version"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"4.17.21"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>      <span class="hellblau">"resolved"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"https://registry.npmjs.org/lodash/-/lodash-4.17.21.tgz"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>      <span class="hellblau">"integrity"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ </span><br/>        +LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg=="<span class="schwarz"><br/></span>    <span class="schwarz">}</span><span class="schwarz"><br/></span>  <span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="hellblau">"dependencies"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="hellblau">"lodash"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>      <span class="hellblau">"version"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"4.17.21"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>      <span class="hellblau">"resolved"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"https://registry.npmjs.org/lodash/-/lodash-4.17.21.tgz"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>      <span class="hellblau">"integrity"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"sha512-v2kDEe57lecTulaDIuNTPy3Ry4gLGJ6Z1O3vE1krgXZNrsQ </span><br/>        +LFTGHVxVjcXPs17LhbZVGedAJv8XZ1tvj5FvSg=="<span class="schwarz"><br/></span><a id="p619"/>    <span class="schwarz">}</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 21.3</b>    
            Sample “package-lock.json” File</p>
            <p class="standard">Unlike <span class="italic">package.json</span>, which lists only the directly installed packages, <span class="italic">package-lock.json</span> contains all installed packages, including all dependencies<a class="indexanchor" id="i21_19"/> of the installed packages. If you use a version control system<a class="indexanchor" id="i21_20"/> for your application, which you definitely should do, you can commit both the <span class="italic">package.json</span> and the <span class="italic">package-lock.json</span> files, as both files combined ensure the consistency of your application.</p>
            
                <h4 class="t4" id="h21.1.2.1">Handling Dependencies<a class="indexanchor" id="i21_21"/></h4>
                <p class="standard">If the installed package itself has dependencies, these are also installed in the <span class="italic">node_modules</span> directory. Dependencies in this case are modules that a package needs to function. <span class="crossreference "><a href="21_001.html#l21.4">Listing 21.4</a></span> shows an example of this using the Express package.</p>
                <div class="listing " id="l21.4"><pre><span class="bold"><samp class="listingcharacter listingcharacter">$ npm install express<br/></samp></span><br/>added 50 packages, and audited 51 packages in 2s<br/><br/>found 0 vulnerabilities </pre></div>
                <p class="caption "><b>Listing 21.4</b>    
            Installing the “express” Package</p>
                <p class="standard">During the installation process, you’ll see the information about the dependencies that will be installed along with a progress bar indicating the progress of the entire installation process. The earlier versions of npm still displayed the URLs of the individual packages here, which became very confusing when multiple dependencies were being installed.</p>
                <p class="standard">The handling of dependencies also changed from the third version of the npm onward. In version 2, packages were broken up into a highly tiered per-package hierarchy. This meant that each package had its own <span class="italic">node_modules</span> directory<a class="indexanchor" id="i21_22"/> where the respective dependencies were stored, which caused problems with overly long path names, especially in Windows systems. As of version 3, all dependencies are stored directly in the <span class="italic">node_modules</span> directory, so the directory tree is greatly simplified.</p>
                <p class="standard">However, storing all modules in a flat directory hierarchy<a class="indexanchor" id="i21_23"/> can cause version conflicts. npm gets around this by reverting to the old strategy if there’s a version conflict and assigning the corresponding package a separate <span class="italic">node_modules</span> directory where the differing version of the dependency gets installed.</p>
                <p class="standard">Another change in the installation of packages involves the handling of <samp class="listingcharacter listingcharacter">peerDependencies</samp><a class="indexanchor" id="i21_24"/>. A package can define different types of dependencies. One of them is <samp class="listingcharacter listingcharacter">peerDependencies</samp>. Previously, these were installed automatically. Between versions 3 and 7, this <a id="p620"/>was no longer the case, so you had to take care of installing these dependencies yourself. The reason for this decision were numerous version conflicts that arose. Starting with version 7 of npm, the package manager installs the <samp class="listingcharacter listingcharacter">peerDependencies</samp> again by default. These types of dependencies are mainly used when you install software based on plug-ins, such as Grunt.</p>
                <p class="standard">For example, the <samp class="listingcharacter listingcharacter">copy</samp> plug-in in Grunt contains Grunt itself as <samp class="listingcharacter listingcharacter">peerDependency</samp>. If you now install this plug-in without Grunt itself being installed, you’ll receive an error message informing you of this fact.</p>
            
            
                <h4 class="t4" id="h21.1.2.2">Global Installation<a class="indexanchor" id="i21_25"/></h4>
                <p class="standard">In addition to the local installation in the current directory, you can also install a Node.js module on the entire system<a class="indexanchor" id="i21_26"/> so that it’s available not only to you in your current project but also to all users and projects on the machine. You can install a module globally by specifying the <samp class="listingcharacter listingcharacter">-g</samp> command-line option for <span class="italic">global</span> in the installation command. <span class="crossreference "><a href="21_001.html#l21.5">Listing 21.5</a></span> shows an example of the global installation of TypeScript.</p>
                <div class="listing " id="l21.5"><pre>npm install -g typescript  </pre></div>
                <p class="caption "><b>Listing 21.5</b>    
            Global Installation of TypeScript</p>
                <p class="standard">There are a few things you need to keep in mind when installing global modules, which makes this process different from a local installation. As a normal user, you’re not allowed to install modules globally, as they are stored in the <span class="italic">/usr/local/lib/node_modules</span> directory by default. For this reason, you must perform the installation either directly as an administrator or—on Unix systems—using the <samp class="listingcharacter listingcharacter">sudo</samp><a class="indexanchor" id="i21_27"/> command. However, the global installation of modules is mainly intended for command-line tools that have been implemented with Node.js. Examples include TypeScript, which you already learned about in <span class="crossreference "><a href="13_001.html#h13">Chapter 13</a></span>, or webpack, a build tool for JavaScript applications. For regular modules such as <samp class="listingcharacter listingcharacter">lodash</samp> or Express, it makes sense to install them locally. One of the reasons is that local modules can be loaded faster because the search process<a class="indexanchor" id="i21_28"/> for the module is significantly shortened. Another significant reason is that an application with globally installed modules has external dependencies. This means each system on which the application is supposed to be run must have these global modules installed, or the application won’t run. For this reason, it’s recommended that you also install all modules on which your application is based locally, so that it can run as independently as possible. In general, you should try to get by with as few globally installed packages as possible. One of the tools that can help you with this is <samp class="listingcharacter listingcharacter">npx</samp>, which will be described in greater detail in <span class="crossreference "><a href="21_003.html#h21.3.4">Section 21.3.4</a></span>.</p>
                <p class="standard">Whether you install a module locally or globally, you’ll always see the progress bar first as the output of the <samp class="listingcharacter listingcharacter">npm install</samp> command, and then a summary once the installation is complete, which includes the number of packages installed, the number of packages that have undergone a security check, and the time required. If any of the installed packages have known security vulnerabilities, you’ll also be notified.</p>
            
            
                <h4 class="t4" id="h21.1.2.3"><a id="p621"/>Types of Dependencies<a class="indexanchor" id="i21_29"/></h4>
                <p class="standard">In addition to <samp class="listingcharacter listingcharacter">peerDependencies</samp><a class="indexanchor" id="i21_30"/>, npm distinguishes between <samp class="listingcharacter listingcharacter">dependencies</samp>, <samp class="listingcharacter listingcharacter">devDependencies</samp><a class="indexanchor" id="i21_31"/>, <samp class="listingcharacter listingcharacter">optionalDependencies</samp><a class="indexanchor" id="i21_32"/>, and <samp class="listingcharacter listingcharacter">bundledDependencies</samp><a class="indexanchor" id="i21_33"/>. <samp class="listingcharacter listingcharacter">dependencies</samp> represent the dependencies required for the execution of your application, such as Express being required for a web application. This type of dependency is specified via the <samp class="listingcharacter listingcharacter">npm install</samp> command without appending an option. This makes sure that the dependency is automatically entered into the <span class="italic">package.json</span> file under the <samp class="listingcharacter listingcharacter">dependencies</samp> key.</p>
                <p class="standard"><samp class="listingcharacter listingcharacter">devDependencies</samp>, on the other hand, are only needed for the development process. A typical example includes code analysis tools such as ESLint or testing frameworks like Mocha. These packages can be installed using the <samp class="listingcharacter listingcharacter">npm install --save-dev</samp> command. The option <samp class="listingcharacter listingcharacter">--save-dev</samp><a class="indexanchor" id="i21_34"/> (or its short form <samp class="listingcharacter listingcharacter">-D</samp>) enters the name and version of the package into the <span class="italic">package.json</span><a class="indexanchor" id="i21_35"/> file as <samp class="listingcharacter listingcharacter">devDependency</samp>.</p>
                <p class="standard"><samp class="listingcharacter listingcharacter">optionalDependencies</samp> are dependencies that can be installed but won’t cause the installation to fail if they aren’t available. The dependencies of the <samp class="listingcharacter listingcharacter">bundledDependencies</samp> type are integrated into the package when the package is published.</p>
            
            
                <h4 class="t4" id="h21.1.2.4">Installation from Other Sources<a class="indexanchor" id="i21_36"/></h4>
                <p class="standard">However, you’re not dependent on a permanent connection to the server when installing modules via the npm. In addition to installing the modules via an existing internet connection, you also have the option to install modules directly from your computer. The only requirement for this is that you’ve either downloaded the tar archive<a class="indexanchor" id="i21_37"/> containing the package or have a directory on your machine that contains the source code of the package and a corresponding <span class="italic">package.json</span> file. To test the local installation, you can simply download the <samp class="listingcharacter listingcharacter">lodash</samp> package and install it. <span class="crossreference "><a href="21_001.html#l21.6">Listing 21.6</a></span> shows how to do this.</p>
                <div class="listing " id="l21.6"><pre>$ <span class="bold"><samp class="listingcharacter listingcharacter">wget https://registry.npmjs.org/lodash/-/lodash-4.17.21.tgz</samp></span><br/>...<br/>$ <span class="bold"><samp class="listingcharacter listingcharacter">npm install lodash-4.17.21.tgz <br/></samp></span><br/>added 1 package, and audited 2 packages in 1s<br/><br/>found 0 vulnerabilities </pre></div>
                <p class="caption "><b>Listing 21.6</b>    
            Local Installation of a Module via npm</p>
                <p class="standard">Similar to using the repository at <span class="url"><a href="http://www.npmjs.org">www.npmjs.org</a></span>, the installation creates a <span class="italic">node_modules</span> directory into which the source code of the package is copied. After successful installation, you can use the package in your application.</p>
            
            
                <h4 class="t4" id="h21.1.2.5">Packages and Version Control<a class="indexanchor" id="i21_38"/></h4>
                <p class="standard">Over the years, a best practice has become to not commit the <span class="italic">node_modules</span> directory to your application’s version control system. For example, if you use <samp class="listingcharacter listingcharacter">git</samp>, you should <a id="p622"/>add <span class="italic">node_modules</span> to the <span class="italic">.gitignore</span> file<a class="indexanchor" id="i21_39"/> of your project. The reason is that the npm repository provides the packages, and the local npm cache makes sure that the packages can be reinstalled relatively quickly after the initial installation. The <span class="italic">node_modules</span> directory of a larger application can quickly become several hundred megabytes in size.</p>
                <p class="standard">Once you’ve loaded the initial source code of an application onto your development system, there is usually no <span class="italic">node_modules</span> directory, and you can’t launch the application. To install the required packages, you must use the <samp class="listingcharacter listingcharacter">npm install</samp> command. In this context, it’s important that you don’t specify a package name. npm then installs all packages specified in the <span class="italic">package.json</span> file, relying on the exact version information and checksums from the <span class="italic">package-lock.json</span> file. If you don’t want to install the <samp class="listingcharacter listingcharacter">devDependencies</samp> for a production release of your application, you can use the <samp class="listingcharacter listingcharacter">--prod</samp><a class="indexanchor" id="i21_40"/> option. This option only installs packages listed as <samp class="listingcharacter listingcharacter">dependency</samp> in the <span class="italic">package.json</span> file.</p>
            
        
        
            <h3 class="t3" id="h21.1.3">21.1.3    Viewing Installed Packages<a class="indexanchor" id="i21_41"/></h3>
            <p class="standard">All the packages you install can be found in the <span class="italic">node_modules</span> directory of your application. However, because all dependencies<a class="indexanchor" id="i21_42"/> are also resolved in the same directory, it quickly gets confusing when you want to find out which packages are installed within your application. A quick overview of the existing modules and their dependencies is provided by the <samp class="listingcharacter listingcharacter">npm list</samp> command. By default, this command shows the top-level dependencies. If you want to see the tree of all installed dependencies, you must additionally enter the <samp class="listingcharacter listingcharacter">--all</samp> option.</p>
            <p class="standard">As you can see in <span class="crossreference "><a href="21_001.html#l21.7">Listing 21.7</a></span>, the list of modules is created as a tree structure<a class="indexanchor" id="i21_43"/> in which you can directly see which modules are installed and how the dependencies between the modules are defined. If you see the term <samp class="listingcharacter listingcharacter">deduped</samp><a class="indexanchor" id="i21_44"/> next to a package in the list, it means that npm has removed a duplicate and is keeping the library only once for multiple use cases. With the <samp class="listingcharacter listingcharacter">-g</samp> option, you also get a list of all globally installed modules of your system from npm. All those dependencies are also displayed in a tree structure.</p>
            <div class="listing " id="l21.7"><pre>$ <span class="bold"><samp class="listingcharacter listingcharacter">npm list --all</samp></span><br/>node-book@1.0.0 /srv/node<br/>└─┬ express@4.17.1<br/>  ├─┬ accepts@1.3.7<br/>  │ ├─┬ mime-types@2.1.32<br/>  │ │ └── mime-db@1.49.0<br/>  │ └── negotiator@0.6.2<br/>  ├── array-flatten@1.1.1<br/>  ├─┬ body-parser@1.19.0<br/>  │ ├── bytes@3.1.0 </pre></div>
            <p class="caption "><b>Listing 21.7</b>    
            List of Installed Modules</p>
            <p class="standard"><a id="p623"/>There are cases where you’re not interested in the dependencies and the whole tree structure, but you may just want to know which packages you’ve installed directly. This happens especially when you’ve added a large number of packages, and the display with all dependencies becomes very confusing. The solution to this problem is the <samp class="listingcharacter listingcharacter">--depth</samp> command-line option. A value of <samp class="listingcharacter listingcharacter">0</samp> shows you only the directly installed packages, <samp class="listingcharacter listingcharacter">1</samp> represents the first dependency level, and so on. <span class="crossreference "><a href="21_001.html#l21.8">Listing 21.8</a></span> shows how you can use this.</p>
            <div class="listing " id="l21.8"><pre>$ <span class="bold"><samp class="listingcharacter listingcharacter">npm list --depth=0</samp></span><br/>node-book@1.0.0 /srv/node<br/>├── express@4.16.3<br/>└── lodash@4.17.10 </pre></div>
            <p class="caption "><b>Listing 21.8</b>    
            Limiting the Output of “npm list”</p>
        
        
            <h3 class="t3" id="h21.1.4">21.1.4    Using Packages<a class="indexanchor" id="i21_45"/></h3>
            <p class="standard">As you’ve already seen, there are two different types of modules that can be installed via npm. First, there are collections of functionalities that you can include directly in your application, and, secondly, there are tools you can use from the command line<a class="indexanchor" id="i21_46"/>. The following sections describe examples from both categories. In this context, you’ll see how you can use the modules accordingly in practice.</p>
            <p class="standard">In <span class="crossreference "><a href="21_001.html#l21.5">Listing 21.5</a></span>, you already installed <samp class="listingcharacter listingcharacter">typescript</samp> globally on your system. After successful installation, the <samp class="listingcharacter listingcharacter">tsc</samp> command is available system wide. In this case, the <samp class="listingcharacter listingcharacter">tsc</samp> command is a normal JavaScript application with a hint for the operating system in the file header, the shebang (<samp class="listingcharacter listingcharacter">#!</samp>)<a class="indexanchor" id="i21_47"/>, which indicates to the shell the application the script is to be interpreted with. In the case of the TypeScript compiler, this line reads <samp class="listingcharacter listingcharacter">#!/usr/bin/env node</samp>, and it means that the script should be run using Node.js. With these customizations, a JavaScript application like the TypeScript compiler can be used on the command line as an ordinary command and doesn’t need to be passed as a parameter to Node.js.</p>
            <p class="standard">The second way to use modules you install via npm is to integrate the respective functionality directly into your application. In the course of this section, you’ve already seen how you can install the <samp class="listingcharacter listingcharacter">lodash</samp> library locally in your application.</p>
            <p class="standard">In <span class="crossreference "><a href="21_001.html#l21.9">Listing 21.9</a></span>, you import the <samp class="listingcharacter listingcharacter">intersection</samp> function from the <samp class="listingcharacter listingcharacter">lodash</samp> package. <samp class="listingcharacter listingcharacter">Lodash</samp> defines a separate file for each function, but you can also use the default export of package and then use the <samp class="listingcharacter listingcharacter">intersection</samp> function from there. Then, you define two arrays and have their intersection output. For this purpose, Underscore.js provides the <samp class="listingcharacter listingcharacter">intersection</samp> function. The return in this case is an array containing the elements <samp class="listingcharacter listingcharacter">b</samp> and <samp class="listingcharacter listingcharacter">c</samp>.</p>
            <div class="listing " id="l21.9"><pre><span class="rot">import</span><span class="schwarz"> intersection </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'lodash/intersection.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> arr1 </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="hellblau">'a'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'b'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'c'</span><span class="schwarz">];</span><span class="schwarz"><br/></span><span class="rot"><a id="p624"/>const</span><span class="schwarz"> arr2 </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="hellblau">'b'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'c'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'d'</span><span class="schwarz">];</span><span class="schwarz"><br/></span> <br/><span class="magenta">console</span><span class="schwarz">.log(intersection(</span><span class="schwarz">arr1</span><span class="schwarz">,</span><span class="schwarz"> arr2</span><span class="schwarz">));</span><span class="gruen"> // [ 'b', 'c' ]</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 21.9</b>    
            Simple Example of Using a Module</p>
        
        
            <h3 class="t3" id="h21.1.5">21.1.5    Updating Packages<a class="indexanchor" id="i21_48"/></h3>
            <p class="standard">Many modules available through the npm repository are actively developed by their authors. This means updates of these modules become available at more or less regular intervals. In the following sections, you’ll learn how the npm update mechanism works.</p>
            <p class="standard">For this example to work correctly, your project should have a valid definition file—the <span class="italic">package.json</span> file. The <samp class="listingcharacter listingcharacter">npm init -y</samp><a class="indexanchor" id="i21_49"/> command allows you to have such a <span class="italic">package.json</span> file created automatically. In it, the required versions are stored within your software.</p>
            <p class="standard">For the example, you need to use yet another feature of the <samp class="listingcharacter listingcharacter">npm install</samp> command. Not only can this command install modules in their latest version, you can also specify a specific version of a module to be installed. To test the package update, you’ll use the <samp class="listingcharacter listingcharacter">lodash</samp> module in this case, but have it installed in the older version<a class="indexanchor" id="i21_50"/> 4.0.0 rather than its latest version. You can install a module in a specific version by appending an <samp class="listingcharacter listingcharacter">@</samp> sign and the desired version number to the module name in the <samp class="listingcharacter listingcharacter">install</samp> command. The installation process will then proceed as usual. npm queries the repository for the data about the module, receives the path to the tar archive, and downloads and adds it to the local <span class="italic">node_modules</span> directory, including all required dependencies. When you take a look at the <span class="italic">package.json</span> file, you’ll see that the version number is stored there.</p>
            <p class="standard">To enable the updating functionality now, you need to replace the <samp class="listingcharacter listingcharacter">^</samp> character with a <samp class="listingcharacter listingcharacter">&gt;=</samp>. After that, you instruct npm to check for and install updates for all packages in the current project. During this process, npm detects the version difference between version 4.0.0 of <samp class="listingcharacter listingcharacter">lodash</samp> you’ve installed and the current version. This means the module should be updated. Then the current package is downloaded from the repository and installed. As a result, after the operations shown in detail in <span class="crossreference "><a href="21_001.html#l21.10">Listing 21.10</a></span>, including the corresponding tasks, the current version of the <samp class="listingcharacter listingcharacter">lodash</samp> module is located in the <span class="italic">local node_modules</span> directory and is thus available for your entire application.</p>
            <div class="listing " id="l21.10"><pre>$ npm init -y<br/>...<br/>$ <span class="bold"><samp class="listingcharacter listingcharacter">npm install lodash@4.0.0<br/></samp></span><br/>added 1 package, and audited 2 packages in 778ms<br/><br/>1 high severity vulnerability<br/><br/>To address all issues (including breaking changes), run:<br/><a id="p625"/>  npm audit fix --force<br/><br/>Run `npm audit` for details.<br/><span class="bold"><samp class="listingcharacter listingcharacter">$ npm update<br/></samp></span><br/>changed 1 package, and audited 2 packages in 795ms<br/><br/>found 0 vulnerabilities </pre></div>
            <p class="caption "><b>Listing 21.10</b>    
            Updating Modules</p>
            <p class="standard">If you enter the <samp class="listingcharacter listingcharacter">npm update</samp> command on the command line in the directory of your application without any further options, npm will check for updates for all modules installed locally in your application. If you want to install a more recent version only for a specific module, you must append the name of the module you want to update to the command. For example, to explicitly update only the <samp class="listingcharacter listingcharacter">lodash</samp> module, you must enter the <samp class="listingcharacter listingcharacter">npm update lodash</samp> command. Typically, <samp class="listingcharacter listingcharacter">npm update</samp> updates only the modules within the directory hierarchy you’re currently in. To update globally installed modules, you can use the <samp class="listingcharacter listingcharacter">-g</samp> option, as with the other npm commands.</p>
            <p class="standard">You can use the <samp class="listingcharacter listingcharacter">npm outdated</samp><a class="indexanchor" id="i21_51"/> command to find out if any of the packages you use in your application are outdated. <span class="crossreference "><a href="21_001.html#l21.11">Listing 21.11</a></span> shows the output of the command if you have <samp class="listingcharacter listingcharacter">lodash</samp> version 4.0.0 installed.</p>
            <div class="listing " id="l21.11"><pre>$ <span class="bold"><samp class="listingcharacter listingcharacter">npm outdated</samp></span><br/>Package  Current   Wanted   Latest  Location             Depended by<br/>lodash     4.0.0  4.17.21  4.17.21  node_modules/lodash  node-book </pre></div>
            <p class="caption "><b>Listing 21.11</b>    
            Output of “npm outdated”</p>
            <p class="standard">If a more recent version for a package is available, it will be listed; otherwise, the list is empty. <samp class="listingcharacter listingcharacter">npm outdated</samp> shows the package name and the currently installed version. The <samp class="listingcharacter listingcharacter">Wanted</samp> column displays the maximum installable version that the version specification in the <span class="italic">package.json</span> file allows. The <samp class="listingcharacter listingcharacter">Latest</samp> column lists the highest version available.</p>
            <p class="standard">So far, you’ve seen how you can find modules, install them, view the installed modules, and update them. In the next step, you’ll learn how to remove installed modules.</p>
        
        
            <h3 class="t3" id="h21.1.6">21.1.6    Removing Packages<a class="indexanchor" id="i21_52"/></h3>
            <p class="standard">If you discover during development that you don’t need or no longer need a particular module in your application, you should remove it. You can easily remove packages manually by deleting the corresponding subdirectory of the <span class="italic">node_modules</span> directory. However, this has the disadvantage that all dependencies are still installed, although there is no reference to them. Instead, you should resort to the npm functionality of removing packages. The <samp class="listingcharacter listingcharacter">npm uninstall</samp><a class="indexanchor" id="i21_53"/> command ensures that npm removes the <a id="p626"/>specified module and all its dependencies from your application. In addition, <span class="italic">package.json</span> as well as the <span class="italic">package-lock.json</span> file are cleaned up.</p>
            <p class="standard">In <span class="crossreference "><a href="21_001.html#l21.12">Listing 21.12</a></span>, you remove the <samp class="listingcharacter listingcharacter">lodash</samp> module you’ve previously installed locally from your application again.</p>
            <div class="listing " id="l21.12"><pre>$ <span class="bold"><samp class="listingcharacter listingcharacter">npm list </samp></span><br/>node-book@1.0.0 /srv/node<br/>└── lodash@4.17.21<br/><br/>$ <span class="bold"><samp class="listingcharacter listingcharacter">npm uninstall lodash<br/></samp></span><br/>removed 1 package, and audited 1 package in 415ms<br/> <br/>found 0 vulnerabilities<br/><br/>$ <span class="bold"><samp class="listingcharacter listingcharacter">npm list</samp></span><br/>node-book@1.0.0 /srv/node<br/>└── (empty) </pre></div>
            <p class="caption "><b>Listing 21.12</b>    
            Uninstalling Modules</p>
            <p class="standard">The <samp class="listingcharacter listingcharacter">npm uninstall</samp> command uninstalls the specified module. If the module doesn’t exist, you’ll receive a message that the application is already in the desired state. If the deinstallation was successful, the command specifies the number of removed packages. In the example in <span class="crossreference "><a href="21_001.html#l21.12">Listing 21.12</a></span>, you can see that a subsequent <samp class="listingcharacter listingcharacter">npm list</samp> doesn’t find any locally installed modules.</p>
            <p class="standard">You can also remove globally installed modules via <samp class="listingcharacter listingcharacter">npm uninstall</samp>. Not only does this command make sure that the module's source code is removed from <span class="italic">/usr/local/lib/node_modules</span>, it also deletes any symbolic links required to run a command-line tool such as TypeScript.</p>
        
        
            <h3 class="t3" id="h21.1.7">21.1.7    Overview of the Most Important Commands<a class="indexanchor" id="i21_54"/></h3>
            <p class="standard">In the previous sections, you’ve seen how you can manage additional modules for your Node.js platform using the npm. <span class="crossreference "><a href="21_001.html#t21.1">Table 21.1</a></span> summarizes the most important commands<a class="indexanchor" id="i21_55"/> for you.</p>
            <table class="standardtable" id="t21.1">
                <thead>
                    <tr>
                        <th class="tablehead tablecell_first top_border_cell">
                            <p class="standard first-item last-item">Command</p>
                        </th>
                        <th class="tablehead tablecell_middle top_border_cell">
                            <p class="standard first-item last-item">Short Form</p>
                        </th>
                        <th class="tablehead tablecell_last top_border_cell">
                            <p class="standard first-item last-item">Description</p>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="tablecell tablecell_first top_border_cell">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">npm search &lt;term&gt;</samp></p>
                        </td>
                        <td class="tablecell tablecell_middle top_border_cell">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">npm s &lt;term&gt;</samp></p>
                        </td>
                        <td class="tablecell tablecell_last top_border_cell">
                            <p class="standard first-item last-item">Searches the repository for <samp class="listingcharacter listingcharacter">&lt;term&gt;</samp></p>
                        </td>
                    </tr>
                    <tr class="light">
                        <td class="tablecell tablecell_first">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">npm install &lt;package&gt;</samp></p>
                        </td>
                        <td class="tablecell tablecell_middle">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">npm i &lt;package&gt;</samp></p>
                        </td>
                        <td class="tablecell tablecell_last">
                            <p class="standard first-item last-item">Installs the <samp class="listingcharacter listingcharacter">&lt;package&gt;</samp> package</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="tablecell tablecell_first">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">npm list</samp></p>
                        </td>
                        <td class="tablecell tablecell_middle">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">npm ls</samp></p>
                        </td>
                        <td class="tablecell tablecell_last">
                            <p class="standard first-item last-item">Shows all installed packages</p>
                        </td>
                    </tr>
                    <tr class="light">
                        <td class="tablecell tablecell_first">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter"><a id="p627"/>npm update</samp></p>
                        </td>
                        <td class="tablecell tablecell_middle">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">npm up</samp></p>
                        </td>
                        <td class="tablecell tablecell_last">
                            <p class="standard first-item last-item">Updates all local packages</p>
                        </td>
                    </tr>
                    <tr>
                        <td class="tablecell tablecell_first">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">npm uninstall &lt;package&gt;</samp></p>
                        </td>
                        <td class="tablecell tablecell_middle">
                            <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">npm rm &lt;package&gt;</samp></p>
                        </td>
                        <td class="tablecell tablecell_last">
                            <p class="standard first-item last-item">Removes the <samp class="listingcharacter listingcharacter">&lt;package&gt;</samp> module</p>
                        </td>
                    </tr>
                </tbody>
            </table>
            <p class="caption "><b>Table 21.1</b>    
            Most Important npm Commands</p>
            <p class="standard">The short forms in <span class="crossreference "><a href="21_001.html#t21.1">Table 21.1</a></span> <a class="indexanchor" id="i21_56"/>are the abbreviated notations for npm commands, which are very convenient for you as a user of the tool, as they simplify the commands even further. For example, instead of <samp class="listingcharacter listingcharacter">npm uninstall</samp>, you can write <samp class="listingcharacter listingcharacter">npm rm</samp>. The functionality of both commands is identical.</p>
            <p class="standard">As described earlier, you can add the <samp class="listingcharacter listingcharacter">-g</samp> option or the longer <samp class="listingcharacter listingcharacter">--global</samp> option to the <samp class="listingcharacter listingcharacter">install</samp>, <samp class="listingcharacter listingcharacter">list</samp>, <samp class="listingcharacter listingcharacter">update</samp>, and <samp class="listingcharacter listingcharacter">uninstall</samp> commands to install modules system-wide.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>