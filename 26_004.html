<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Performance" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Performance" name="description"/>
            <meta content="en" name="language"/>
            <title>Performance</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h26.4">26.4    Network<a class="indexanchor" id="i26_62"/></h2>
        <p class="standard">For the analysis of the network traffic, we’ll use a simple Express application as a basis. For this, you first create a <span class="italic">package.json</span> file via <samp class="listingcharacter listingcharacter">npm init -y</samp> and install the Express package using <samp class="listingcharacter listingcharacter">npm install express</samp>, as shown in <span class="crossreference "><a href="26_004.html#l26.10">Listing 26.10</a></span>.</p>
        <div class="listing " id="l26.10"><pre><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="hellblau">"name"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"node-book"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"version"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"1.0.0"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"description"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">""</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"main"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"index.js"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"private"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"type"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"module"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"scripts"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="hellblau">"start"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"node index.js"</span><span class="schwarz"><br/></span>  <span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="hellblau">"keywords"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">[],</span><span class="schwarz"><br/></span>  <span class="hellblau">"author"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">""</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"license"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"ISC"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">"dependencies"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span><a id="p748"/>    <span class="hellblau">"express"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"^4.17.1"</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 26.10</b>    
            “package.json” File for the Express “package.json” Application</p>
        <p class="standard">The initial file for the application—the <span class="italic">index.js</span> file—looks like the one shown in <span class="crossreference "><a href="26_004.html#l26.11">Listing 26.11</a></span> and consists of initializing the <samp class="listingcharacter listingcharacter">app</samp> object, defining a <samp class="listingcharacter listingcharacter">GET</samp> route, and binding the application to port <samp class="listingcharacter listingcharacter">8080</samp>.</p>
        <div class="listing " id="l26.11"><pre><span class="rot">import</span><span class="schwarz"> express </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> app </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">express();</span><span class="schwarz"><br/></span> <br/>app<span class="schwarz">.get(</span><span class="hellblau">'/'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">request</span><span class="schwarz">,</span><span class="schwarz"> response</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="schwarz">setTimeout(()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    response<span class="schwarz">.send(</span><span class="violett">`Lorem ipsum...`</span><span class="schwarz">);</span><span class="gruen"> // Text shortened</span><span class="schwarz"><br/></span>  <span class="schwarz">},</span><span class="schwarz"> </span><span class="schwarz">2000);</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"><br/></span> <br/>app<span class="schwarz">.listen(8080,</span><span class="schwarz"> </span><span class="schwarz">()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Server is listening to http://localhost:8080'</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 26.11</b>    
            Entry into the Express Application (index.js)</p>
        <p class="standard">The route of the application sends an arbitrary text to the client for testing purposes. For our example,we had a Lorem ipsum generator create a 5,000-word text. The code example is significantly shortened at this point for the sake of clarity. However, the response isn’t sent immediately, but only after two seconds. This is to simulate the processing time on the server and represents, for example, an elaborate algorithm or communication with other systems. If you now start your application using the <samp class="listingcharacter listingcharacter">npm start</samp> command, you can access it from the browser via <span class="italic">http://localhost:8080</span>. To do this, you should open the browser’s DevTools and go to the <span class="screenelement">Network</span> tab<a class="indexanchor" id="i26_63"/> where you can see the network statistics<a class="indexanchor" id="i26_64"/> as shown in <span class="crossreference "><a href="26_004.html#f26.8">Figure 26.8</a></span>.</p>
        <p class="standard">To make the result a bit clearer, we enabled network throttling<a class="indexanchor" id="i26_65"/> and set it to Slow 3G. This means that the bandwidth<a class="indexanchor" id="i26_66"/> is artificially limited to simulate a worse connection. When you move your mouse cursor over the line of the request, you’ll see a detailed list of times. What immediately catches the eye here are the green and blue bars. The green bar represents the wait time<a class="indexanchor" id="i26_67"/> of the browser until the first byte<a class="indexanchor" id="i26_68"/> is received. This represents the time it takes for the server to process the request, and the 2.03 seconds is the time-out of two seconds and some overhead caused by Express. The blue bar symbolizes the time it takes to download the content. This period amounts to just under 600 milliseconds.</p>
        <div class="imagebox figure-type"><a href="img-f26.8.html" id="f26.8"><img alt="Network Analysis" id="img-f26.8" src="bilderklein/klein26_008.png"/></a></div>
        <p class="caption "><b>Figure 26.8</b>    
            <a id="p749"/>Network Analysis</p>
        <p class="standard">When optimizing the network, you should always look for the largest values and try to get as much out of them as possible. You can reduce the green bar, for example, if you speed up processing on the server by caching<a class="indexanchor" id="i26_69"/> values once they have been calculated, thus saving computing time.</p>
        <p class="standard">You can improve the blue bar by reducing the amount of data that needs to be transported. This can be done, on the one hand, by omitting unnecessary data. But you can also optimize the data. For example, you can have HTML, CSS, and JavaScript remove unnecessary space characters and comments<a class="indexanchor" id="i26_70"/>. Another optimization option is to compress the communication<a class="indexanchor" id="i26_71"/>. For Express in this case, there is a middleware available called <samp class="listingcharacter listingcharacter">compression</samp>. You can install this middleware via the <samp class="listingcharacter listingcharacter">npm install compression</samp> command. <span class="crossreference "><a href="26_004.html#l26.12">Listing 26.12</a></span> shows how you can enable compression for your application.</p>
        <div class="listing " id="l26.12"><pre><span class="rot">import</span><span class="schwarz"> express </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> compression </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'compression'</span><span class="schwarz">;</span><br/> </samp></span><br/><span class="rot">const</span><span class="schwarz"> app </span><span class="dunkelblau">=</span><span class="schwarz"> express();</span><br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter">app.use(compression({ level: 9 }));<br/> </samp></span><br/>app.get(<span class="hellblau">'/'</span><span class="schwarz">, (request, response) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/><a id="p750"/>  setTimeout(() <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>    response.send(<span class="violett">`Lorem ipsum...`</span><span class="schwarz">);</span><span class="gruen"> // Text shortened</span><span class="schwarz"><br/></span>  }, 2000);<br/>});<br/> <br/>app.listen(8080, () <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Server is listening to http://localhost:8080'</span><span class="schwarz">);</span><br/>}); <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 26.12</b>    
            Enabling Compression for Communication (index.js)</p>
        <p class="standard">The value <samp class="listingcharacter listingcharacter">9</samp> for the <samp class="listingcharacter listingcharacter">level</samp> property in the middleware configuration object <samp class="listingcharacter listingcharacter">compression</samp> indicates that the best compression level should be used. Here, the compression takes the longest time, but the result is the smallest. You should aim for a good balance of CPU time and transfer speed. If you now perform another measurement, you’ll see the effect of the compression.</p>
        <p class="standard">As you can see, the blue bar has shrunk to 0.63 milliseconds, as shown in <span class="crossreference "><a href="26_004.html#f26.9">Figure 26.9</a></span>, because instead of the original 30.5 KB, only 1.2 KB needs to be transferred. So, this optimization has a very positive effect on the performance of our application.</p>
        <div class="imagebox figure-type"><a href="img-f26.9.html" id="f26.9"><img alt="Measurement with Active Compression" id="img-f26.9" src="bilderklein/klein26_009.png"/></a></div>
        <p class="caption "><b>Figure 26.9</b>    
            Measurement with Active Compression</p>
    </div><p class="signatur"/>
                    </body>
                </html>