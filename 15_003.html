<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Node on the Command Line" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Node on the Command Line" name="description"/>
            <meta content="en" name="language"/>
            <title>Node on the Command Line</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h15.3">15.3    <a id="p461"/>Accessing Input and Output<a class="indexanchor" id="i15_47"/></h2>
        <p class="standard">In a web application, communication takes place over the network<a class="indexanchor" id="i15_48"/> using a browser. The communication protocol is usually HTTP. For a command-line application, however, different rules apply when it comes to communication. There’s only one endpoint and not any number of them. Moreover, the user doesn’t connect to the application via the network, but works directly with the application through the command prompt. So, you have to keep some things in mind when it comes to input and output, especially if you aren’t just generating output but interacting with the user during the runtime of the command-line application, as in the Math Trainer example.</p>
        
            <h3 class="t3" id="h15.3.1">15.3.1    Output<a class="indexanchor" id="i15_49"/></h3>
            <p class="standard">The general rule for Unix applications is that if there’s nothing to report, the application won’t generate any output. If the processing was successful, it isn’t necessary to spend anything. Nevertheless, it’s good style to give the user direct feedback. This is either done automatically by the application or can be controlled by the user.</p>
            <p class="standard">The simplest way to output information on the command line is the <samp class="listingcharacter listingcharacter">console.log</samp> method. Everything you pass to it is written directly to standard output<a class="indexanchor" id="i15_50"/>. However, a Node.js process has two output channels<a class="indexanchor" id="i15_51"/>: standard output and standard error output<a class="indexanchor" id="i15_52"/>. You can address both output channels via the global <samp class="listingcharacter listingcharacter">process</samp> module. <span class="crossreference "><a href="15_003.html#l15.8">Listing 15.8</a></span> shows how you can access the output channels in write mode. The standard output channel is represented by the <samp class="listingcharacter listingcharacter">process.stdout</samp><a class="indexanchor" id="i15_53"/> object, while the standard error output channel is represented by the <samp class="listingcharacter listingcharacter">process.stderr</samp><a class="indexanchor" id="i15_54"/> object. Both objects are of the writable stream type and therefore implement the <samp class="listingcharacter listingcharacter">write</samp> method. Unlike <samp class="listingcharacter listingcharacter">console.log</samp>, which automatically inserts a line break, you have to take care of this yourself via the <samp class="listingcharacter listingcharacter">write</samp> method using the <samp class="listingcharacter listingcharacter">\n</samp> control character; otherwise, this method simply continues the current output line forever.</p>
            <div class="listing " id="l15.8"><pre>process.stdout.write('This is stdout\n'); // Output: This is stdout<br/>process.stderr.write('This is stderr\n'); // Output: This is stderr </pre></div>
            <p class="caption "><b>Listing 15.8</b>    
            Accessing the Standard Output and Standard Error Output Channels</p>
            <p class="standard">If you save the source code in a file named <span class="italic">output.js</span>, you can access the respective channel using the commands from <span class="crossreference "><a href="15_003.html#l15.9">Listing 15.9</a></span>.</p>
            <div class="listing " id="l15.9"><pre><span class="bold"><samp class="listingcharacter listingcharacter">$ node output.js </samp></span><br/>This is stdout<br/>This is stderr<br/><span class="bold"><samp class="listingcharacter listingcharacter">$ node output.js 1&gt; app.log</samp></span><br/><a id="p462"/>This is stderr<br/><span class="bold"><samp class="listingcharacter listingcharacter">$ node output.js 2&gt; err.log</samp></span><br/>This is stdout </pre></div>
            <p class="caption "><b>Listing 15.9</b>    
            Output in the Standard Output and Standard Error Output Channels</p>
            <p class="standard">You won’t notice any difference between the two output channels until you separate the two. You can use the <samp class="listingcharacter listingcharacter">node output.js 2&gt; err.log</samp> command to redirect the standard error output to the <span class="italic">err.log</span> file so that only the values of the standard output are displayed. With <samp class="listingcharacter listingcharacter">node output.js 1&gt; app.log</samp>, you write the standard output messages to the <span class="italic">app.log</span> file, and the error output appears on the console. In an application, this separation can be helpful to keep the output clear and still record all errors to handle them at a later time.</p>
            <p class="standard">Similar to <samp class="listingcharacter listingcharacter">console.log</samp>, which writes to standard output, Node.js also provides <samp class="listingcharacter listingcharacter">console.error</samp><a class="indexanchor" id="i15_55"/>, which allows you to write directly to standard error output without having to go through the <samp class="listingcharacter listingcharacter">process</samp> module. In addition to these two admittedly most important features, the <samp class="listingcharacter listingcharacter">console</samp> object provides numerous other methods, such as <samp class="listingcharacter listingcharacter">console.count</samp>, which provides you with a counter, or <samp class="listingcharacter listingcharacter">console.table</samp>, which you can use to generate tabular output.</p>
        
        
            <h3 class="t3" id="h15.3.2">15.3.2    Input<a class="indexanchor" id="i15_56"/></h3>
            <p class="standard">An application not only consists of outputs but also responds to inputs to adjust the program flow accordingly. There are several possibilities for such an interaction with a command-line application. The easiest way is to use the standard input of the process. Like the output, the input is a data stream—in this case, a readable stream. With the <samp class="listingcharacter listingcharacter">process.stdin</samp><a class="indexanchor" id="i15_57"/> object, you have a reference to the standard input<a class="indexanchor" id="i15_58"/>.</p>
            <p class="standard"><span class="crossreference "><a href="15_003.html#l15.10">Listing 15.10</a></span> contains source code that you can use to accept data via standard input. If you save this source code in a file named <span class="italic">input.js</span>, you can start the example using the <samp class="listingcharacter listingcharacter">node input.js</samp> command. If you enter a character string via the keyboard and confirm the entry with the <span class="keyboard">(Enter)</span> key, the data is passed to the application and written to the standard output.</p>
            <div class="listing " id="l15.10"><pre>process<span class="schwarz">.</span><span class="schwarz">stdin</span><span class="schwarz">.on(</span><span class="hellblau">'data'</span><span class="schwarz">,</span><span class="schwarz"> data </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="schwarz">data</span><span class="schwarz">.toString());</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 15.10</b>    
            Accessing the Standard Input</p>
            <p class="standard">Not only can the standard input be operated using the keyboard, you can also redirect the output of other programs to your Node.js application. This output-input redirection, called <span class="italic">piping</span><a class="indexanchor" id="i15_59"/>, is achieved by connecting two commands with the pipe symbol (<samp class="listingcharacter listingcharacter">|</samp>). On a Unix system, for example, this works with the command chain<a class="indexanchor" id="i15_60"/> <samp class="listingcharacter listingcharacter">echo 'Hello world' | node input.js</samp>. The <samp class="listingcharacter listingcharacter">Hello World</samp> string is written to standard output by the <samp class="listingcharacter listingcharacter">echo</samp> command. This is forwarded by the pipe symbol to the standard input of the subse<a id="p463"/>quent command. In this context, the string is parsed by the Node.js application, and appropriate output is generated.</p>
            <p class="standard">Using the standard input to interact with the user turns out to be quite uncomfortable, especially with guided dialogs as you know them from <samp class="listingcharacter listingcharacter">npm init</samp>, for example. For this reason, Node.js has a second means of user interaction: the <samp class="listingcharacter listingcharacter">readline</samp> module.</p>
        
        
            <h3 class="t3" id="h15.3.3">15.3.3    User Interaction<a class="indexanchor" id="i15_61"/> with the readline<a class="indexanchor" id="i15_62"/> Module</h3>
            <p class="standard">Before you add the <samp class="listingcharacter listingcharacter">readline</samp> module to your application, you’ll first learn how to use the module on the basis of a simple example. <span class="crossreference "><a href="15_003.html#l15.11">Listing 15.11</a></span> contains a code block that ensures the user is asked for their name and then greets them personally.</p>
            <div class="listing " id="l15.11"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> createInterface </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'readline'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> rl </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">createInterface({</span><span class="schwarz"><br/></span>  input<span class="schwarz">:</span><span class="schwarz"> process</span><span class="schwarz">.</span><span class="schwarz">stdin</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  output<span class="schwarz">:</span><span class="schwarz"> process</span><span class="schwarz">.</span><span class="schwarz">stdout</span><span class="schwarz">,</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"><br/></span> <br/>rl<span class="schwarz">.question(</span><span class="schwarz">"What's your name</span><span class="dunkelblau">?</span><span class="schwarz"> "</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">name</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="violett">`Hello ${name}!`</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  rl<span class="schwarz">.close();</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 15.11</b>    
            Personal Greeting to User</p>
            <p class="standard">If you want to use the <samp class="listingcharacter listingcharacter">readline</samp> module, you have to include it first. In this case, you import directly the <samp class="listingcharacter listingcharacter">createInterface</samp> function from the <samp class="listingcharacter listingcharacter">readline</samp> module. To handle the input correctly, you use the <samp class="listingcharacter listingcharacter">createInterface</samp><a class="indexanchor" id="i15_63"/> function to generate an interface that you associate with the standard input and output of the current process. The interface of the <samp class="listingcharacter listingcharacter">rl</samp> object just created implements the <samp class="listingcharacter listingcharacter">question</samp><a class="indexanchor" id="i15_64"/> method, among other things. This method displays the specified string on the console and waits for input. When the input process is completed by pressing the <span class="keyboard">(Enter)</span> key, the callback function you passed as the second argument to the <samp class="listingcharacter listingcharacter">question</samp> method is called with the user’s input. Once you’ve completed all interaction with the user, you must call the <samp class="listingcharacter listingcharacter">rl.close</samp> method to close the interface. If you don’t do that, the application can’t be closed properly because of resources that are still open.</p>
            <p class="standard">The <samp class="listingcharacter listingcharacter">readline</samp> module is a good example of an asynchronous<a class="indexanchor" id="i15_65"/> operation. To sequence multiple questions to the user, you either make another <samp class="listingcharacter listingcharacter">question</samp> call in the callback function of the first method call or use the asynchronous programming capabilities of Node.js. You’ll learn more about this topic in the next chapter. At this point, only so much can be said: You can use a promise object to encapsulate the user’s response. <span class="crossreference "><a href="15_003.html#l15.12">Listing 15.12</a></span><a id="p464"/> contains an extension of <span class="crossreference "><a href="15_003.html#l15.11">Listing 15.11</a></span>. In this case, the user is also asked for their place of residence.</p>
            <div class="listing " id="l15.12"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> createInterface </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'readline'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> rl </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">createInterface({</span><span class="schwarz"><br/></span>  input<span class="schwarz">:</span><span class="schwarz"> process</span><span class="schwarz">.</span><span class="schwarz">stdin</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  output<span class="schwarz">:</span><span class="schwarz"> process</span><span class="schwarz">.</span><span class="schwarz">stdout</span><span class="schwarz">,</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"><br/></span> <br/><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">function</span><span class="schwarz"> promisedQuestion(question) {</span><br/>  <span class="rot">return</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Promise((resolve) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>    rl.question(question, (answer) <span class="dunkelblau">=&gt;</span><span class="schwarz"> resolve(answer));</span><br/>  });<br/>}<br/> <br/><span class="rot">const</span><span class="schwarz"> user </span><span class="dunkelblau">=</span><span class="schwarz"> {</span><br/>  name: <span class="hellblau">''</span><span class="schwarz">,</span><br/>  city: <span class="hellblau">''</span><span class="schwarz">,</span><br/>};<br/> <br/>user.name <span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> promisedQuestion(</span><span class="hellblau">'What'</span><span class="schwarz">s your name</span><span class="dunkelblau">?</span><span class="schwarz"> </span><span class="hellblau">');</span><br/>user.city = await promisedQuestion('<span class="schwarz">Where </span><span class="rot">do</span><span class="schwarz"> you live</span><span class="dunkelblau">?</span><span class="schwarz"> ');</span><br/> <br/><span class="magenta">console</span><span class="schwarz">.log(</span><span class="violett">`Hello ${user.name} from ${user.city}`</span><span class="schwarz">);</span><br/> <br/>rl.close();</samp></span> <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 15.12</b>    
            Asynchronous Combination of User Interactions</p>
            <p class="standard">This special form of sequencing the <samp class="listingcharacter listingcharacter">question</samp><a class="indexanchor" id="i15_66"/> calls becomes necessary because the user is asked for the answers in an asynchronous way. This means that any second <samp class="listingcharacter listingcharacter">question</samp> call that immediately follows the first one is ignored by the process.</p>
            <p class="standard">The core of the implementation in <span class="crossreference "><a href="15_003.html#l15.12">Listing 15.12</a></span> is the <samp class="listingcharacter listingcharacter">promisedQuestion</samp> function. It encapsulates the question <samp class="listingcharacter listingcharacter">method</samp> in a promise object and resolves it once the user has given their input. Using the top-level await feature of Node.js, you can then concatenate the two questions and output the result after answering the second question. At the end of the chain, you also execute the <samp class="listingcharacter listingcharacter">rl.close</samp><a class="indexanchor" id="i15_67"/> method to close the <samp class="listingcharacter listingcharacter">readline</samp> interface and thus terminate the application. If you run the sample code, you get an output like the one shown in <span class="crossreference "><a href="15_003.html#l15.13">Listing 15.13</a></span>.</p>
            <div class="listing " id="l15.13"><pre>$ <span class="bold"><samp class="listingcharacter listingcharacter">node readline.js </samp></span><br/>What's your name? <span class="bold"><samp class="listingcharacter listingcharacter">Basti</samp></span><br/><a id="p465"/>Where do you live? <span class="bold"><samp class="listingcharacter listingcharacter">Munich</samp></span><br/>Hello Basti from Munich </pre></div>
            <p class="caption "><b>Listing 15.13</b>    
            Output of the “readline” Example</p>
            <p class="standard">With this information, you can now extend your Math Trainer implementation to ask the user for the results of the tasks. First, you need to slightly modify the <samp class="listingcharacter listingcharacter">promisedQuestion</samp> function, as you can see in <span class="crossreference "><a href="15_003.html#l15.14">Listing 15.14</a></span>, so that you can use it here as well. Save this implementation in the <span class="italic">lib</span> directory under the name <span class="italic">promisedQuestion.js</span>.</p>
            <div class="listing " id="l15.14"><pre><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">export</span><span class="schwarz"> </span><span class="rot">default</span></samp></span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> promisedQuestion(question, </span><span class="bold"><samp class="listingcharacter listingcharacter">rl</samp></span>) {<br/>  <span class="rot">return</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Promise((resolve) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>    rl.question(question, (answer) <span class="dunkelblau">=&gt;</span><span class="schwarz"> resolve(answer));</span><br/>  });<br/>} <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 15.14</b>    
            Version of the “promisedQuestion” Function Adapted for Math Trainer (lib/promisedQuestion.js)</p>
            <p class="standard">The adjustments to the <samp class="listingcharacter listingcharacter">promisedQuestion</samp> function are limited to passing a reference to the <samp class="listingcharacter listingcharacter">readline</samp> interface as the second parameter and exporting the function.</p>
            <p class="standard">The further adjustments take place in the <span class="italic">index.js</span> file in the <span class="italic">lib</span> directory of the Math Trainer application. The updated version of the file is shown in <span class="crossreference "><a href="15_003.html#l15.15">Listing 15.15</a></span>.</p>
            <div class="listing " id="l15.15"><pre><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> { createInterface } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'readline'</span><span class="schwarz">;</span></samp></span><br/><span class="rot">import</span><span class="schwarz"> createTask </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./task.js'</span><span class="schwarz">;</span><br/><span class="bold"><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> promisedQuestion </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./promisedQuestion.js'</span><span class="schwarz">;</span><br/> </samp></span><br/><span class="rot">const</span><span class="schwarz"> amount </span><span class="dunkelblau">=</span><span class="schwarz"> 4;</span><br/><span class="rot">const</span><span class="schwarz"> level </span><span class="dunkelblau">=</span><span class="schwarz"> 2;</span><br/><span class="rot">const</span><span class="schwarz"> operations </span><span class="dunkelblau">=</span><span class="schwarz"> [</span><span class="hellblau">'+'</span><span class="schwarz">, </span><span class="hellblau">'-'</span><span class="schwarz">, </span><span class="hellblau">'*'</span><span class="schwarz">, </span><span class="hellblau">'/'</span><span class="schwarz">];</span><br/><span class="bold"><samp class="listingcharacter listingcharacter"><span class="rot">const</span><span class="schwarz"> tasks </span><span class="dunkelblau">=</span><span class="schwarz"> [];</span><br/> </samp></span><br/>operations.forEach((operation) <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="rot">for</span><span class="schwarz"> (</span><span class="rot">let</span><span class="schwarz"> i </span><span class="dunkelblau">=</span><span class="schwarz"> 0; i </span><span class="dunkelblau">&lt;</span><span class="schwarz"> amount; i</span><span class="dunkelblau">++</span><span class="schwarz">) {</span><br/>    <span class="bold"><samp class="listingcharacter listingcharacter">tasks.push(createTask(operation, level));</samp></span><br/>  }<br/>});<br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter"><span class="rot">const</span><span class="schwarz"> rl </span><span class="dunkelblau">=</span><span class="schwarz"> createInterface({</span><br/>  input: process.stdin,<br/>  output: process.stdout,<br/>});<br/> <br/><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> question(index) {</span><br/>  <span class="rot">const</span><span class="schwarz"> result </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> promisedQuestion(</span><span class="violett">`${tasks[index].task} = `</span><span class="schwarz">, rl);</span><br/><a id="p466"/>  tasks[index].input <span class="dunkelblau">=</span><span class="schwarz"> parseInt(result);</span><br/>  <span class="rot">if</span><span class="schwarz"> (tasks[index].input </span><span class="dunkelblau">===</span><span class="schwarz"> tasks[index].result) {</span><br/>    <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Correct!'</span><span class="schwarz">);</span><br/>  } <span class="rot">else</span><span class="schwarz"> {</span><br/>    <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Wrong'</span><span class="schwarz">);</span><br/>  }<br/>  <span class="rot">if</span><span class="schwarz"> (</span><span class="dunkelblau">++</span><span class="schwarz">index </span><span class="dunkelblau">&lt;</span><span class="schwarz"> tasks.length) {</span><br/>    question(index);<br/>  } <span class="rot">else</span><span class="schwarz"> {</span><br/>    rl.close();<br/>  }<br/>}<br/> <br/>question(0);</samp></span> <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 15.15</b>    
            Integration of the “readline” Module</p>
            <p class="standard">In the first step, you add the created task objects to the <samp class="listingcharacter listingcharacter">tasks</samp> array, which you’re going to use in the following steps. Then you generate the <samp class="listingcharacter listingcharacter">readline</samp> interface that you can pass to the <samp class="listingcharacter listingcharacter">promisedQuestion</samp> function. The <samp class="listingcharacter listingcharacter">question</samp> function represents the core of the application. It receives the index of the current task and calls itself until all tasks have been displayed to the user.</p>
            <p class="standard">Once the user has entered the solution to a task via the command line, the promise of this question is resolved. Within the callback function, you save the input in the respective task object and then check whether the input was correct. If the task was solved successfully, the user will see the string <samp class="listingcharacter listingcharacter">Correct!</samp>. In the event of an error, the output should read <samp class="listingcharacter listingcharacter">Wrong</samp>. If there are more tasks to solve, you must call the <samp class="listingcharacter listingcharacter">question</samp> function again, or you can terminate the process using the <samp class="listingcharacter listingcharacter">rl.close</samp> method. If you’ve linked the application with <samp class="listingcharacter listingcharacter">npm link</samp>, you can test the implementation via the <samp class="listingcharacter listingcharacter">math-trainer</samp> command and get an output like the one shown in <span class="crossreference "><a href="15_003.html#l15.16">Listing 15.16</a></span>.</p>
            <div class="listing " id="l15.16"><pre><span class="bold"><samp class="listingcharacter listingcharacter">$ math-trainer</samp></span><br/>4 + 68 = 72<br/>Correct!<br/>11 + 4 = 16<br/>Wrong<br/>2 + 24 = </pre></div>
            <p class="caption "><b>Listing 15.16</b>    
            Running Math Trainer</p>
            <p class="standard">In some situations, you may need to limit the interaction with an application to pass options and arguments to enable the automation of an execution. In the following section, you’ll learn how to extend Math Trainer so that you can pass the difficulty level and the number of tasks via options.</p>
        
        
            <h3 class="t3" id="h15.3.4">15.3.4    <a id="p467"/>Options<a class="indexanchor" id="i15_68"/> and Arguments<a class="indexanchor" id="i15_69"/></h3>
            <p class="standard">At the start of this chapter, you saw how a command is structured, that options influence the behavior of a command, and that arguments provide additional information. The <samp class="listingcharacter listingcharacter">argv</samp> property<a class="indexanchor" id="i15_70"/> of the <samp class="listingcharacter listingcharacter">process</samp> module allows you to access the command line of the application. It contains an array that stores the individual components of the command-line command<a class="indexanchor" id="i15_71"/> used to invoke the current process. The first element of the <samp class="listingcharacter listingcharacter">argv</samp> array is the Node.js executable with the full path. The second element is the absolute path<a class="indexanchor" id="i15_72"/> of the executed script, and all other elements map the options and arguments.</p>
            <p class="standard">With this information at hand, you should now make sure that it’s possible to pass the <samp class="listingcharacter listingcharacter">--level=&lt;difficulty level&gt;</samp> and <samp class="listingcharacter listingcharacter">--amount=&lt;number of tasks&gt;</samp> options to the <samp class="listingcharacter listingcharacter">math-trainer</samp> command, which will affect the behavior of the application accordingly. For example, if you call Math Trainer via the <samp class="listingcharacter listingcharacter">math-trainer --level=1 --amount=2</samp> command, the structure of the <samp class="listingcharacter listingcharacter">process.argv</samp> array looks like the one shown in <span class="crossreference "><a href="15_003.html#l15.17">Listing 15.17</a></span>.</p>
            <div class="listing " id="l15.17"><pre><span class="schwarz">[</span><span class="schwarz"> </span><span class="hellblau">' /usr/local/bin/node '</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">'/src/node/bin/math-trainer'</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">'--level=1'</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="hellblau">'--amount=2'</span><span class="schwarz"> </span><span class="schwarz">]</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 15.17</b>    
            Structure of the “process.argv” Array When Calling Math Trainer</p>
            <p class="standard">To solve the task, you write a helper function called <samp class="listingcharacter listingcharacter">getOptions</samp>, which you swap out to a separate <span class="italic">getOptions.js</span> file in the <span class="italic">lib</span> directory. The source code of this file is shown in <span class="crossreference "><a href="15_003.html#l15.18">Listing 15.18</a></span>.</p>
            <div class="listing " id="l15.18"><pre><span class="rot">export</span><span class="schwarz"> </span><span class="rot">default</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">getOptions(</span><span class="schwarz">levelDefault </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">2,</span><span class="schwarz"> amountDefault </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">4)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> level </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">getOptionValue(getOption(</span><span class="hellblau">'level'</span><span class="schwarz">),</span><span class="schwarz"> levelDefault</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> amount </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">getOptionValue(getOption(</span><span class="hellblau">'amount'</span><span class="schwarz">),</span><span class="schwarz"> amountDefault</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="rot">return</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    level<span class="schwarz">,</span><span class="schwarz"><br/></span>    amount<span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="schwarz">};</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span> <br/><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">getOption(</span><span class="schwarz">optionName</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">return</span><span class="schwarz"> process</span><span class="schwarz">.</span><span class="schwarz">argv</span><span class="schwarz">.find((</span><span class="schwarz">element</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> element</span><span class="schwarz">.includes(</span><span class="schwarz">optionName</span><span class="schwarz">));</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span> <br/><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">getOptionValue(</span><span class="schwarz">option</span><span class="schwarz">,</span><span class="schwarz"> defaultValue</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">if</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">option</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">const</span><span class="schwarz"> </span><span class="schwarz">[,</span><span class="schwarz"> </span><span class="magenta">value</span><span class="schwarz">]</span><span class="schwarz"> </span><span class="dunkelblau">=</span><span class="schwarz"> option</span><span class="schwarz">.split(</span><span class="hellblau">'='</span><span class="schwarz">);</span><span class="schwarz"><br/></span>    <span class="rot">return</span><span class="schwarz"> </span><span class="schwarz">parseInt(</span><span class="magenta">value</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">10);</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><a id="p468"/>  <span class="rot">return</span><span class="schwarz"> defaultValue</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 15.18</b>    
            Helper Function “getOptions” (lib/getOptions.js)</p>
            <p class="standard">The helper function itself consists of the <samp class="listingcharacter listingcharacter">getOptions</samp> function, which is made available to the entire application as a <samp class="listingcharacter listingcharacter">default export</samp>. Within it, you extract<a class="indexanchor" id="i15_73"/> both the difficulty level and the number of options from the command line. For both pieces of information, you define default values<a class="indexanchor" id="i15_74"/> in the parameter list of the function in case no value is passed during the call. Because the operations for both pieces of information are the same, you can again swap them out to helper functions. The <samp class="listingcharacter listingcharacter">getOption</samp> function reads the passed option from the command-line array, while the <samp class="listingcharacter listingcharacter">getOptionValue</samp> function receives this information. Using a combination of the <samp class="listingcharacter listingcharacter">split</samp> method, which converts the option into an array, and the destructuring option, which assigns the value after the equal sign to the <samp class="listingcharacter listingcharacter">value</samp> variable, you extract the option value. Note that, at this point, the command line is interpreted as a character string, but your application works with integers. For this reason, you must convert the value to a number using the <samp class="listingcharacter listingcharacter">parseInt</samp> function. It’s also important to note that the functions are called first and only defined afterwards in this example. This works because JavaScript does something called <span class="italic">hoisting</span><a class="indexanchor" id="i15_75"/>. In this context, named functions such as <samp class="listingcharacter listingcharacter">getOption</samp> and <samp class="listingcharacter listingcharacter">getOptionValue</samp> are available in the entire scope, which, in this case, is within the file, no matter where you declare them. The situation is different for function expressions. Here you define a variable and assign a function object to it. Because this isn’t an atomic operation, the variable declaration is echoed, but the assignment isn’t, so you can’t use the function until after the assignment operation.</p>
            <p class="standard">If the user hasn’t specified the option on the command line, the default value is used instead. In the <span class="italic">index.js</span> file, you now include the call of the helper function and can then use your application’s command-line options. The necessary adjustments are shown in <span class="crossreference "><a href="15_003.html#l15.19">Listing 15.19</a></span>.</p>
            <div class="listing " id="l15.19"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> createInterface </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'readline'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> createTask </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./task.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> promisedQuestion </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./promisedQuestion.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> getOptions </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./getOptions.js'</span><span class="schwarz">;</span><br/> <br/><span class="rot">const</span><span class="schwarz"> { amount, level } </span><span class="dunkelblau">=</span><span class="schwarz"> getOptions();</span><br/> </samp></span><br/><span class="rot">const</span><span class="schwarz"> operations </span><span class="dunkelblau">=</span><span class="schwarz"> [</span><span class="hellblau">'+'</span><span class="schwarz">, </span><span class="hellblau">'-'</span><span class="schwarz">, </span><span class="hellblau">'*'</span><span class="schwarz">, </span><span class="hellblau">'/'</span><span class="schwarz">];</span><br/><span class="rot">const</span><span class="schwarz"> tasks </span><span class="dunkelblau">=</span><span class="schwarz"> [];</span><br/> <br/>operations.forEach((operation) <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="rot">for</span><span class="schwarz"> (</span><span class="rot">let</span><span class="schwarz"> i </span><span class="dunkelblau">=</span><span class="schwarz"> 0; i </span><span class="dunkelblau">&lt;</span><span class="schwarz"> amount; i</span><span class="dunkelblau">++</span><span class="schwarz">) {</span><br/>    tasks.push(createTask(operation, level));<br/>  }<br/><a id="p469"/>});<br/> <br/><span class="rot">const</span><span class="schwarz"> rl </span><span class="dunkelblau">=</span><span class="schwarz"> createInterface({</span><br/>  input: process.stdin,<br/>  output: process.stdout,<br/>});<br/> <br/><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> question(index) {</span><br/>  <span class="rot">const</span><span class="schwarz"> result </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> promisedQuestion(</span><span class="violett">`${tasks[index].task} = `</span><span class="schwarz">, rl);</span><br/>  tasks[index].input <span class="dunkelblau">=</span><span class="schwarz"> parseInt(result);</span><br/>  <span class="rot">if</span><span class="schwarz"> (tasks[index].input </span><span class="dunkelblau">===</span><span class="schwarz"> tasks[index].result) {</span><br/>    <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Correct!'</span><span class="schwarz">);</span><br/>  } <span class="rot">else</span><span class="schwarz"> {</span><br/>    <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Wrong'</span><span class="schwarz">);</span><br/>  }<br/>  <span class="rot">if</span><span class="schwarz"> (</span><span class="dunkelblau">++</span><span class="schwarz">index </span><span class="dunkelblau">&lt;</span><span class="schwarz"> tasks.length) {</span><br/>    question(index);<br/>  } <span class="rot">else</span><span class="schwarz"> {</span><br/>    rl.close();<br/>  }<br/>}<br/> <br/>question(0); <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 15.19</b>    
            Integrating the Helper Function “getOptions” (lib/index.js)</p>
            <p class="standard">Instead of assigning the two values in separate statements as before, you can use a destructuring statement at this point to assign the object returned by the <samp class="listingcharacter listingcharacter">getOptions</samp> function directly to the two constants. If you now start your application via the <samp class="listingcharacter listingcharacter">math-trainer --level=1 --amount=1</samp> command, you’ll see a total of four simple tasks.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>