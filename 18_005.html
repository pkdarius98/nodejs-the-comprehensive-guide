<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Streams" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Streams" name="description"/>
            <meta content="en" name="language"/>
            <title>Streams</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h18.5">18.5    Transform Streams<a class="indexanchor" id="i18_77"/></h2>
        <p class="standard">You can think of a transform stream as a link in a chain<a class="indexanchor" id="i18_78"/> between its beginning and end, where you can attach several of these links together. As the name implies, a transform stream is used to transform an input into an output by applying defined rules. In this context, both the input and the output are also streams.</p>
        
            <h3 class="t3" id="h18.5.1">18.5.1    Custom Transform Streams<a class="indexanchor" id="i18_79"/></h3>
            <p class="standard">To implement a transform stream, you must derive your class from the <samp class="listingcharacter listingcharacter">transform</samp> class of the <samp class="listingcharacter listingcharacter">stream</samp> module and implement the <samp class="listingcharacter listingcharacter">_transform</samp> method. At its core, a transform stream represents a simplification of a duplex stream. The <samp class="listingcharacter listingcharacter">transform</samp> class derives from <samp class="listingcharacter listingcharacter">duplex</samp> and combines the readable and writable streams.</p>
            <p class="standard">A concrete example of such a transform stream is as follows: you read the contents of a file, convert all letters to uppercase, and write the result to another file.</p>
            <p class="standard">The <samp class="listingcharacter listingcharacter">_transform</samp><a class="indexanchor" id="i18_80"/> method from <span class="crossreference "><a href="18_005.html#l18.20">Listing 18.20</a></span> has the same signature as the <samp class="listingcharacter listingcharacter">_write</samp> method from the writable stream. The <samp class="listingcharacter listingcharacter">push</samp> method allows you to pass the transformed data record to the subsequent stream. Calling the callback function signals that the data has been completely processed. As an alternative to calling the <samp class="listingcharacter listingcharacter">push</samp> method manually, you can also pass the data to the callback function as the second argument. For the first argument, you can choose the value <samp class="listingcharacter listingcharacter">null</samp>.</p>
            <div class="listing " id="l18.20"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> createReadStream</span><span class="schwarz">,</span><span class="schwarz"> createWriteStream </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'fs'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> Transform </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'stream'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot"><a id="p569"/>const</span><span class="schwarz"> read </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">createReadStream(</span><span class="hellblau">'input.txt'</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="rot">const</span><span class="schwarz"> write </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">createWriteStream(</span><span class="hellblau">'output.txt'</span><span class="schwarz">);</span><span class="schwarz"><br/></span> <br/><span class="rot">class ToUpperCase</span><span class="schwarz"> </span><span class="rot">extends Transform</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="schwarz">_transform(</span><span class="schwarz">chunk</span><span class="schwarz">,</span><span class="schwarz"> encoding</span><span class="schwarz">,</span><span class="schwarz"> callback</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">this</span><span class="schwarz">.push(</span><span class="schwarz">chunk</span><span class="schwarz">.toString().toUpperCase());</span><span class="schwarz"><br/></span>    <span class="schwarz">callback();</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> toUpperCase </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">ToUpperCase();</span><span class="schwarz"><br/></span>read<span class="schwarz">.pipe(</span><span class="schwarz">toUpperCase</span><span class="schwarz">).pipe(</span><span class="schwarz">write</span><span class="schwarz">);</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 18.20</b>    
            ToUpperCase Transform Stream</p>
            <p class="standard">Once you’ve created all three components, that is, the readable stream, the writable stream, and the transform stream, you can link the individual parts by calling the respective <samp class="listingcharacter listingcharacter">pipe</samp> methods<a class="indexanchor" id="i18_81"/>. For the example to work, you need an input file named <span class="italic">input.txt</span>. This file can contain any text. When you then run the script and open the <span class="italic">output.txt</span> containing the result, you’ll see that the entire content is in uppercase.</p>
            <p class="standard">If you still need to execute logic after the transformation, you can implement the <samp class="listingcharacter listingcharacter">_flush</samp> method. This method is called once the data has been processed, but before the <samp class="listingcharacter listingcharacter">end</samp> event gets triggered.</p>
        
        
            <h3 class="t3" id="h18.5.2">18.5.2    Transform Shortcut<a class="indexanchor" id="i18_82"/></h3>
            <p class="standard">As with the other streams, there is a short notation for the transform stream where you call the <samp class="listingcharacter listingcharacter">transform</samp> constructor directly with an object. This object must have a <samp class="listingcharacter listingcharacter">transform</samp> property with a function, which is then used as the <samp class="listingcharacter listingcharacter">_transform</samp> method. The short notation allows you to shorten the source code again.</p>
            <p class="standard"><span class="crossreference "><a href="18_005.html#l18.21">Listing 18.21</a></span> contains only the part with the implementation of the transform stream. The rest of the source code from <span class="crossreference "><a href="18_005.html#l18.20">Listing 18.20</a></span> remains unchanged.</p>
            <div class="listing " id="l18.21"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> createReadStream</span><span class="schwarz">,</span><span class="schwarz"> createWriteStream </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'fs'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> Transform </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'stream'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> read </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">createReadStream(</span><span class="hellblau">'input.txt'</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="rot">const</span><span class="schwarz"> write </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">createWriteStream(</span><span class="hellblau">'output.txt'</span><span class="schwarz">);</span><span class="schwarz"><br/></span> <br/><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">const</span><span class="schwarz"> toUpperCase </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Transform({</span><br/>  transform(chunk, encoding, callback) {<br/>    <span class="rot">this</span><span class="schwarz">.push(chunk.toString().toUpperCase());</span><br/>    callback();<br/><a id="p570"/>  },<br/>});<br/> </samp></span><br/>read.pipe(toUpperCase).pipe(write); <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 18.21</b>    
            Short Notation for Transform Streams</p>
            <p class="standard">With transform streams, you now know the four types of streams available in Node.js. In the following section, you’ll see another example of using streams, namely, with gulp.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>