<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Working with Files" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Working with Files" name="description"/>
            <meta content="en" name="language"/>
            <title>Working with Files</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h19.3">19.3    Reading Files<a class="indexanchor" id="i19_14"/></h2>
        <p class="standard">In Node.js, you have several ways to read the contents of a file. Let’s first take a look at the classic way. With this method, you create a file handle in the first step, use it to read the file, and then close the file handle<a class="indexanchor" id="i19_15"/> again. If you already have experience in programming with other programming languages such as C or PHP, this type of file access will look familiar to you.</p>
        <p class="standard">The use of the different operations that help you to read files will be described in the following sections based on a concrete example. The application is intended to read a configuration file whose content is in JavaScript Object Notation (JSON) format<a class="indexanchor" id="i19_16"/>. You pass the <samp class="listingcharacter listingcharacter">configParser</samp> the environment for which you want to read the configuration and get a corresponding object structure. In <span class="crossreference "><a href="19_003.html#l19.5">Listing 19.5</a></span>, you can see an example of a JSON file to be processed by the application.</p>
        <div class="listing " id="l19.5"><pre><span class="schwarz"><a id="p577"/>{</span><span class="schwarz"><br/></span>  <span class="hellblau">"production"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="hellblau">"user"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"root"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>    <span class="hellblau">"password"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"topSecret"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>    <span class="hellblau">"host"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"localhost"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>    <span class="hellblau">"database"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"mysql"</span><span class="schwarz"><br/></span>  <span class="schwarz">},</span><span class="schwarz"><br/></span>  <span class="hellblau">"development"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="hellblau">"user"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"root"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>    <span class="hellblau">"password"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"secret"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>    <span class="hellblau">"host"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"localost"</span><span class="schwarz">,</span><span class="schwarz"><br/></span>    <span class="hellblau">"database"</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">"sqlite3"</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 19.5</b>    
            Configuration File (config.json)</p>
        <p class="standard"><span class="crossreference "><a href="19_003.html#l19.6">Listing 19.6</a></span> contains the entire the source code for the example. To keep the source code somewhat clearer, we’ll refrain from dealing with any errors that may occur.</p>
        <div class="listing " id="l19.6"><pre><span class="rot">import</span><span class="schwarz"> fs </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'fs'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">const</span><span class="schwarz"> filename </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="hellblau">'config.json'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">configParser(</span><span class="schwarz">env</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">return</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Promise((</span><span class="schwarz">resolve</span><span class="schwarz">,</span><span class="schwarz"> reject</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    fs<span class="schwarz">.open(</span><span class="schwarz">filename</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'r'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">err</span><span class="schwarz">,</span><span class="schwarz"> handle</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>      fs<span class="schwarz">.stat(</span><span class="schwarz">filename</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">err</span><span class="schwarz">,</span><span class="schwarz"> stats</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>        <span class="rot">const</span><span class="schwarz"> size </span><span class="dunkelblau">=</span><span class="schwarz"> stats</span><span class="schwarz">.</span><span class="schwarz">size</span><span class="schwarz">;</span><span class="schwarz"><br/></span>        <span class="rot">const</span><span class="schwarz"> buffer </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new Buffer</span><span class="schwarz">.alloc(</span><span class="schwarz">size</span><span class="schwarz">);</span><span class="schwarz"><br/></span>        fs<span class="schwarz">.read(</span><span class="schwarz">handle</span><span class="schwarz">,</span><span class="schwarz"> buffer</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">0,</span><span class="schwarz"> size</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">0,</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">err</span><span class="schwarz">,</span><span class="schwarz"> bytes</span><span class="schwarz">,</span><span class="schwarz"> content</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>          fs<span class="schwarz">.close(</span><span class="schwarz">handle</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">err</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>            <span class="rot">const</span><span class="schwarz"> config </span><span class="dunkelblau">=</span><span class="schwarz"> JSON</span><span class="schwarz">.parse(</span><span class="schwarz">content</span><span class="schwarz">);</span><span class="schwarz"><br/></span>            <span class="rot">if</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">config</span><span class="schwarz">.hasOwnProperty(</span><span class="schwarz">env</span><span class="schwarz">))</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>              <span class="schwarz">resolve(</span><span class="schwarz">config</span><span class="schwarz">[</span><span class="schwarz">env</span><span class="schwarz">]);</span><span class="schwarz"><br/></span>            <span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">else</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>              <span class="schwarz">reject(</span><span class="violett">`Section ${env} does not exist`</span><span class="schwarz">);</span><span class="schwarz"><br/></span>            <span class="schwarz">}</span><span class="schwarz"><br/></span>          <span class="schwarz">});</span><span class="schwarz"><br/></span>        <span class="schwarz">});</span><span class="schwarz"><br/></span>      <span class="schwarz">});</span><span class="schwarz"><br/></span>    <span class="schwarz">});</span><span class="schwarz"><br/></span>  <span class="schwarz">});</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span> <br/><span class="schwarz">configParser(</span><span class="hellblau">'production'</span><span class="schwarz">).then((</span><span class="schwarz">config</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span><a id="p578"/>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Production: '</span><span class="schwarz">,</span><span class="schwarz"> config</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"><br/></span><span class="schwarz">configParser(</span><span class="hellblau">'development'</span><span class="schwarz">).then((</span><span class="schwarz">config</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Development: '</span><span class="schwarz">,</span><span class="schwarz"> config</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"><br/></span><span class="schwarz">configParser(</span><span class="hellblau">'test'</span><span class="schwarz">).catch((</span><span class="schwarz">e</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="schwarz">e</span><span class="schwarz">);</span><span class="schwarz"><br/></span><span class="schwarz">});</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 19.6</b>    
            Implementation of “configParser” (config-parser.js)</p>
        <p class="standard">Of particular importance in this example are the calls of the <samp class="listingcharacter listingcharacter">open</samp>, <samp class="listingcharacter listingcharacter">stat</samp>, <samp class="listingcharacter listingcharacter">read</samp>, and <samp class="listingcharacter listingcharacter">close</samp> methods provided by the <samp class="listingcharacter listingcharacter">fs</samp> module.</p>
        <p class="standard">All operations in <samp class="listingcharacter listingcharacter">configParser</samp> are asynchronous; to use the function anyway, a promise object<a class="indexanchor" id="i19_17"/> is returned that may contain the result or potential error messages. The <samp class="listingcharacter listingcharacter">configParser</samp> consists of a function that first uses the <samp class="listingcharacter listingcharacter">open</samp> method to create a file handle. The first value accepted by <samp class="listingcharacter listingcharacter">open</samp> is the name of the file to be opened. The second value specifies how the file should be opened; this is referred to as the flag<a class="indexanchor" id="i19_18"/>. Here you have several options to choose from, as shown in <span class="crossreference "><a href="19_003.html#t19.1">Table 19.1</a></span>. Finally, the third argument is the callback function. This function receives as arguments an object containing any existing errors<a class="indexanchor" id="i19_19"/> that occurred during opening and the file handle you can use to access the file.</p>
        <table class="standardtable" id="t19.1">
            <thead>
                <tr>
                    <th class="tablehead tablecell_first top_border_cell">
                        <p class="standard first-item last-item">Flag</p>
                    </th>
                    <th class="tablehead tablecell_last top_border_cell">
                        <p class="standard first-item last-item">Description</p>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="tablecell tablecell_first top_border_cell">
                        <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">r</samp></p>
                    </td>
                    <td class="tablecell tablecell_last top_border_cell">
                        <p class="standard first-item last-item">File opens for <span class="italic">read-only</span> access.</p>
                    </td>
                </tr>
                <tr class="light">
                    <td class="tablecell tablecell_first">
                        <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">r+</samp></p>
                    </td>
                    <td class="tablecell tablecell_last">
                        <p class="standard first-item last-item">File opens for <span class="italic">read</span> and <span class="italic">write</span> access.</p>
                    </td>
                </tr>
                <tr>
                    <td class="tablecell tablecell_first">
                        <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">rs+</samp></p>
                    </td>
                    <td class="tablecell tablecell_last">
                        <p class="standard first-item last-item"><span class="italic">Synchronous write</span> and <span class="italic">read mode.</span></p>
                    </td>
                </tr>
                <tr class="light">
                    <td class="tablecell tablecell_first">
                        <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">w</samp></p>
                    </td>
                    <td class="tablecell tablecell_last">
                        <p class="standard first-item last-item">File opens for <span class="italic">write-only</span> access. File is created or emptied.</p>
                    </td>
                </tr>
                <tr>
                    <td class="tablecell tablecell_first">
                        <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">wx</samp></p>
                    </td>
                    <td class="tablecell tablecell_last">
                        <p class="standard first-item last-item">File opens for <span class="italic">exclusive write</span> access.</p>
                    </td>
                </tr>
                <tr class="light">
                    <td class="tablecell tablecell_first">
                        <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">w+</samp></p>
                    </td>
                    <td class="tablecell tablecell_last">
                        <p class="standard first-item last-item">File opens for <span class="italic">read</span> and <span class="italic">write</span> access. File is created or emptied.</p>
                    </td>
                </tr>
                <tr>
                    <td class="tablecell tablecell_first">
                        <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">wx+</samp></p>
                    </td>
                    <td class="tablecell tablecell_last">
                        <p class="standard first-item last-item">Opens the file as with <samp class="listingcharacter listingcharacter">wx</samp>, but for <span class="italic">exclusive</span> access.</p>
                    </td>
                </tr>
                <tr class="light">
                    <td class="tablecell tablecell_first">
                        <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">a</samp></p>
                    </td>
                    <td class="tablecell tablecell_last">
                        <p class="standard first-item last-item">Opens the file to <span class="italic">append</span> data and creates the file if necessary.</p>
                    </td>
                </tr>
                <tr>
                    <td class="tablecell tablecell_first">
                        <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">ax</samp></p>
                    </td>
                    <td class="tablecell tablecell_last">
                        <p class="standard first-item last-item">Like <samp class="listingcharacter listingcharacter">a</samp>, except that the file opens exclusively.</p>
                    </td>
                </tr>
                <tr class="light">
                    <td class="tablecell tablecell_first">
                        <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">a+</samp></p>
                    </td>
                    <td class="tablecell tablecell_last">
                        <p class="standard first-item last-item">Opens the file to <span class="italic">append</span> data and for <span class="italic">read</span> access.</p>
                    </td>
                </tr>
                <tr>
                    <td class="tablecell tablecell_first">
                        <p class="standard first-item last-item"><samp class="listingcharacter listingcharacter">ax+</samp></p>
                    </td>
                    <td class="tablecell tablecell_last">
                        <p class="standard first-item last-item">Like <samp class="listingcharacter listingcharacter">a+</samp>, but with <span class="italic">exclusive</span> access to the file.</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <p class="caption "><b>Table 19.1</b>    
            Access Flags of the “open” Method</p>
        <p class="standard"><a id="p579"/>Because the requirements for the example only involve the reading of files, it’s sufficient that you open the file with the <samp class="listingcharacter listingcharacter">r</samp> flag for read-only access. You can then use the <samp class="listingcharacter listingcharacter">handle</samp> argument of the callback to access the contents of the file via various methods of the <samp class="listingcharacter listingcharacter">fs</samp> module. However, if you try to write to the file using the <samp class="listingcharacter listingcharacter">write</samp> method inside the callback of the <samp class="listingcharacter listingcharacter">open</samp> method, you’ll receive an error because the file handle isn’t writable.</p>
        <p class="standard">In the next step, another feature of the <samp class="listingcharacter listingcharacter">fs</samp> module comes into play—the <samp class="listingcharacter listingcharacter">stat</samp> method. You need this method to read the information about the configuration file. For this example, you read the file size you’ll need later to properly size the buffer<a class="indexanchor" id="i19_20"/> that will hold the data. The <samp class="listingcharacter listingcharacter">stat</samp> method is again asynchronous, which involves another callback for you in which you have access to the statistics of the file via the second argument. Finally, in the callback of the <samp class="listingcharacter listingcharacter">stat</samp> method, you create a <samp class="listingcharacter listingcharacter">buffer</samp> object to hold the contents of the file. Because <samp class="listingcharacter listingcharacter">buffer</samp> objects can’t grow dynamically, you must specify the size when creating them. The <samp class="listingcharacter listingcharacter">Buffer.alloc</samp> method enables you to create the object. This method requires the size of the <samp class="listingcharacter listingcharacter">buffer</samp> object to be created; you can obtain the value from the <samp class="listingcharacter listingcharacter">size</samp> property of the second argument of the <samp class="listingcharacter listingcharacter">stat</samp> callback.</p>
        <p class="standard">The arguments of the <samp class="listingcharacter listingcharacter">read</samp> method are the handle, the buffer<a class="indexanchor" id="i19_21"/>, and the location in the buffer to start writing to. In your case, this is the number <samp class="listingcharacter listingcharacter">0</samp>, which indicates that the process is to start at the beginning of the buffer. This is followed by the number of bytes to be read. Here you should again use the <samp class="listingcharacter listingcharacter">size</samp> property from the <samp class="listingcharacter listingcharacter">stat</samp> callback. You must also specify the position within the file from which to read. Again, you should use the value <samp class="listingcharacter listingcharacter">0</samp> so the process starts at the beginning of the file. Finally, the last argument is the callback function. It receives three arguments. The first one is the error object, which normally has the value <samp class="listingcharacter listingcharacter">null</samp>. The second one is the number of bytes that were read. Finally, the third and most relevant argument for you is the <samp class="listingcharacter listingcharacter">buffer</samp> object that contains the read content.</p>
        <p class="standard">Within the callback function, error handling<a class="indexanchor" id="i19_22"/> is implemented first. Then the file handle gets closed via the <samp class="listingcharacter listingcharacter">close</samp> method. In the callback function of the <samp class="listingcharacter listingcharacter">close</samp> method, a check is made as to whether the requested configuration section exists, which is then returned via the promise. If no configuration can be found, a corresponding error message is returned.</p>
        <p class="standard">Finally, <samp class="listingcharacter listingcharacter">configParser</samp> is executed for the <samp class="listingcharacter listingcharacter">production</samp>, <samp class="listingcharacter listingcharacter">development</samp>, and <samp class="listingcharacter listingcharacter">test</samp> sections. The first two return the requested data, while the test configuration returns an error message. You can see the result in <span class="crossreference "><a href="19_003.html#l19.7">Listing 19.7</a></span>.</p>
        <div class="listing " id="l19.7"><pre><span class="bold">$ node config-parser.js </span><br/>Development:  { user: 'root',<br/>  password: 'secret',<br/>  host: 'localost',<br/>  database: 'sqlite3' }<br/>Production:  { user: 'root',<br/>  password: 'topSecret',<br/><a id="p580"/>  host: 'localhost',<br/>  database: 'mysql' }<br/>Section test does not exist </pre></div>
        <p class="caption "><b>Listing 19.7</b>    
            “configParser” Output</p>
        <p class="standard">The whole application can be shortened considerably by using only the promise-based <samp class="listingcharacter listingcharacter">readFile</samp><a class="indexanchor" id="i19_23"/> method instead of the combination of <samp class="listingcharacter listingcharacter">open</samp>, <samp class="listingcharacter listingcharacter">stat</samp>, <samp class="listingcharacter listingcharacter">read</samp>, and <samp class="listingcharacter listingcharacter">close</samp>. This method encapsulates all three methods. The consequence for you is that you can use the contents of the callback function you use for the <samp class="listingcharacter listingcharacter">close</samp> method without any changes also in <samp class="listingcharacter listingcharacter">readFile</samp>.</p>
        <p class="standard">As you can see in <span class="crossreference "><a href="19_003.html#l19.8">Listing 19.8</a></span>, all calls of the methods already mentioned are dropped. If you specify the encoding<a class="indexanchor" id="i19_24"/>—in this case<samp class="listingcharacter listingcharacter"> utf-8</samp>—the second argument of the <samp class="listingcharacter listingcharacter">readFile</samp> method is a character string. This allows the original callback function and helper function to be reused. As an alternative to the way shown here, you can also include JSON files directly with <samp class="listingcharacter listingcharacter">require</samp>.</p>
        <div class="listing " id="l19.8"><pre>import { readFile } from 'fs';<br/><br/>const filename = 'config.json';<br/><br/>function configParser(env) {<br/>  <span class="bold">return new Promise((resolve, reject) =&gt; {<br/>    readFile(filename, 'utf-8', (error, content) =&gt; {<br/>      if (error) {<br/>        reject(error);<br/>      } else {<br/>        const config = JSON.parse(content);<br/>        if (config.hasOwnProperty(env)) {<br/>          resolve(config[env]);<br/>        } else {<br/>          reject(`Section ${env} does not exist`);<br/>        }<br/>      }<br/>    });<br/>  });</span><br/>}<br/><br/>configParser('production').then(<br/>  (config) =&gt; {<br/>    console.log('Production: ', config);<br/>  },<br/>  (err) =&gt; console.error(err),<br/>);<br/><a id="p581"/>configParser('development').then(<br/>  (config) =&gt; {<br/>    console.log('Development: ', config);<br/>  },<br/>  (err) =&gt; console.error(err),<br/>);<br/>configParser('test').catch((e) =&gt; {<br/>  console.log(e);<br/>}); </pre></div>
        <p class="caption "><b>Listing 19.8</b>    
            “configParser” with “readFile”</p>
        
            <h3 class="t3" id="h19.3.1">19.3.1    Promise-Based API<a class="indexanchor" id="i19_25"/></h3>
            <p class="standard">The <samp class="listingcharacter listingcharacter">configParser</samp> can also be implemented with the new promise-based API of the file system module. As you can see in <span class="crossreference "><a href="19_003.html#l19.9">Listing 19.9</a></span>, the source code of your application can be further simplified with the combination of promises and async<a class="indexanchor" id="i19_26"/> functions. Apart from that, the methods used remain approximately the same as in <span class="crossreference "><a href="19_003.html#l19.8">Listing 19.8</a></span>.</p>
            <div class="listing " id="l19.9"><pre><span class="bold"><span class="rot">import</span><span class="schwarz"> { readFile } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'fs/promises'</span><span class="schwarz">;</span><br/> </span><br/><span class="rot">const</span><span class="schwarz"> filename </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="hellblau">'config.json'</span><span class="schwarz">;</span><br/> <br/><span class="bold"><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> configParser(env) {</span><br/>  <span class="rot">const</span><span class="schwarz"> content </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> readFile(filename, </span><span class="hellblau">'utf-8'</span><span class="schwarz">);</span><br/>  <span class="rot">const</span><span class="schwarz"> config </span><span class="dunkelblau">=</span><span class="schwarz"> JSON.parse(content);</span><br/>  <span class="rot">if</span><span class="schwarz"> (config.hasOwnProperty(env)) {</span><br/>    <span class="rot">return</span><span class="schwarz"> config[env];</span><br/>  } <span class="rot">else</span><span class="schwarz"> {</span><br/>    <span class="rot">throw</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">Error(</span><span class="violett">`Section ${env} does not exist`</span><span class="schwarz">);</span><br/>  }<br/>}<br/> </span><br/>configParser(<span class="hellblau">'production'</span><span class="schwarz">).then(</span><br/>  (config) <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>    <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Production: '</span><span class="schwarz">, config);</span><br/>  },<br/>  (err) <span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="magenta">console</span><span class="schwarz">.error(err),</span><br/>);<br/>configParser(<span class="hellblau">'development'</span><span class="schwarz">).then(</span><br/>  (config) <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>    <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Development: '</span><span class="schwarz">, config);</span><br/>  },<br/>  (err) <span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="magenta">console</span><span class="schwarz">.error(err),</span><br/>);<br/><a id="p582"/>configParser(<span class="hellblau">'test'</span><span class="schwarz">).catch((e) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="magenta">console</span><span class="schwarz">.log(e);</span><br/>}); <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 19.9</b>    
            “configParser” with “fs/promises”</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>