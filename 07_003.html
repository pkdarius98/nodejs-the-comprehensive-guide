<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Template Engines" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Template Engines" name="description"/>
            <meta content="en" name="language"/>
            <title>Template Engines</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h7.3">7.3    Handlebars<a class="indexanchor" id="i07_56"/></h2>
        <p class="standard">To give you a better idea of working with template engines in Node.js, this chapter covers not only Pug but also Handlebars. The following sections are intended to show you that features similar to those in Pug are available in other template engines and that you’re relatively free to choose which tools you want to use.</p>
        <p class="standard">What is noticeable from the first contact with Handlebars is that the templates are written in HTML and not in a custom markup language<a class="indexanchor" id="i07_57"/>. The advantage of this is that you don’t have to learn a new markup language, but can work directly with the familiar HTML. Furthermore, numerous tools are available for editing HTML that make your work easier. Another difference from Pug is that the core of Handlebars is deliberately kept small, and the template engine itself has relatively little functionality, so it focuses on the essentials, which doesn’t tempt a developer to swap out too much logic to the templates.</p>
        
            <h3 class="t3" id="h7.3.1">7.3.1    <a id="p230"/>Installation<a class="indexanchor" id="i07_58"/></h3>
            <p class="standard">Like Pug, Handlebars is an open-source project maintained in the GitHub repository at <span class="url"><a href="https://github.com/wycats/handlebars.js/">https://github.com/wycats/handlebars.js/</a></span>, and you can install it via npm. The project site with comprehensive documentation and numerous code samples can be found at <span class="url"><a href="https://handlebarsjs.com/">https://handlebarsjs.com/</a></span>. To use Handlebars in your application, you just need to run the <samp class="listingcharacter listingcharacter">npm install handlebars</samp> command. Once you’ve done that, you can include the library using the Node.js module system.</p>
        
        
            <h3 class="t3" id="h7.3.2">7.3.2    Integration with Express<a class="indexanchor" id="i07_59"/></h3>
            <p class="standard">As you already know, a template engine only needs to implement an <samp class="listingcharacter listingcharacter">__express</samp><a class="indexanchor" id="i07_60"/> method to be used with Express. Handlebars doesn’t implement this method directly, but there is a package called <samp class="listingcharacter listingcharacter">express-handlebars</samp><a class="indexanchor" id="i07_61"/> that does it for you. You can install it via npm using the <samp class="listingcharacter listingcharacter">npm install express-handlebars</samp> command. If you use this package, you don’t need to install Handlebars itself because it’s installed as a dependency of <samp class="listingcharacter listingcharacter">express-handlebars</samp>. <span class="crossreference "><a href="07_003.html#l7.19">Listing 7.19</a></span> shows what you need to do to integrate Handlebars into your application instead of Pug.</p>
            <div class="listing " id="l7.19"><pre><span class="rot">import</span><span class="schwarz"> express </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> morgan </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'morgan'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> dirname </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'path'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> fileURLToPath </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'url'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> router </span><span class="rot">as</span><span class="schwarz"> movieRouter </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie/index.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> expressHandlebars </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express-handlebars'</span><span class="schwarz">;</span><br/> </samp></span><br/><span class="rot">const</span><span class="schwarz"> app </span><span class="dunkelblau">=</span><span class="schwarz"> express();</span><br/> <br/><span class="bold"><samp class="listingcharacter listingcharacter">app.engine(<span class="hellblau">'handlebars'</span><span class="schwarz">, expressHandlebars());</span><br/>app.set(<span class="hellblau">'view engine'</span><span class="schwarz">, </span><span class="hellblau">'handlebars'</span><span class="schwarz">);</span><br/>app.set(<span class="hellblau">'views'</span><span class="schwarz">, [</span><span class="violett">`${dirname(fileURLToPath(import.meta.url))}/views/list`</span><span class="schwarz">]);</span><br/> </samp></span><br/>app.use(express.static(<span class="violett">`${dirname(fileURLToPath(import.meta.url))}/public`</span><span class="schwarz">));</span><br/> <br/>app.use(morgan(<span class="hellblau">'common'</span><span class="schwarz">, { immediate: </span><span class="rot">true</span><span class="schwarz"> }));</span><br/> <br/>app.use(express.urlencoded({ extended: <span class="rot">false</span><span class="schwarz"> }));</span><br/> <br/>app.use(<span class="hellblau">'/movie'</span><span class="schwarz">, movieRouter);</span><br/> <br/>app.get(<span class="hellblau">'/'</span><span class="schwarz">, (request, response) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> response.redirect(</span><span class="hellblau">'/movie'</span><span class="schwarz">));</span><br/> <br/>app.listen(8080, () <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Server is listening to http://localhost:8080'</span><span class="schwarz">);</span><br/>}); <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 7.19</b>    
            Including Handlebars in Express (index.js)</p>
            <p class="standard"><a id="p231"/>With <samp class="listingcharacter listingcharacter">app.engine</samp>, you register the <samp class="listingcharacter listingcharacter">express-handlebars</samp> function, that is, the actual template engine with Express. You then use the <samp class="listingcharacter listingcharacter">app.set</samp> method and the <samp class="listingcharacter listingcharacter">view engine</samp> value to set <samp class="listingcharacter listingcharacter">express-handlebars</samp> as the template engine for the <samp class="listingcharacter listingcharacter">render</samp> calls of Express. Finally, the <samp class="listingcharacter listingcharacter">app.set</samp> call with <samp class="listingcharacter listingcharacter">views</samp> tells <samp class="listingcharacter listingcharacter">express-handlebars</samp> to look for templates in the <span class="italic">movie/views</span> directory.</p>
            <p class="standard">When used in Express, Handlebars is hardly different from Pug. However, you should note that <samp class="listingcharacter listingcharacter">express-handlebars</samp> accepts files with the extension <span class="italic">.handlebars</span> as templates by default. This behavior can be customized, if necessary, with the <samp class="listingcharacter listingcharacter">extname</samp><a class="indexanchor" id="i07_62"/> configuration directive that you pass to the <samp class="listingcharacter listingcharacter">express-handlebars</samp> function. Initially, as with Pug, you display only one record. This means that you also need to adjust the controller slightly.</p>
            <p class="standard">As you can see in <span class="crossreference "><a href="07_003.html#l7.20">Listing 7.20</a></span>, the <samp class="listingcharacter listingcharacter">render</samp> method behaves similarly to Pug when using Handlebars. You pass the name of the template and an object to fill the placeholders<a class="indexanchor" id="i07_63"/>.<a class="indexanchor" id="i07_64"/> <samp class="listingcharacter listingcharacter">express-handlebars</samp> finds the <span class="italic">list.handlebars</span> file in the <span class="italic">movie/views</span> directory by specifying the <samp class="listingcharacter listingcharacter">list</samp> template.</p>
            <div class="listing " id="l7.20"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> getAll</span><span class="schwarz">,</span><span class="schwarz"> remove</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">get</span><span class="schwarz">,</span><span class="schwarz"> save </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./model.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> render </span><span class="rot">as</span><span class="schwarz"> form </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./form.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">listAction(</span><span class="schwarz">request</span><span class="schwarz">,</span><span class="schwarz"> response</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> movies </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> </span><span class="schwarz">getAll();</span><span class="schwarz"><br/></span>  <span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">response.render(<span class="hellblau">'list'</span><span class="schwarz">, { </span><br/>    layout: <span class="rot">false</span><span class="schwarz">, </span><br/>    movie: movies[0] <br/>  });</samp></span><br/>}<br/>... <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 7.20</b>    
            Customizing the Controller (movie/controller.js)</p>
            <p class="standard">As the second argument, you pass an object that contains both the values for the placeholders in the template and additional configuration. For example, the <samp class="listingcharacter listingcharacter">layout: false</samp> option tells Handlebars not to use the default template. You can find the code of the template in <span class="crossreference "><a href="07_003.html#l7.21">Listing 7.21</a></span>.</p>
            <div class="listing " id="l7.21"><pre><span class="dunkelblau">&lt;!DOCTYPE html&gt;</span><span class="schwarz"><br/></span><br/><span class="dunkelblau">&lt;html&gt;</span><span class="schwarz"/><br/><br/><span class="dunkelblau">&lt;head&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;title&gt;</span><span class="schwarz">Handlebars example</span><span class="dunkelblau">&lt;/title&gt;</span><span class="schwarz"/><br/><span class="dunkelblau">&lt;/head&gt;</span><span class="schwarz"/><br/><br/><span class="dunkelblau">&lt;body&gt;</span><span class="schwarz"/><br/><a id="p232"/>  <span class="dunkelblau">&lt;table&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;thead&gt;</span><span class="schwarz"/><br/>      <span class="dunkelblau">&lt;tr&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;th&gt;</span><span class="schwarz">Id</span><span class="dunkelblau">&lt;/th&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;th&gt;</span><span class="schwarz">Title</span><span class="dunkelblau">&lt;/th&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;th&gt;</span><span class="schwarz">Year</span><span class="dunkelblau">&lt;/th&gt;</span><span class="schwarz"/><br/>      <span class="dunkelblau">&lt;/tr&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;/thead&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;tbody&gt;</span><span class="schwarz"/><br/>      <span class="dunkelblau">&lt;tr&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;td&gt;</span><span class="schwarz">{{movie.id}}</span><span class="dunkelblau">&lt;/td&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;td&gt;</span><span class="schwarz">{{movie.title}}</span><span class="dunkelblau">&lt;/td&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;td&gt;</span><span class="schwarz">{{movie.year}}</span><span class="dunkelblau">&lt;/td&gt;</span><span class="schwarz"/><br/>      <span class="dunkelblau">&lt;/tr&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;/tbody&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;/table&gt;</span><span class="schwarz"/><br/><span class="dunkelblau">&lt;/body&gt;</span><span class="schwarz"/><br/><br/><span class="dunkelblau">&lt;/html&gt;</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 7.21</b>    
            Handlebars Template (movie/views/list.handlebars)</p>
            <p class="standard">When you start your server process after these adjustments and access the URL <span class="italic">http://localhost:8080</span>, you’ll get the familiar list view as a result.</p>
            <p class="standard">The variables in Handlebars are enclosed in double curly brackets<a class="indexanchor" id="i07_65"/>. The replaced values are escaped for security reasons, so that no attacks can occur against the users of your application. If you want to prevent escaping, you must use triple curly brackets instead of double ones.</p>
        
        
            <h3 class="t3" id="h7.3.3">7.3.3    Conditions<a class="indexanchor" id="i07_66"/> and Loops<a class="indexanchor" id="i07_67"/></h3>
            <p class="standard">You can extend the functionality of Handlebars using helpers<a class="indexanchor" id="i07_68"/>, which are functions you can execute from within your templates. Some of the most important helpers form an integral part of Handlebars, such as the <samp class="listingcharacter listingcharacter">each</samp> helper, which allows you to iterate<a class="indexanchor" id="i07_69"/> over data structures. You should now reset your controller to its original state, as shown in <span class="crossreference "><a href="07_003.html#l7.22">Listing 7.22</a></span>, so that it passes the entire array of movie objects to the template, and all the data displays again.</p>
            <div class="listing " id="l7.22"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> getAll</span><span class="schwarz">,</span><span class="schwarz"> remove</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">get</span><span class="schwarz">,</span><span class="schwarz"> save </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./model.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> render </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./view.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> render </span><span class="rot">as</span><span class="schwarz"> form </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./form.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">listAction(</span><span class="schwarz">request</span><span class="schwarz">,</span><span class="schwarz"> response</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> movies </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> </span><span class="schwarz">getAll();</span><span class="schwarz"><br/></span><a id="p233"/>  <span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">response.render(<span class="hellblau">'list'</span><span class="schwarz">, { layout: </span><span class="rot">false</span><span class="schwarz">, movies });</span></samp></span><br/>}<br/>... <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 7.22</b>    
            Customization on the Controller (movie/controller.js)</p>
            <p class="standard">You address the <samp class="listingcharacter listingcharacter">each</samp> helper via the <samp class="listingcharacter listingcharacter">each</samp> keyword, as shown in <span class="crossreference "><a href="07_003.html#l7.23">Listing 7.23</a></span>.</p>
            <div class="listing " id="l7.23"><pre><span class="dunkelblau">&lt;!DOCTYPE html&gt;</span><span class="schwarz"><br/></span><br/><span class="dunkelblau">&lt;html&gt;</span><span class="schwarz"/><br/><br/><span class="dunkelblau">&lt;head&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;title&gt;</span><span class="schwarz">Handlebars example</span><span class="dunkelblau">&lt;/title&gt;</span><span class="schwarz"/><br/><span class="dunkelblau">&lt;/head&gt;</span><span class="schwarz"/><br/><br/><span class="dunkelblau">&lt;body&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;table&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;thead&gt;</span><span class="schwarz"/><br/>      <span class="dunkelblau">&lt;tr&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;th&gt;</span><span class="schwarz">Id</span><span class="dunkelblau">&lt;/th&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;th&gt;</span><span class="schwarz">Title</span><span class="dunkelblau">&lt;/th&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;th&gt;</span><span class="schwarz">Year</span><span class="dunkelblau">&lt;/th&gt;</span><span class="schwarz"/><br/>      <span class="dunkelblau">&lt;/tr&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;/thead&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;tbody&gt;</span><span class="schwarz"/><br/>      {<span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">{#each movies}}<br/>      <span class="dunkelblau">&lt;tr&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;td&gt;</span><span class="schwarz">{{this.id}}</span><span class="dunkelblau">&lt;/td&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;td&gt;</span><span class="schwarz">{{this.title}}</span><span class="dunkelblau">&lt;/td&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;td&gt;</span><span class="schwarz">{{this.year}}</span><span class="dunkelblau">&lt;/td&gt;</span><span class="schwarz"/><br/>      <span class="dunkelblau">&lt;/tr&gt;</span><span class="schwarz"/><br/>      {{/each}}</samp></span><br/>    <span class="dunkelblau">&lt;/tbody&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;/table&gt;</span><span class="schwarz"/><br/><span class="dunkelblau">&lt;/body&gt;</span><span class="schwarz"/><br/><br/><span class="dunkelblau">&lt;/html&gt;</span><span class="schwarz"> </span><span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 7.23</b>    
            Iterations in Handlebars (movie/views/list.handlebars)</p>
            <p class="standard">Like the variables, the helper is enclosed in double curly brackets and is preceded by a <samp class="listingcharacter listingcharacter">#</samp> character. Then follow the name of the helper—in this case, it’s the keyword <samp class="listingcharacter listingcharacter">each</samp>—and finally other options such as the data structure to iterate over. The <samp class="listingcharacter listingcharacter">this</samp> keyword provides access to the respective active element within the iteration, which you can then output. <a id="p234"/>In addition to the <samp class="listingcharacter listingcharacter">each</samp> helper, you can use the <samp class="listingcharacter listingcharacter">if</samp> helper to formulate conditions within your templates, for example. For a list of other helpers, visit <span class="url"><a href="https://handlebarsjs.com/guide/builtin-helpers.html">https://handlebarsjs.com/guide/builtin-helpers.html</a></span>.</p>
        
        
            <h3 class="t3" id="h7.3.4">7.3.4    Partials<a class="indexanchor" id="i07_70"/></h3>
            <p class="standard">A concept you already know from Pug’s includes are partials, that is, parts of templates you can reuse in several places in your application. In Handlebars, you register the partials via the <samp class="listingcharacter listingcharacter">registerPartial</samp><a class="indexanchor" id="i07_71"/> method in the JavaScript code and then access them from your template. In <samp class="listingcharacter listingcharacter">express-handlebars</samp>, you can either store your partials in a directory so that <samp class="listingcharacter listingcharacter">express-handlebars</samp> automatically finds and registers them, or you can perform the registration manually. We’ll use this manual registration for the list entries of the film database. For this purpose, you first need a template for the partial. You can find the source code in <span class="crossreference "><a href="07_003.html#l7.24">Listing 7.24</a></span>.</p>
            <div class="listing " id="l7.24"><pre><span class="dunkelblau">&lt;tr&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;td&gt;</span><span class="schwarz">{{this.id}}</span><span class="dunkelblau">&lt;/td&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;td&gt;</span><span class="schwarz">{{this.title}}</span><span class="dunkelblau">&lt;/td&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;td&gt;</span><span class="schwarz">{{this.year}}</span><span class="dunkelblau">&lt;/td&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;td&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;a </span><span class="magenta">href=</span><span class="hellblau">"/movie/delete/{{this.id}}"</span><span class="dunkelblau">&gt;</span><span class="schwarz">delete</span><span class="dunkelblau">&lt;/a&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;/td&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;td&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;a </span><span class="magenta">href=</span><span class="hellblau">"/movie/form/{{this.id}}"</span><span class="dunkelblau">&gt;</span><span class="schwarz">edit</span><span class="dunkelblau">&lt;/a&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;/td&gt;</span><span class="schwarz"/><br/><span class="dunkelblau">&lt;/tr&gt;</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 7.24</b>    
            Partial Template (movie/views/list-item.handlebars)</p>
            <p class="standard">When implementing the partial template<a class="indexanchor" id="i07_72"/>, you assume that it will be used within the <samp class="listingcharacter listingcharacter">each</samp> helper. For this reason, you also use the <samp class="listingcharacter listingcharacter">this</samp> keyword here to access the information of the <samp class="listingcharacter listingcharacter">movie</samp> object. The integration in the controller is a bit more complex than with Pug, as you can see in <span class="crossreference "><a href="07_003.html#l7.25">Listing 7.25</a></span>.</p>
            <div class="listing " id="l7.25"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> getAll</span><span class="schwarz">,</span><span class="schwarz"> remove</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="rot">get</span><span class="schwarz">,</span><span class="schwarz"> save </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./model.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> render </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./view.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> render </span><span class="rot">as</span><span class="schwarz"> form </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./form.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> handlebars </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'handlebars'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { readFileSync } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'fs'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { dirname } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'path'</span><span class="schwarz">;</span><br/><span class="rot">import</span><span class="schwarz"> { fileURLToPath } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'url'</span><span class="schwarz">;</span><br/> <br/><span class="rot">const</span><span class="schwarz"> listItem </span><span class="dunkelblau">=</span><span class="schwarz"> handlebars.compile(</span><br/>  readFileSync(<br/>    <span class="violett">`${dirname(fileURLToPath(import.meta.url))}/views/list-item.handlebars`</span><span class="schwarz">,</span><br/><a id="p235"/>    <span class="hellblau">'utf-8'</span><span class="schwarz">,</span><br/>  ),<br/>);<br/> </samp></span><br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> listAction(request, response) {</span><br/>  <span class="rot">const</span><span class="schwarz"> movies </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> getAll();</span><br/>  <span class="bold"><samp class="listingcharacter listingcharacter">response.render(<span class="hellblau">'list'</span><span class="schwarz">, { layout: </span><span class="rot">false</span><span class="schwarz">, movies, partials: { listItem } });</span></samp></span><br/>} <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 7.25</b>    
            Using Handlebars Partials in Express (movie/controller.js)</p>
            <p class="standard">In preparation for using the partial, you must first prepare it separately from the <samp class="listingcharacter listingcharacter">listAction</samp> function by reading the partial file <span class="italic">list-item.handlebars</span> with the <samp class="listingcharacter listingcharacter">readFileSync</samp> function of the <samp class="listingcharacter listingcharacter">fs</samp> module. You then compile the contents of the file using the <samp class="listingcharacter listingcharacter">compile</samp> function of Handlebars and get the compiled partial as the result, which you can then continue to use. The advantage of this procedure is that the template doesn’t have to be read and compiled again each time <samp class="listingcharacter listingcharacter">listAction</samp> is called, but only once at the start of the server process.</p>
            <p class="standard">In the controller, you also pass the name of the template and an option object to the <samp class="listingcharacter listingcharacter">render</samp> method, as before. This method receives a reference to the movie list in the form of the <samp class="listingcharacter listingcharacter">movies</samp> variable, the <samp class="listingcharacter listingcharacter">layout</samp> property, and a <samp class="listingcharacter listingcharacter">partials</samp><a class="indexanchor" id="i07_73"/> property. Here, the partials are registered on the <samp class="listingcharacter listingcharacter">render</samp> level. You then pass the previously compiled partial from under the name <samp class="listingcharacter listingcharacter">listItem</samp>. Finally, the use of the partial template takes place in the list template. <span class="crossreference "><a href="07_003.html#l7.26">Listing 7.26</a></span> shows the necessary adjustments.</p>
            <div class="listing " id="l7.26"><pre><span class="dunkelblau">&lt;!DOCTYPE html&gt;</span><span class="schwarz"><br/></span><br/><span class="dunkelblau">&lt;html&gt;</span><span class="schwarz"/><br/><br/><span class="dunkelblau">&lt;head&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;title&gt;</span><span class="schwarz">Handlebars example</span><span class="dunkelblau">&lt;/title&gt;</span><span class="schwarz"/><br/><span class="dunkelblau">&lt;/head&gt;</span><span class="schwarz"/><br/><br/><span class="dunkelblau">&lt;body&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;table&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;thead&gt;</span><span class="schwarz"/><br/>      <span class="dunkelblau">&lt;tr&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;th&gt;</span><span class="schwarz">Id</span><span class="dunkelblau">&lt;/th&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;th&gt;</span><span class="schwarz">Title</span><span class="dunkelblau">&lt;/th&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;th&gt;</span><span class="schwarz">Year</span><span class="dunkelblau">&lt;/th&gt;</span><span class="schwarz"/><br/>      <span class="dunkelblau">&lt;/tr&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;/thead&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;tbody&gt;</span><span class="schwarz"/><br/>      <span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">{{#each movies}} {{&gt;listItem}} {{/each}}</samp></span><br/><a id="p236"/>    <span class="dunkelblau">&lt;/tbody&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;/table&gt;</span><span class="schwarz"/><br/><span class="dunkelblau">&lt;/body&gt;</span><span class="schwarz"> </span><span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 7.26</b>    
            Integration (movie/views/list.handlebars)</p>
            <p class="standard">As you can see, you access the respective partial template via <samp class="listingcharacter listingcharacter">{{&gt;</samp> followed by the name of the partial. From the partial, you have access to all variables that are also available to you in the template itself. You can also parameterize a partial by assigning a value to an internal placeholder inside the curly brackets.</p>
        
        
            <h3 class="t3" id="h7.3.5">7.3.5    Custom Helpers<a class="indexanchor" id="i07_74"/></h3>
            <p class="standard">In addition to the provided helpers, you can define your own helpers and use them in Handlebars. These are functions you can call from within the template. In <span class="crossreference "><a href="07_003.html#l7.27">Listing 7.27</a></span>, you create a custom helper named <samp class="listingcharacter listingcharacter">uc</samp> that converts a passed string to uppercase.</p>
            <div class="listing " id="l7.27"><pre><span class="rot">import</span><span class="schwarz"> express </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> morgan </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'morgan'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> dirname </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'path'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> fileURLToPath </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'url'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> router </span><span class="rot">as</span><span class="schwarz"> movieRouter </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./movie/index.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> expressHandlebars </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'express-handlebars'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> app </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">express();</span><span class="schwarz"><br/></span> <br/>app<span class="schwarz">.engine(</span><span class="schwarz"><br/></span>  <span class="hellblau">'handlebars'</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">expressHandlebars({<br/>    helpers: {<br/>      uc: (data) <span class="dunkelblau">=&gt;</span><span class="schwarz"> data.toUpperCase(),</span><br/>    },<br/>  }),</samp></span><br/>);<br/>app.set(<span class="hellblau">'view engine'</span><span class="schwarz">, </span><span class="hellblau">'handlebars'</span><span class="schwarz">);</span><br/>app.set(<span class="hellblau">'views'</span><span class="schwarz">, [</span><span class="violett">`${dirname(fileURLToPath(import.meta.url))}/movie/views`</span><span class="schwarz">]);</span><br/> <br/>app.use(express.static(<span class="violett">`${dirname(fileURLToPath(import.meta.url))}/public`</span><span class="schwarz">));</span><br/> <br/>app.use(morgan(<span class="hellblau">'common'</span><span class="schwarz">, { immediate: </span><span class="rot">true</span><span class="schwarz"> }));</span><br/> <br/>app.use(express.urlencoded({ extended: <span class="rot">false</span><span class="schwarz"> }));</span><br/> <br/>app.use(<span class="hellblau">'/movie'</span><span class="schwarz">, movieRouter);</span><br/> <br/><a id="p237"/>app.get(<span class="hellblau">'/'</span><span class="schwarz">, (request, response) </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> response.redirect(</span><span class="hellblau">'/movie'</span><span class="schwarz">));</span><br/> <br/>app.listen(8080, () <span class="dunkelblau">=&gt;</span><span class="schwarz"> {</span><br/>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Server is listening to http://localhost:8080'</span><span class="schwarz">);</span><br/>}); <span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 7.27</b>    
            Custom Helper in Handlebars (index.js)</p>
            <p class="standard">Similar to partials, helpers are registered<a class="indexanchor" id="i07_75"/> either when the <samp class="listingcharacter listingcharacter">render</samp> method is called or, as in this case, globally, when <samp class="listingcharacter listingcharacter">express-handlebars</samp> is initialized. You can use the helper after registering it in your template by listing the name in double curly brackets before the variable to be output. In <span class="crossreference "><a href="07_003.html#l7.28">Listing 7.28</a></span>, you use the <samp class="listingcharacter listingcharacter">uc</samp> helper to output the column headers in uppercase letters.</p>
            <div class="listing " id="l7.28"><pre><span class="dunkelblau">&lt;!DOCTYPE html&gt;</span><span class="schwarz"><br/></span><br/><span class="dunkelblau">&lt;html&gt;</span><span class="schwarz"/><br/><span class="dunkelblau">&lt;head&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;title&gt;</span><span class="schwarz">Handlebars example</span><span class="dunkelblau">&lt;/title&gt;</span><span class="schwarz"/><br/><span class="dunkelblau">&lt;/head&gt;</span><span class="schwarz"/><br/><br/><span class="dunkelblau">&lt;body&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;table&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;thead&gt;</span><span class="schwarz"/><br/>      <span class="dunkelblau">&lt;tr&gt;</span><span class="schwarz"/><br/>         <span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="dunkelblau">&lt;th&gt;</span><span class="schwarz">{{uc 'Id' }}</span><span class="dunkelblau">&lt;/th&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;th&gt;</span><span class="schwarz">{{uc 'Title'}}</span><span class="dunkelblau">&lt;/th&gt;</span><span class="schwarz"/><br/>        <span class="dunkelblau">&lt;th&gt;</span><span class="schwarz">{{uc 'Year'}}</span><span class="dunkelblau">&lt;/th&gt;</span><span class="schwarz"/></samp></span><br/>      <span class="dunkelblau">&lt;/tr&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;/thead&gt;</span><span class="schwarz"/><br/>    <span class="dunkelblau">&lt;tbody&gt;</span><span class="schwarz"/><br/>      {{#each movies}} {{&gt;listItem}} {{/each}}<br/>    <span class="dunkelblau">&lt;/tbody&gt;</span><span class="schwarz"/><br/>  <span class="dunkelblau">&lt;/table&gt;</span><span class="schwarz"/><br/><span class="dunkelblau">&lt;/body&gt;</span><span class="schwarz"/><br/><br/><span class="dunkelblau">&lt;/html&gt;</span><span class="schwarz"> </span><span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 7.28</b>    
            Using the “uc” Helper (movie/views/list.handlebars)</p>
            <p class="standard">If you don’t use <samp class="listingcharacter listingcharacter">express-handlebars</samp>, you must register your helpers using the <samp class="listingcharacter listingcharacter">registerHelper</samp> method of Handlebars. This method receives the name of the helper and a callback function.</p>
        
        
            <h3 class="t3" id="h7.3.6">7.3.6    <a id="p238"/>Handlebars without Express<a class="indexanchor" id="i07_76"/></h3>
            <p class="standard">For Handlebars, the same applies as for Pug. You can also use the template engine separately from Express. To do this, you must first install the package via <samp class="listingcharacter listingcharacter">npm install handlebars</samp>. You can then use it in the context of a web server, for example. In <span class="crossreference "><a href="07_003.html#l7.29">Listing 7.29</a></span>, you create a web server that returns a rendered Handlebars template.</p>
            <div class="listing " id="l7.29"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> createServer </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'http'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> readFile </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'fs'</span><span class="schwarz">;</span><span class="schwarz"><br/></span><span class="rot">import</span><span class="schwarz"> hbs </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'handlebars'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="schwarz">createServer((</span><span class="schwarz">req</span><span class="schwarz">,</span><span class="schwarz"> res</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="schwarz">readFile(</span><span class="hellblau">'templates/index.hbs'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="hellblau">'utf-8'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">err</span><span class="schwarz">,</span><span class="schwarz"> data</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">const</span><span class="schwarz"> template </span><span class="dunkelblau">=</span><span class="schwarz"> hbs</span><span class="schwarz">.compile(</span><span class="schwarz">data</span><span class="schwarz">);</span><span class="schwarz"><br/></span>    <span class="rot">const</span><span class="schwarz"> result </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">template({</span><span class="schwarz"> name</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'Handlebars'</span><span class="schwarz"> </span><span class="schwarz">});</span><span class="schwarz"><br/></span>    res<span class="schwarz">.end(</span><span class="schwarz">result</span><span class="schwarz">);</span><span class="schwarz"><br/></span>  <span class="schwarz">});</span><span class="schwarz"><br/></span><span class="schwarz">}).listen(8080);</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 7.29</b>    
            Rendering Templates with Handlebars (index.js)</p>
            <p class="standard"><span class="crossreference "><a href="07_003.html#l7.29">Listing 7.29</a></span> shows how you can process a template with Handlebars. First you need to import the Handlebars package. After that, you need the template as a character string. Again, you shouldn’t place your templates directly in the JavaScript source code, but rather swap them out to a separate file. The source code of the template for this example is shown in <span class="crossreference "><a href="07_003.html#l7.30">Listing 7.30</a></span>, and you save it in the <span class="italic">templates</span> directory in the <span class="italic">index.hbs</span> file.</p>
            <div class="listing " id="l7.30"><pre><span class="dunkelblau">&lt;!</span><span class="schwarz">DOCTYPE html</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span><span class="dunkelblau">&lt;</span><span class="schwarz">html lang</span><span class="dunkelblau">=</span><span class="hellblau">"en"</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span><span class="dunkelblau">&lt;</span><span class="schwarz">head</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span>  <span class="dunkelblau">&lt;</span><span class="schwarz">meta charset</span><span class="dunkelblau">=</span><span class="hellblau">"UTF-8"</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span>  <span class="dunkelblau">&lt;</span><span class="schwarz">meta http</span><span class="dunkelblau">-</span><span class="schwarz">equiv</span><span class="dunkelblau">=</span><span class="hellblau">"X-UA-Compatible"</span><span class="schwarz"> content</span><span class="dunkelblau">=</span><span class="hellblau">"IE=edge"</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span>  <span class="dunkelblau">&lt;</span><span class="schwarz">meta name</span><span class="dunkelblau">=</span><span class="hellblau">"viewport"</span><span class="schwarz"> content</span><span class="dunkelblau">=</span><span class="hellblau">"width=device-width, initial-scale=1.0"</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span>  <span class="dunkelblau">&lt;</span><span class="schwarz">title</span><span class="dunkelblau">&gt;</span><span class="schwarz">Document</span><span class="dunkelblau">&lt;/</span><span class="schwarz">title</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span><span class="dunkelblau">&lt;/</span><span class="schwarz">head</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span><span class="dunkelblau">&lt;</span><span class="schwarz">body</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span>  <span class="dunkelblau">&lt;</span><span class="schwarz">h1</span><span class="dunkelblau">&gt;</span><span class="schwarz">Hallo </span><span class="schwarz">{{</span><span class="schwarz">name</span><span class="schwarz">}}</span><span class="dunkelblau">&lt;/</span><span class="schwarz">h1</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span><span class="dunkelblau">&lt;/</span><span class="schwarz">body</span><span class="dunkelblau">&gt;</span><span class="schwarz"><br/></span><span class="dunkelblau">&lt;/</span><span class="schwarz">html</span><span class="dunkelblau">&gt;</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 7.30</b>    
            Template File in Handlebars (template/index.hbs)</p>
            <p class="standard">The process of template processing consists of two steps, as was the case with Pug. First, you must prepare the template by passing it to the <samp class="listingcharacter listingcharacter">compile</samp><a class="indexanchor" id="i07_77"/> method. In the second step, you execute the resulting template function and pass it the placeholders to be inserted <a id="p239"/>into the template. The result of this operation is a character string containing the finished HTML.</p>
            <p class="standard">With Handlebars and Pug, you now know two of the most popular template engines for Node.js and should have an idea of their features and areas of use. This knowledge can be applied to most other template engines because they all work in a similar way.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>