<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
                    
        <head><meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
            <meta content="application/xhtml+xml; charset=utf-8" name="content-type"/>
            <meta content="Deno" name="title"/>
            <meta content="Sebastian Springer" name="author"/>
            <meta content="Rheinwerk Publishing" name="publisher"/>
            <meta content="© 2022 by Rheinwerk Publishing Inc., Boston (MA)" name="copyright"/>
            <meta content="Node.js - The Comprehensive Guide - Deno" name="description"/>
            <meta content="en" name="language"/>
            <title>Deno</title>
            <link href="common/main.css" rel="stylesheet" type="text/css"/>
<meta content="urn:uuid:e0000000-0000-0000-0000-000029756394" name="Adept.expected.resource"/>
        </head>
    


                    <body class="office_us type_kapitel">
                        <div id="main">
        <h2 class="t2" id="h28.6">28.6    Module System<a class="indexanchor" id="i28_49"/></h2>
        <p class="standard">Like the recent versions of Node.js, Deno uses the ECMAScript module system, that is, the <samp class="listingcharacter listingcharacter">import</samp><a class="indexanchor" id="i28_50"/> and <samp class="listingcharacter listingcharacter">export</samp><a class="indexanchor" id="i28_51"/> keywords. For a better description of the module system, let’s return to our example of copying a file and recapitulate. We implemented the two <a id="p805"/>functions <samp class="listingcharacter listingcharacter">getInputAndOutputFiles</samp> and <samp class="listingcharacter listingcharacter">fileExists</samp>. These are ideal candidates for outsourcing to a separate module. So, you create a new file called <span class="italic">util.js</span>, copy the two functions into the file, and export it. <span class="crossreference "><a href="28_006.html#l28.18">Listing 28.18</a></span> shows the source code of the <span class="italic">util.js</span> file.</p>
        <div class="listing " id="l28.18"><pre><span class="rot">export</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">getInputAndOutputFiles()</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> input </span><span class="dunkelblau">=</span><span class="schwarz"> Deno</span><span class="schwarz">.</span><span class="schwarz">args</span><br/>    <span class="schwarz">.find((</span><span class="schwarz">arg</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> arg</span><span class="schwarz">.startsWith(</span><span class="hellblau">'--input='</span><span class="schwarz">))</span><span class="schwarz"><br/></span>    <span class="schwarz">.substr(8);</span><span class="schwarz"><br/></span>  <span class="rot">const</span><span class="schwarz"> output </span><span class="dunkelblau">=</span><span class="schwarz"> Deno</span><span class="schwarz">.</span><span class="schwarz">args</span><br/>    <span class="schwarz">.find((</span><span class="schwarz">arg</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"> arg</span><span class="schwarz">.startsWith(</span><span class="hellblau">'--output='</span><span class="schwarz">))</span><span class="schwarz"><br/></span>    <span class="schwarz">.substr(9);</span><span class="schwarz"><br/></span> <br/>  <span class="magenta">console</span><span class="schwarz">.log(</span><span class="violett">`Input was: ${input}, Output was: ${output}`</span><span class="schwarz">);</span><span class="schwarz"><br/></span> <br/>  <span class="rot">return</span><span class="schwarz"> </span><span class="schwarz">[</span><span class="schwarz">input</span><span class="schwarz">,</span><span class="schwarz"> output</span><span class="schwarz">];</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"><br/></span> <br/><span class="rot">export</span><span class="schwarz"> </span><span class="rot">async</span><span class="schwarz"> </span><span class="rot">function</span><span class="schwarz"> </span><span class="schwarz">fileExists(</span><span class="schwarz">filename</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  <span class="rot">try</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">await</span><span class="schwarz"> Deno</span><span class="schwarz">.stat(</span><span class="violett">`./${filename}`</span><span class="schwarz">);</span><span class="schwarz"><br/></span>    <span class="rot">return</span><span class="schwarz"> </span><span class="rot">true</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">catch </span><span class="schwarz">(</span><span class="rot">error</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>    <span class="rot">if</span><span class="schwarz"> </span><span class="schwarz">(</span><span class="schwarz">error </span><span class="rot">instanceof Deno</span><span class="schwarz">.</span><span class="rot">errors</span><span class="schwarz">.</span><span class="rot">NotFound</span><span class="schwarz">)</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>      <span class="rot">return</span><span class="schwarz"> </span><span class="rot">false</span><span class="schwarz">;</span><span class="schwarz"><br/></span>    <span class="schwarz">}</span><span class="schwarz"><br/></span>    <span class="rot">throw</span><span class="schwarz"> error</span><span class="schwarz">;</span><span class="schwarz"><br/></span>  <span class="schwarz">}</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span></pre></div>
        <p class="caption "><b>Listing 28.18</b>    
            Swapping Out Functions to a Separate File (util.js)</p>
        <p class="standard">You now use these two functions in the entry file of your application—the <span class="italic">index.js</span> file—as shown in <span class="crossreference "><a href="28_006.html#l28.19">Listing 28.19</a></span>.</p>
        <div class="listing " id="l28.19"><pre><span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter"><span class="rot">import</span><span class="schwarz"> { getInputAndOutputFiles, fileExists } </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'./util.js'</span><span class="schwarz">;</span><br/> </samp></span><br/><span class="rot">const</span><span class="schwarz"> [input, output] </span><span class="dunkelblau">=</span><span class="schwarz"> getInputAndOutputFiles();</span><br/><span class="rot">const</span><span class="schwarz"> encoder </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">new </span><span class="schwarz">TextEncoder();</span><br/> <br/><span class="rot">if</span><span class="schwarz"> (</span><span class="rot">await</span><span class="schwarz"> fileExists(input)) {</span><br/>  <span class="rot">const</span><span class="schwarz"> text </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="rot">await</span><span class="schwarz"> Deno.readTextFile(</span><span class="violett">`./${input}`</span><span class="schwarz">);</span><br/>  <span class="magenta">console</span><span class="schwarz">.log(text);</span><br/> <br/>  <span class="rot">const</span><span class="schwarz"> encodedText </span><span class="dunkelblau">=</span><span class="schwarz"> encoder.encode(text);</span><br/>  Deno.writeFile(<span class="violett">`./${output}`</span><span class="schwarz">, encodedText);</span><br/>} <span class="schwarz"/></pre></div>
        <p class="caption "><b>Listing 28.19</b>    
            Integrating the Helper Functions (index.js)</p>
        <p class="standard"><a id="p806"/>When integrating the <span class="italic">util.js</span> file, don’t forget the file extension, or Deno will complain that the file can’t be found. Now you can run the example again. The modification hasn’t changed anything in the command to start the application nor in the output.</p>
        <p class="standard">Deno would already be doomed in its early days if the platform didn’t have the possibility to load external modules. So, in the next step, you’ll see how to access modules made available to you by the ever-growing Deno community.</p>
        
            <h3 class="t3" id="h28.6.1">28.6.1    Loading External Modules into Deno<a class="indexanchor" id="i28_52"/></h3>
            <p class="standard">The first place to go for modules in Deno is the standard library<a class="indexanchor" id="i28_53"/>. This is a set of modules with no external dependencies that are reviewed by Deno’s core team. This is to ensure that, on the one hand, the core of Deno can be kept as slim as possible, and, on the other hand, you can access numerous extensions without having to bother about their quality.</p>
            <p class="standard">An example of functionality from the Deno standard library is the <samp class="listingcharacter listingcharacter">http</samp> module. For example, this module enables you to use the <samp class="listingcharacter listingcharacter">listenAndServe</samp> function, which significantly simplifies the implementation of a web server. <span class="crossreference "><a href="28_006.html#l28.20">Listing 28.20</a></span> shows how you can use this function to implement the example from <span class="crossreference "><a href="28_005.html#l28.16">Listing 28.16</a></span> in a much shorter and easier way.</p>
            <div class="listing " id="l28.20"><pre><span class="rot">import</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"> listenAndServe </span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'https://deno.land/std@0.108.0/http/server.ts'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="schwarz">listenAndServe(</span><span class="schwarz"><br/></span>  <span class="hellblau">':8080'</span><span class="schwarz">,</span><span class="schwarz"><br/></span>  <span class="schwarz">()</span><span class="schwarz"> </span><span class="dunkelblau">=&gt;</span><span class="schwarz"><br/></span>    <span class="rot">new </span><span class="schwarz">Response(</span><span class="hellblau">'Hello Deno!'</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>      status<span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">200,</span><span class="schwarz"><br/></span>      headers<span class="schwarz">:</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>        <span class="hellblau">'content-type'</span><span class="schwarz">:</span><span class="schwarz"> </span><span class="hellblau">'text/plain'</span><span class="schwarz">,</span><span class="schwarz"><br/></span>      <span class="schwarz">},</span><span class="schwarz"><br/></span>    <span class="schwarz">}),</span><span class="schwarz"><br/></span><span class="schwarz">);</span><span class="schwarz"><br/></span> <br/><span class="magenta">console</span><span class="schwarz">.log(</span><span class="hellblau">'Server is listening to http://localhost:8080'</span><span class="schwarz">);</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 28.20</b>    
            HTTP Server with the “http” Module from the Standard Library</p>
            <p class="standard">As you can see here, you no longer have to use asynchronous loops, but you can directly define the response handler as a callback function, and the <samp class="listingcharacter listingcharacter">http</samp> module will take care of everything else. When you run the web server, you need to make sure once again that network access is permitted. In addition, when taking a look at the output in <span class="crossreference "><a href="28_006.html#l28.21">Listing 28.21</a></span>, you can see that Deno downloads a number of files. This is the <samp class="listingcharacter listingcharacter">http</samp> module and its dependencies<a class="indexanchor" id="i28_54"/> within the standard library. However, these downloads take place only once initially. For all further executions, Deno uses its local cache<a class="indexanchor" id="i28_55"/>.</p>
            <div class="listing " id="l28.21"><pre><a id="p807"/>$ <span class="bold"><span class="schwarz"/><samp class="listingcharacter listingcharacter">deno run <span class="dunkelblau">--</span><span class="schwarz">allow</span><span class="dunkelblau">-</span><span class="schwarz">net</span><span class="dunkelblau">=</span><span class="schwarz">0.0.0.0:8080 index.js </span></samp></span><br/>Download https:<span class="dunkelblau">//</span><span class="schwarz">deno.land</span><span class="dunkelblau">/</span><span class="schwarz">std@0.108.0</span><span class="dunkelblau">/</span><span class="schwarz">http</span><span class="dunkelblau">/</span><span class="schwarz">server.ts</span><br/>Download https:<span class="dunkelblau">//</span><span class="schwarz">deno.land</span><span class="dunkelblau">/</span><span class="schwarz">std@0.108.0</span><span class="dunkelblau">/</span><span class="rot">async</span><span class="dunkelblau">/</span><span class="schwarz">mod.ts</span><br/>Download https:<span class="dunkelblau">//</span><span class="schwarz">deno.land</span><span class="dunkelblau">/</span><span class="schwarz">std@0.108.0</span><span class="dunkelblau">/</span><span class="rot">async</span><span class="dunkelblau">/</span><span class="schwarz">delay.ts</span><br/>Download https:<span class="dunkelblau">//</span><span class="schwarz">deno.land</span><span class="dunkelblau">/</span><span class="schwarz">std@0.108.0</span><span class="dunkelblau">/</span><span class="rot">async</span><span class="dunkelblau">/</span><span class="schwarz">deadline.ts</span><br/>Download https:<span class="dunkelblau">//</span><span class="schwarz">deno.land</span><span class="dunkelblau">/</span><span class="schwarz">std@0.108.0</span><span class="dunkelblau">/</span><span class="rot">async</span><span class="dunkelblau">/</span><span class="schwarz">mux_async_iterator.ts</span><br/>Download https:<span class="dunkelblau">//</span><span class="schwarz">deno.land</span><span class="dunkelblau">/</span><span class="schwarz">std@0.108.0</span><span class="dunkelblau">/</span><span class="rot">async</span><span class="dunkelblau">/</span><span class="schwarz">deferred.ts</span><br/>Download https:<span class="dunkelblau">//</span><span class="schwarz">deno.land</span><span class="dunkelblau">/</span><span class="schwarz">std@0.108.0</span><span class="dunkelblau">/</span><span class="rot">async</span><span class="dunkelblau">/</span><span class="schwarz">debounce.ts</span><br/>Download https:<span class="dunkelblau">//</span><span class="schwarz">deno.land</span><span class="dunkelblau">/</span><span class="schwarz">std@0.108.0</span><span class="dunkelblau">/</span><span class="rot">async</span><span class="dunkelblau">/</span><span class="schwarz">pool.ts</span><br/>Download https:<span class="dunkelblau">//</span><span class="schwarz">deno.land</span><span class="dunkelblau">/</span><span class="schwarz">std@0.108.0</span><span class="dunkelblau">/</span><span class="rot">async</span><span class="dunkelblau">/</span><span class="schwarz">tee.ts</span><br/>Check file:<span class="gruen">///srv/node-buch/index.js</span><span class="schwarz"><br/></span>Server is listening to http:<span class="dunkelblau">//</span><span class="schwarz">localhost:8080 </span><span class="schwarz"/></pre></div>
            <p class="caption "><b>Listing 28.21</b>    
            Running the Web Server with the “http” Module</p>
            <p class="standard">In addition to the modules of the standard library, there is another source for external Deno modules: <span class="italic">deno.land/x</span><a class="indexanchor" id="i28_56"/>.</p>
        
        
            <h3 class="t3" id="h28.6.2">28.6.2    deno.land/x</h3>
            <p class="standard">Unlike the modules of the standard library, the ones you can include via deno.land/x aren’t subject to such strict quality criteria. These are packages stored on GitHub. deno.land/x caches the releases of these packages and makes them available via a shortened path. <span class="crossreference "><a href="28_006.html#l28.22">Listing 28.22</a></span> contains the <samp class="listingcharacter listingcharacter">fibonacci</samp> module as an example for the use of modules from deno.land/x. This module returns the <samp class="listingcharacter listingcharacter">fibonacci</samp> function<a class="indexanchor" id="i28_57"/> as the sum of the Fibonacci sequence, or the <samp class="listingcharacter listingcharacter">fibonacciSequence</samp>, which represents an array.</p>
            <div class="listing " id="l28.22"><pre><span class="rot">import</span><span class="schwarz"> fibonacci</span><span class="schwarz">,</span><span class="schwarz"> </span><span class="schwarz">{</span><span class="schwarz"><br/></span>  fibonacciSequence<span class="schwarz">,</span><span class="schwarz"><br/></span><span class="schwarz">}</span><span class="schwarz"> </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'https://deno.land/x/fibonacci/mod.ts'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="magenta">console</span><span class="schwarz">.log(fibonacci(9));</span><span class="schwarz"><br/></span><span class="magenta">console</span><span class="schwarz">.log(fibonacciSequence(4));</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 28.22</b>    
            Integrating Modules from deno.land/x</p>
            <p class="standard">Apart from these modules, you can also include npm packages.</p>
        
        
            <h3 class="t3" id="h28.6.3">28.6.3    Using Node Package Manager Packages<a class="indexanchor" id="i28_58"/></h3>
            <p class="standard">If at all possible, you should avoid including npm packages, as this is generally considered bad practice in the Deno community. In many cases, integrating npm packages works fine, but you shouldn’t do it as a default out of habit. Node.js npm packages are usually optimized to run in Node.js. Especially with more extensive packages, unwanted side effects can quickly occur if the packages are based on core Node.js modules<a class="indexanchor" id="i28_59"/>. For <a id="p808"/>most areas of use, native solutions for Deno also exist that you can use directly, but sometimes there is no way around npm packages. In the simplest case, you access the source code of the package on GitHub, and if the package already uses ECMAScript modules, you can use it directly via an <samp class="listingcharacter listingcharacter">import</samp> statement. <span class="crossreference "><a href="28_006.html#l28.23">Listing 28.23</a></span> shows an example of this.</p>
            <div class="listing " id="l28.23"><pre><span class="rot">import</span><span class="schwarz"> intersection </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'https://raw.githubusercontent.com/lodash/lodash/master/intersection.js'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> numbers1 </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[1,</span><span class="schwarz"> </span><span class="schwarz">2,</span><span class="schwarz"> </span><span class="schwarz">3,</span><span class="schwarz"> </span><span class="schwarz">4];</span><span class="schwarz"><br/></span><span class="rot">const</span><span class="schwarz"> numbers2 </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">[6,</span><span class="schwarz"> </span><span class="schwarz">5,</span><span class="schwarz"> </span><span class="schwarz">4,</span><span class="schwarz"> </span><span class="schwarz">3];</span><span class="schwarz"><br/></span> <br/><span class="rot">const</span><span class="schwarz"> numbersIntersection </span><span class="dunkelblau">=</span><span class="schwarz"> </span><span class="schwarz">intersection(</span><span class="schwarz">numbers1</span><span class="schwarz">,</span><span class="schwarz"> numbers2</span><span class="schwarz">);</span><span class="schwarz"><br/></span> <br/><span class="magenta">console</span><span class="schwarz">.log(</span><span class="schwarz">numbersIntersection</span><span class="schwarz">);</span><span class="gruen"> // Output: [ 3, 4 ]</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 28.23</b>    
            Integrating Lodash in Deno</p>
            <p class="standard">The example uses the <samp class="listingcharacter listingcharacter">intersection</samp> function of Lodash<a class="indexanchor" id="i28_60"/> to determine the intersection of two arrays. You can access the corresponding file by opening the project repository at <span class="url"><a href="https://github.com/lodash/lodash">https://github.com/lodash/lodash</a></span> in the browser, picking out the <span class="italic">intersection.js</span> file and clicking on the <span class="screenelement">raw</span> button. When you take a look at the source code of the <span class="italic">intersection.js</span> file, you’ll see that <samp class="listingcharacter listingcharacter">import</samp> statements are already used here, so integration and usage won’t be a problem.</p>
            <p class="standard">For classic npm packages, you need to dig a little deeper into the box of tricks and use services such as JavaScript Package Manager (JSPM)<a class="indexanchor" id="i28_61"/>, which convert npm packages into ECMAScript modules for you using the CommonJS module system. <span class="crossreference "><a href="28_006.html#l28.24">Listing 28.24</a></span> shows an example of this in which the <samp class="listingcharacter listingcharacter">is-odd</samp> library is used.</p>
            <div class="listing " id="l28.24"><pre><span class="rot">import</span><span class="schwarz"> isOdd </span><span class="rot">from</span><span class="schwarz"> </span><span class="hellblau">'https://dev.jspm.io/is-odd'</span><span class="schwarz">;</span><span class="schwarz"><br/></span> <br/><span class="magenta">console</span><span class="schwarz">.log(isOdd(3));</span><span class="gruen"> // Output: true</span><span class="schwarz"> </span></pre></div>
            <p class="caption "><b>Listing 28.24</b>    
            Integrating the “is-odd” Library</p>
            <p class="standard">When you run this script, the output looks like the one shown in <span class="crossreference "><a href="28_006.html#l28.25">Listing 28.25</a></span>.</p>
            <div class="listing " id="l28.25"><pre>$ <span class="bold"><samp class="listingcharacter listingcharacter">deno run index.js</samp></span><br/>Download https://dev.jspm.io/is-odd<br/>Download https://dev.jspm.io/npm:is-odd@3.0.1/index.dew.js<br/>Download https://dev.jspm.io/npm:is-number@6?dew<br/>Download https://dev.jspm.io/npm:is-number@6.0.0/index.dew.js<br/>true </pre></div>
            <p class="caption "><b>Listing 28.25</b>    
            Running a Script with an npm Package via JSPM</p>
            <p class="standard"><a id="p809"/>As you can see, Deno first downloads the <samp class="listingcharacter listingcharacter">is-odd</samp> package and then the <samp class="listingcharacter listingcharacter">is-number</samp> package, which is a dependency of the <samp class="listingcharacter listingcharacter">is-odd</samp> package. After the dependencies are resolved, Deno executes the source code and produces the output, in this case, the string <samp class="listingcharacter listingcharacter">true</samp>, because the value <samp class="listingcharacter listingcharacter">3</samp> is an odd number.</p>
        
    </div><p class="signatur"/>
                    </body>
                </html>